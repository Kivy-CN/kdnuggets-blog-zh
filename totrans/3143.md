# 使用 fast.ai 进行快速特征工程

> 原文：[https://www.kdnuggets.com/2018/03/feature-engineering-dates-fastai.html](https://www.kdnuggets.com/2018/03/feature-engineering-dates-fastai.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

正如你无疑知道的，简单的日期字段是数据的潜在宝藏。虽然乍一看，日期给我们的仅仅是时间线上的一个特定点，但了解这个点相对于其他点的位置可以对数据集产生各种洞察。例如，可以从日期字段中提取出一系列简单的问题：

+   是周末吗？

+   那一天是星期几？

+   该日期是否是一个季度的末尾？

+   那一天是节假日吗？

+   该日期是否发生了奥运会？

你从日期中想要得到的内容取决于你在做什么。拥有包含一些上述较不内在问题答案的外部资源（例如“该日期是否发生了奥运会？”--可能是你项目中完全有效的问题）无疑是必要的，但即使是解决更基础的问题也可能会极有用。

对日期进行简单的特征工程可以不加思索地处理后者。当我最近坐下来编写一个通用的、可重用的函数时，我很快意识到[Jeremy Howard](https://twitter.com/jeremyphoward)在他的fast.ai库中已经处理了这个问题。

如果你不知道，[fast.ai 库](https://github.com/fastai/fastai)是一个用于许多流行机器学习库的补充包装器集合，旨在消除编写自己函数以处理机器学习工作流中一些重复任务的必要性。

fast.ai中确实存在这样的一个函数，它利用 Pandas 在后台自动化一些简单的与日期相关的特征工程。

让我们来看一下。但首先，我们需要一些简单的数据进行测试。要了解更多关于数据及其在下面代码中如何被收集的信息，请参见[数据科学红利 - 财务数据分析的温和介绍](/2017/04/data-science-dividends-intro-financial-data-analysis.html)。此外，这也假设你已经安装了fast.ai库。

```py
import datetime
import pandas as pd
from pandas_datareader import data
from fastai.structured import add_datepart

# Set source and rate of interest
source = 'fred'
rate = 'DEXCAUS'

# Date range is 2016
start = datetime.datetime(2016, 1, 1)
end = datetime.datetime(2016, 12, 31)
cadusd = data.DataReader(rate, source, start, end)

# Write it to a CSV 
cadusd.to_csv('cadusd.csv')

# Read the CSV back in (there is a peculiarity accounting for this)
cadusd = pd.read_csv('cadusd.csv')

# Set datetime precision to 'day'
cadusd['DATE'] = cadusd['DATE'].astype('datetime64[D]')

cadusd['DEXCAUS'].plot(kind='line', grid=True, title='CAD to USD Conversion Rates, 2016')
cadusd.head()
```

![dexcaus](../Images/41bb73ec010a7d22c85be4c4aa6778c5.png)

为了让我们了解 fast.ai 函数代码的简单性，这里查看一下[当前版本的源代码](https://github.com/fastai/fastai/blob/master/fastai/structured.py)：

```py
def add_datepart(df, fldname, drop=True):
    fld = df[fldname]
    if not np.issubdtype(fld.dtype, np.datetime64):
        df[fldname] = fld = pd.to_datetime(fld, infer_datetime_format=True)
    targ_pre = re.sub('[Dd]ate$', '', fldname)
    for n in ('Year', 'Month', 'Week', 'Day', 'Dayofweek', 'Dayofyear',
            'Is_month_end', 'Is_month_start', 'Is_quarter_end', 'Is_quarter_start', 'Is_year_end', 'Is_year_start'):
        df[targ_pre+n] = getattr(fld.dt,n.lower())
    df[targ_pre+'Elapsed'] = fld.astype(np.int64) // 10**9
    if drop: df.drop(fldname, axis=1, inplace=True)
```

Howard在多个地方表示，他编写fast.ai包装器的目标是用尽可能少的代码创建有用的函数，使它们简洁、易读，并且专注于其目标。

对函数的简单调用会展开 DATE 字段：

```py

add_datepart(cadusd, 'DATE')
```

函数唯一的额外可能参数是 'drop'，当其值为 True 时，将从数据框中删除原始日期列。

以下是部分结果：

![新特性](../Images/473171a63c95941aeee84a883634b76b.png)

完整的特性列表：

![特性列表](../Images/63a2d87efc8cb7ea2cc53f7932d49bb4.png)

由于没有机器学习算法能够查看日期时间对象并自动推断上述内容，这样一个简单的步骤提供了对数据集的自动洞察的可能性。无需思考，现在所有类型的日期元数据都触手可及，例如是否为年的第一天、季度的第一天或月份的第一天，进一步简单推断出是否是周末、是否在三月、是哪一年等。

从我个人观点来看，这项基本的特性工程应该提示两个具体的点：

1.  时间序列数据的特性工程不应被恐惧

1.  你可能会想看看 fast.ai 库

**相关**：

+   [傻瓜时间序列 – 三步流程](/2018/03/time-series-dummies-3-step-process.html)

+   [深度特性合成：自动化特性工程如何运作](/2018/02/deep-feature-synthesis-automated-feature-engineering.html)

+   [时间序列数据的自动化特性工程](/2017/11/automated-feature-engineering-time-series-data.html)

* * *

## 我们的三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速开启网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升您的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持您的组织进行IT管理

* * *

### 更多相关内容

+   [特性存储峰会2022：关于特性工程的免费会议](https://www.kdnuggets.com/2022/10/hopsworks-feature-store-summit-2022-free-conference-feature-engineering.html)

+   [利用RAPIDS cuDF在特性工程中使用GPU](https://www.kdnuggets.com/2023/06/rapids-cudf-leverage-gpu-feature-engineering.html)

+   [快速指南：如何找到合适的标注人才](https://www.kdnuggets.com/2022/04/quick-guide-find-right-minds-annotation.html)

+   [快速数据科学技巧和窍门：学习SAS](https://www.kdnuggets.com/2022/05/sas-quick-data-science-tips-tricks-learn.html)

+   [7个Pandas绘图函数用于快速数据可视化](https://www.kdnuggets.com/7-pandas-plotting-functions-for-quick-data-visualization)

+   [Voronoi图的快速概述](https://www.kdnuggets.com/2022/11/quick-overview-voronoi-diagrams.html)
