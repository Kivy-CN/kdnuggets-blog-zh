# 执行机器学习和数据科学时的常见错误

> 原文：[https://www.kdnuggets.com/2018/12/common-mistakes-data-science.html](https://www.kdnuggets.com/2018/12/common-mistakes-data-science.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

**由 [Jekaterina Kokatjuhha](https://www.linkedin.com/in/jekaterina-kokatjuhha/)，Zalando的研究工程师。**

这是本系列的第二部分，第一部分请参见 [**如何从零开始构建数据科学项目**](https://www.kdnuggets.com/2018/12/build-data-science-project-from-scratch.html)。

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你所在组织的IT需求

* * *

在抓取或获取数据后，有许多步骤要完成**在**应用机器学习模型之前。

你需要可视化每个变量，以查看分布、找到异常值，并理解为何会出现这些异常值。

你可以对某些特征中的缺失值做些什么？

将分类特征转换为数值特征的最佳方法是什么？

这样的问问题有很多，但我将详细介绍大多数初学者遇到错误的那些。

#### 1\. 可视化

首先，你应该可视化连续特征的分布，以了解是否存在许多异常值、分布情况以及是否有意义。

有很多可视化方法，例如 [箱线图](https://www.khanacademy.org/math/statistics-probability/summarizing-quantitative-data/box-whisker-plots/a/box-plot-review)、[直方图](https://en.wikipedia.org/wiki/Histogram)、[累积分布函数](https://en.wikipedia.org/wiki/Cumulative_distribution_function) 和 [小提琴图](https://en.wikipedia.org/wiki/Violin_plot)。然而，应选择能提供最多信息的图表。

要查看分布（是否为 [正态](https://en.wikipedia.org/wiki/Normal_distribution) 或 [双峰](https://en.wikipedia.org/wiki/Multimodal_distribution)），直方图将最为有用。虽然直方图是一个好的起点，但箱线图可能在识别异常值数量和查看中位数四分位数位置方面更为优越。

根据这些图表，最有趣的问题是：**你是否看到了你期望看到的？**回答这个问题将帮助你发现洞察或数据中的错误。

为了获得灵感并了解哪个图表最有价值，我经常参考[Python 的 seaborn 画廊](https://seaborn.pydata.org/examples/index.html)。另一个好的灵感来源是 Kaggle 上的内核。[这是我的 Kaggle 内核](https://www.kaggle.com/jkokatjuhha/in-depth-visualisations-simple-methods)，展示了 Titanic 数据集的深度可视化。

在租金价格的背景下，我绘制了每个连续特征的直方图，期望在不含账单的租金和总面积的分布中看到一个长的右尾。

![](../Images/c89bc5e86afd341fed4b789799b00190.png)

**连续特征的直方图**

箱线图帮助我查看每个特征的异常值数量。实际上，大多数基于不含账单的租金的异常值公寓要么是面积超过200平方米的小商店的工作室，要么是租金非常低的学生宿舍。

![](../Images/404bdbb751bfd3f901a5b02fdb627afd.png)

**连续特征的箱线图**

#### 2\. 我是否需要基于整个数据集来填补缺失值？

有时由于各种原因会出现缺失值。如果我们排除每一个包含至少一个缺失值的观测值，可能会导致数据集大幅减少。

填补缺失值的方法有[很多种](https://www.iriseekhout.com/missing-data/missing-data-methods/imputation-methods/)，包括均值或中位数。你可以选择任何一种方法**但**要确保只在训练数据上计算填补统计量，以避免[**数据泄露**](https://machinelearningmastery.com/data-leakage-machine-learning/)测试集。

在租赁数据中，我还提取了公寓的描述。每当质量、条件或公寓类型缺失时，我会从描述中填补这些信息，如果描述中包含了这些信息的话。

#### 3\. 我如何转换分类变量？

一些算法根据其实现方式，无法直接处理分类数据，因此需要将其转换为数值形式。

将分类变量转换为数值特征的方法有很多，比如[标签编码（Label Encoder）、独热编码（One Hot Encoding）、分箱编码（bin encoding）](http://pbpython.com/categorical-encoding.html)和哈希编码。然而，大多数人会**错误地**使用标签编码，而应该使用独热编码。

假设在我们的租赁数据中，有一个公寓类型的列，其值如下：[ground floor, loft, maisonette, loft, loft, ground floor]。LabelEncoder 可以将其转换为 [3,2,1,2,2,1]，引入了序数性，这意味着 ground_floor > loft > maisonette。对于一些算法，如决策树及其变种，这种特征编码是可以接受的，但对于回归和支持向量机（SVM）可能不太合适。

在租金价格数据集中，**条件**被编码如下：

+   新增：1

+   翻新：2

+   需要翻新：3

和**质量**：

+   Luxus:1

+   比正常情况好: 2

+   normal: 3

+   简单: 4

+   unknown: 5

#### 4. 我需要标准化变量吗？

标准化将所有连续变量调整到相同的尺度，这意味着如果一个变量的值范围从 1K 到 1M，而另一个变量的值范围从 0.1 到 1，那么在标准化后，它们将具有相同的范围。

[L1 或 L2 正则化](https://towardsdatascience.com/l1-and-l2-regularization-methods-ce25e7fc831c) 是减少 [过拟合](https://machinelearningmastery.com/overfitting-and-underfitting-with-machine-learning-algorithms/) 的常见方法，并且可以在许多回归算法中使用。然而，在应用 L1 或 L2 之前，**必须** 进行特征标准化。

租金价格以欧元为单位，因此拟合系数将比价格以分为单位时的拟合系数大约大 100 倍。L1 和 L2 对较大系数的惩罚更多，这意味着它们会对较小尺度的特征进行更多的惩罚。为了防止这种情况，在应用 L1 或 L2 之前，特征应该先进行标准化。

另一个标准化的原因是，如果你或你的算法使用梯度下降，特征缩放能使梯度下降收敛得更快。

#### 5. 我需要推导目标变量的对数吗？

我花了一段时间才明白，**没有普遍的答案**。

这取决于许多因素：

+   你是否希望使用分数误差或绝对误差

+   你使用哪种算法

+   残差图和度量变化告诉你什么

在回归中，首先 [关注残差图](http://docs.statwing.com/interpreting-residual-plots-to-improve-your-regression/) 和度量标准。有时对目标变量进行对数变换会导致更好的模型，并且模型的结果仍然容易理解。然而，还有其他一些变换也可能值得关注，比如取平方根。

关于这个问题，Stack Overflow 上有很多答案，我认为 [残差图和原始及对数目标变量的 RMSE](https://stats.stackexchange.com/questions/319880/non-linear-regression-residual-plots-and-rmse-on-raw-and-log-target-variable) 解释得非常好。

对于租金数据，我推导了价格的对数，因为残差图看起来好一些。

![](../Images/fe1f5cc65c6786934dee94174e02a61f.png)

**对数变换（左）和未经变换的数据（右）的租金残差图，不包括账单变量。右侧图展示了“异方差性”——残差随着预测从小到大的变化而增大。**

#### 一些更重要的内容

一些算法，如回归算法，会受到数据中的[collinearities](https://en.wikipedia.org/wiki/Multicollinearity)的影响，因为系数变得非常不稳定（[更多数学](http://www.stat.cmu.edu/~larry/=stat401/lecture-17.pdf)）。[SVM](https://en.wikipedia.org/wiki/Support_vector_machine) [可能会或可能不会受到影响](https://stats.stackexchange.com/questions/149662/is-support-vector-machine-sensitive-to-the-correlation-between-the-attributes) 由于选择的核函数。

基于决策的算法不会遭受多重共线性的问题，因为它们可以在不同的树中互换使用特征，而不会影响性能。然而，特征重要性的解释变得更加困难，因为相关变量可能不会显得那么重要。

### 机器学习

在你熟悉数据并清理掉异常值之后，这正是掌握机器学习的最佳时机。你可以使用多种算法进行监督式机器学习。

我想探索三种不同的算法，比较它们的特性，如性能差异和速度。这三种算法是具有不同实现的梯度提升树（XGBoost和LightGMB）、随机森林（FR，scikit-learn）和3层神经网络（NN，Tensorflow）。我选择了RMSLE（均方根对数误差）作为优化过程的指标。我使用RMSLE是因为我对目标变量进行了对数转换。

XGBoost和LigthGBM表现相当，RF略差，而NN表现最差。

![](../Images/baa8f77c7d797cc5f8898e8441cd8cf0.png)

**算法在测试集上的性能（RMSLE）。**

基于决策树的算法在解释特征方面非常出色。例如，它们会生成一个特征重要性分数。

#### 特征重要性：找出租金价格的驱动因素

在拟合基于决策树的模型后，你可以查看哪些特征对价格预测最有价值。

特征重要性提供了一个分数，表示每个特征在模型的决策树构建中的信息量。计算这个分数的一种方法是统计一个特征在所有树中被用来分割数据的次数。这个分数可以通过[different ways](https://datascience.stackexchange.com/questions/12318/how-do-i-interpret-the-output-of-xgboost-importance)来计算。

特征重要性可以揭示有关主要价格驱动因素的其他见解。

对于租金预测来说，总面积是价格最重要的驱动因素并不令人惊讶。有趣的是，一些通过外部API工程化的特征也排在最重要的特征之列。

![](../Images/818ee95c8e2f3873c5cbbad1f9d44e12.png)

**特征重要性由分割（上图）和增益（下图）计算**

然而，如[“可解释的机器学习与XGBoost”](https://towardsdatascience.com/interpretable-machine-learning-with-xgboost-9ec80d148d27)中提到的，特征重要性可能会因归因选项的不同而不一致。该博客文章的作者以及SHAP NIPS论文提出了一种新的计算特征重要性的方法，这种方法将既准确又一致。这使用了[shap Python库](https://github.com/slundberg/shap)。SHAP值表示特征对模型输出变化的责任。

租赁价格数据分析的结果如下图所示。

![](../Images/ba1d5ac0a74b69d880a8d7afc3cd0aae.png)

**每个公寓在每一行上都有一个点。点的x位置表示该特征对模型对客户预测的影响，点的颜色代表该特征在公寓中的值。**

该图包含了大量有价值的信息（特征按均值（|Tree SHAP|）排序）。小提示：数据来自2018年初；区县可能会发展，因此价格相关因素可能会改变。

+   到市中心的距离（开车到U-Bahn Stadtmitte的公里数和到S-Bahn Friedrichstrasse的火车旅行时间）会增加预测的租赁公寓价格。

+   总面积作为租赁价格的最强驱动因素

+   如果公寓业主要求你提供低收入证明（德语中为WBS），预测价格会较低。

+   在这些区县租赁公寓也会增加租赁价格：Mitte、Prenzlauer Berg、Wilmersdorf、Charlottenburg、Zehlendorf 和 Friedrichshain。

+   价格较低的区县包括：Spandau、Tempelhof、Wedding 和 Reinickendorf

+   显然，公寓的条件越好——价值越低则越好——质量越高——价值越低则越好——配有家具、内置厨房和电梯的公寓会更贵。

以下特征的影响很有趣：

+   到最近地铁站的时间

+   1公里内的车站数量。

**到最近地铁站的时间：**

看起来对于一些公寓，这个特征的高值表示价格更高。原因是这些公寓位于柏林以外的非常富裕的住宅区。

还可以看到，靠近地铁站有两个方向的影响：它降低**和**增加一些公寓的价格。原因可能是距离地铁站非常近的公寓也会受到地铁噪音或列车振动的影响，但另一方面，它们与公共交通的连接良好。然而，可以进一步探讨这个特征，因为它仅显示了到最近地铁站的距离，而不是有轨电车/公交车站的距离。

**1公里内的车站数量：**

同样适用于距离公寓一公里内的车站数量。一般来说，周围的地铁站越多，租金价格会增加。然而，它也有一个负面效果——更多的噪音。

#### 集成平均

在尝试不同模型并比较性能后，你可以将每个模型的结果结合起来，构建一个集成模型！

Bagging 是一种机器学习集成模型，它利用多个算法的预测来计算最终的聚合预测。它旨在防止过拟合，并减少算法的方差。

![](../Images/b0acefa672b5eefe0d69f4a84bc74bd4.png)

**使用集成的优点：红色模型在左下角的表现更好，而蓝色模型在右上角的表现更好。通过结合两个模型的预测，可能会提高整体性能。图来自 [这里。](https://burakhimmetoglu.com/2016/12/01/stacking-models-for-improved-predictions/)** 

由于我已经有了上述算法的预测，我将所有四个模型以所有可能的方式组合起来，并根据验证集的RMSLE选择了七个最佳的单模型和集成模型。

然后计算了这七个模型在测试集上的RMSLE。

![](../Images/54e522617bfcb8d870e87a119d1cebbc.png)

**测试算法的RMSLE。**

与每个单独模型相比，基于三个决策树算法的集成表现最佳。

你还可以生成一个加权集成，将更多的权重分配给更好的单一模型。其背后的理由是，其他模型只有在集体同意替代方案的情况下，才能推翻最佳模型。

实际上，如果不尝试一下，没人会知道一个平均集成模型是否比单模型更好。

#### 堆叠模型

平均或加权集成并不是唯一结合不同模型预测的方法。你也可以以非常不同的方式堆叠模型！

堆叠模型的想法是创建多个基础模型，并在这些基础模型的结果上构建一个元模型，以生成最终预测。然而，如何训练元模型并不明显，因为它可能会偏向于最好的基础模型。关于如何正确执行这一过程的非常好解释可以在文章 [“Stacking models for improved predictions”](https://burakhimmetoglu.com/2016/12/01/stacking-models-for-improved-predictions/)中找到。

对于租金价格的情况，堆叠模型并没有改善RMSLE——它们甚至增加了指标。这可能有几个原因——要么是我编程错误 ;) 要么是堆叠引入了过多的噪音。

如果你想深入了解更多关于组合和堆叠模型的文章，[Kaggle组合指南](https://mlwave.com/kaggle-ensembling-guide/) 解释了多种组合方法及其性能比较，并提供了如何让这些堆叠模型在Kaggle竞赛中脱颖而出的参考。

### **最终思考**

+   听听你周围人谈论什么，他们的抱怨可以作为解决重大问题的良好起点

+   通过提供互动仪表板，让人们自己发现洞察

+   不要仅限于常见的特征工程，比如两个变量的相乘。尝试寻找额外的数据来源或解释

+   尝试组合模型和堆叠模型，这些方法可能会提升性能

**请务必提供你展示数据的日期！**

图表来源：

[https://www.pinterest.de/minimalcouture/paris-apartments/](https://www.pinterest.de/minimalcouture/paris-apartments/)

[https://www.theodysseyonline.com/the-struggles-of-moving-into-your-first-apartment](https://www.theodysseyonline.com/the-struggles-of-moving-into-your-first-apartment)

[https://www.fashionbeans.com/content/the-worlds-10-smallest-apartments-are-downright-shocking/](https://www.fashionbeans.com/content/the-worlds-10-smallest-apartments-are-downright-shocking/)

**简介**: [Jekaterina Kokatjuhha](https://www.linkedin.com/in/jekaterina-kokatjuhha/) 是 Zalando 的研究工程师，专注于可扩展的欺诈预测机器学习。

[原文](https://medium.freecodecamp.org/how-to-build-a-data-science-project-from-scratch-dc4f096a62a1)。经允许转载。

**资源：**

+   [在线和基于网络的：分析、数据挖掘、数据科学、机器学习教育](https://www.kdnuggets.com/education/online.html)

+   [分析、数据科学、数据挖掘和机器学习软件](https://www.kdnuggets.com/software/index.html)

**相关：**

+   [雇主希望看到的数据科学项目：如何展示商业影响](https://www.kdnuggets.com/2018/12/data-science-projects-business-impact.html)

+   [导致数据可视化效果不佳的5个常见错误](https://www.kdnuggets.com/2017/10/5-common-mistakes-bad-data-visualization.html)

+   [采用高级分析时需要避免的10个错误](https://www.kdnuggets.com/2018/07/tdwi-10-mistakes-avoid-advanced-analytics.html)

### 更多相关话题

+   [成为优秀数据科学家所需的5项关键技能](https://www.kdnuggets.com/2021/12/5-key-skills-needed-become-great-data-scientist.html)

+   [每个初学者数据科学家应掌握的6种预测模型](https://www.kdnuggets.com/2021/12/6-predictive-models-every-beginner-data-scientist-master.html)

+   [2021年最佳ETL工具](https://www.kdnuggets.com/2021/12/mozart-best-etl-tools-2021.html)

+   [停止学习数据科学以寻找目标，并找到目标去……](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)

+   [学习数据科学统计的最佳资源](https://www.kdnuggets.com/2021/12/springboard-top-resources-learn-data-science-statistics.html)

+   [构建一个可靠的数据团队](https://www.kdnuggets.com/2021/12/build-solid-data-team.html)
