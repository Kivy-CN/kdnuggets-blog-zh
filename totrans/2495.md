# 端到端机器学习初学者指南

> 原文：[https://www.kdnuggets.com/2021/12/beginner-guide-end-end-machine-learning.html](https://www.kdnuggets.com/2021/12/beginner-guide-end-end-machine-learning.html)

[评论](#comments)

**由 [Rebecca Vickery](https://www.linkedin.com/in/rebecca-vickery/)，数据科学家**

![](../Images/5c25025612f6dd042b4f295ebfef540f.png)

图片由 [Modestas Urbonas](https://unsplash.com/@modestasu?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 提供，来源于 [Unsplash](https://unsplash.com/s/photos/bridge?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业轨道。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织 IT 部门

* * *

监督机器学习是一种将一系列输入（X）映射到已知输出（y）的方法，而无需显式编程。训练机器学习模型指的是机器学习 X 和 y 之间的映射的过程。一旦训练完成，模型可以用于对新输入进行预测，而这些新输入的输出是未知的。

机器学习模型的训练只是端到端机器学习生命周期中的一个环节。为了使模型真正有用，这个映射需要被存储和部署以供使用。这通常被称为将模型投入生产。此外，一旦模型投入生产，需要监控模型的预测和整体性能，以确保预测的质量不会随着时间的推移而下降。

为了介绍端到端机器学习工作流中的基本概念，我将使用 Python 库 [Pycaret](https://pycaret.org/)。Pycaret 是一个低代码机器学习库，旨在通过提供高级编程接口并自动化机器学习中的一些重复任务，从而简化和加速整体机器学习工作流。

该库正在快速发展，最近添加了涵盖整个端到端机器学习工作流的功能。从模型开发到部署和监控。在接下来的文章中，我将使用这个包简单介绍端到端机器学习生命周期。

## 数据

在本教程中，我将使用 Pycaret 的内置数据集之一，称为“employee”。该数据集包含有关某公司员工的特征集合，以及一个目标变量，表示该员工是否离开了公司。这是一个经典的分类任务，其目标是训练一个可以预测员工是否可能离开的模型。

数据可以通过 Pycaret API 轻松导入。在下面的代码中，我们读取数据并保留一个验证样本以供后续工作流程使用。

数据的前几行如下所示：

![](../Images/49cfd8b17983d3860b8d5ce5eaf01393.png)

“employee” 数据集的前几行。图像来源：作者。

## 预处理

Pycaret 有一组模块，包含特定机器学习任务的一套功能。我们使用的数据集包含一个分类问题，因此我们将主要使用[classification](https://pycaret.org/classification1/)模块。

第一步是导入 setup 函数。此函数在执行其他任何步骤之前运行。它初始化 Pycaret 环境，并创建一个用于数据预处理的转换管道，以便为建模做好准备。运行时，Pycaret 将推断所有特征和目标列的数据类型。

![](../Images/c630fd0613c57ffd1d147bf07945cd7d.png)

Pycaret 已经推断了特征和目标变量的数据类型。图像来源：作者

如果我们对这些数据类型的准确性感到满意，并且也愿意依赖 Pycaret 的默认预处理方法，那么我们可以直接按回车键，Pycaret 将为建模准备数据，并打印一份报告，描述所采取的步骤。

下面仅展示了这份 59 行报告的前 15 行。setup 函数具有大量可选参数，可用于创建自定义预处理。例如，参数 `categorical_features` 可以用来手动指定数据类型未正确推断的分类列。完整的参数列表可以在[**这里**](https://pycaret.org/classification1/)找到。

![](../Images/0bfe60a344fcce2e2edc55080270eecb.png)

预处理报告的前 15 行。图像来源：作者。

在实际的机器学习项目中，我们可能会进行更深入的探索性分析和自定义预处理。然而，出于本教程的目的，我们将继续使用默认的预处理方法。

## 基线模型

通常，在机器学习工作流程中，首先训练一个简单模型以建立性能基线，然后再转向更复杂的算法是明智的。

撰写本文时，Pycaret支持18种不同的分类算法。完整列表可以在[**这里**](https://pycaret.org/classification1/)找到。对于基线模型，我们将使用逻辑回归，并使用`create_model`函数进行训练。为了选择算法，我们传入在[**文档**](https://pycaret.org/classification1/)中找到的缩写字符串。训练后，Pycaret 将打印一份报告，详细说明我们模型的性能。

![](../Images/4e8bc2576bdd246ea8893218e81e4f0d.png)

create_model报告。图像来源：作者。

## 比较模型

通过建立基线模型，我们确定了预处理和设置足以构建一个分类模型。

下一步是比较不同的分类算法，以确定哪一种算法最适合我们的数据集和问题。Pycaret 具有一个名为`compare_models()`的函数，允许我们用一行代码比较所有可用算法的性能。

该函数将尝试所有算法，并输出按准确度排名的列表。你可以使用`sort`参数更改目标度量。

![](../Images/4a27c8523babf3438492294772729d77.png)

比较模型。图像来源：作者。

从中我们可以看出，随机森林整体上是最佳模型。我们将在接下来的工作流程中使用这个模型。

我们再次运行`create_model()`，这次选择了随机森林算法。

## 调整模型

当我们运行create_model时，它会自动使用默认参数。这些参数不一定是最佳选择，因此我们需要调整模型以找到最佳选择。运行`tune_model()`函数可以使用随机网格搜索调整模型的超参数。

默认情况下，该函数将使用预定义的参数网格，但可以通过将自定义网格传递给`custom_grid`参数进行自定义。默认情况下，该函数还会优化准确度分数，但这也可以通过使用`optimize`参数进行自定义。

在下面的代码中，我们使用默认的参数网格来调整模型，并优化MCC分数。

该函数返回一个包含k折验证分数的表格，默认情况下折数为10。

![](../Images/2bcd1ed3f1e6ec46b0f4ca7a320e4fb3.png)

模型调优。图像来源：作者。

## 解释结果

Pycaret 提供了一系列内置图表来解释模型的结果，可以通过`plot_model()`函数访问。

下面我们使用此函数检查特征重要性。

![](../Images/1560351111f77ff35f6513760d61638d.png)

特征重要性。图像来源：作者。

让我们也可视化混淆矩阵。

![](../Images/ae9263af2e92e6e47d39ff78c3e1c6a0.png)

混淆矩阵。图像来源：作者。

## 部署模型

Pycaret 具有将模型部署到云端的额外功能，使用AWS。

要在AWS上部署模型，你必须首先在[aws.amazon.com](https://aws.amazon.com/?aws-products-analytics.sort-by=item.additionalFields.productNameLowercase&aws-products-analytics.sort-order=asc&aws-products-business-apps.sort-by=item.additionalFields.productNameLowercase&aws-products-business-apps.sort-order=asc&aws-products-containers.sort-by=item.additionalFields.productNameLowercase&aws-products-containers.sort-order=asc&aws-products-compute.sort-by=item.additionalFields.productNameLowercase&aws-products-compute.sort-order=asc&aws-products-iot.sort-by=item.additionalFields.productNameLowercase&aws-products-iot.sort-order=asc&aws-products-ml.sort-by=item.additionalFields.productNameLowercase&aws-products-ml.sort-order=asc&aws-products-mgmt-govern.sort-by=item.additionalFields.productNameLowercase&aws-products-mgmt-govern.sort-order=asc&aws-products-migration.sort-by=item.additionalFields.productNameLowercase&aws-products-migration.sort-order=asc&aws-products-network.sort-by=item.additionalFields.productNameLowercase&aws-products-network.sort-order=asc&aws-products-security.sort-by=item.additionalFields.productNameLowercase&aws-products-security.sort-order=asc&aws-products-storage.sort-by=item.additionalFields.productNameLowercase&aws-products-storage.sort-order=asc)创建一个账户。创建后，你需要生成一个访问密钥，以便允许Pycaret函数写入你的账户。为此，请按照以下步骤操作。

1.  登录到你的AWS账户。

1.  将鼠标悬停在右上角的用户名上。

1.  从出现的列表中选择安全凭证。

![](../Images/52584398b80295476026df73f3e831d4.png)

4. 从这里展开访问密钥部分，然后点击“创建新的访问密钥”。

![](../Images/416c07d6225c52cc4fda26f6470cefcf.png)

5. 在这个阶段，当提示时，你需要下载凭证文件。稍后你需要用到这个凭证文件。

6. 为了允许Pycaret与您的AWS账户互动，你还需要安装和配置AWS CLI。为此，请首先运行以下命令。

```py
curl "[https://awscli.amazonaws.com/AWSCLIV2.pkg](https://awscli.amazonaws.com/AWSCLIV2.pkg)" -o "AWSCLIV2.pkg"
```

然后运行以下命令：

```py
sudo installer -pkg ./AWSCLIV2.pkg -target /
```

现在输入`aws --version`以确认所有内容已正确安装。你应该会看到类似的信息。

![](../Images/5dc1e7f7df4d3961bdcb766a084d1f33.png)

现在我们可以使用你的账户详细信息来配置AWS CLI。为此，运行下面显示的命令。它会要求你输入以下信息。

**AWS Access Key ID:** 可以在我们之前下载的凭证文件中找到。

**AWS Secret Access Key:** 也在凭证文件中找到。

**Default region name:** 这个可以在AWS控制台中找到。

**Default output format:** 这应该留空。

接下来，我们创建一个S3存储桶来存储部署的模型。在AWS控制台中选择S3，然后创建一个你选择名称的存储桶。

![](../Images/1b7ec21bd4227ca8a36a3f572e2e27ca.png)

现在我们可以使用Pycaret来部署我们选择的模型了。

如果模型已经部署，你将看到以下消息。

![](../Images/501c85c4c20ae528ec98ea30363a7d42.png)

## 生成预测

为了使用模型，我们在之前保留的验证数据上生成预测。

以下代码从S3加载模型，并在移除标签的验证数据上生成预测。

让我们通过运行`predictions[:5]`来查看前5个预测。

![](../Images/26fb52f2644e9659db825ed6023f07b2.png)

前5个预测。图片由作者提供

## 监控

生产机器学习工作流的一个重要方面是跟踪和监控执行的实验。Pycaret与[MLflow](https://mlflow.org/)集成，MLflow是一个用于管理端到端机器学习生命周期的开源平台。

为了通过Pycaret使用MLflow，我们需要导入MLflow（这应该已经与Pycaret一起安装）并设置跟踪URI。然后在调用设置函数时，我们添加几个额外的参数，如下所示。

现在，如果我们将跟踪URI复制到浏览器中，你应该能看到mlflow UI和它所跟踪的实验。

![](../Images/054eeebb587f788c4a96221b887e64ab.png)

mlflow UI。图片由作者提供

我们可以点击查看每个实验执行的指标、工件和参数。

![](../Images/2e68e1947cc88ad8c8520b24016fee1d.png)

实验跟踪。图片由作者提供

这是一个简单的教程，用于学习端到端机器学习项目的基本步骤。在现实世界中，大多数机器学习问题、数据和部署解决方案需要更复杂的处理。然而，为了本教程的目的，我使用了一个简单的数据集和Python库，以帮助你入门学习端到端的机器学习生命周期。

Pycaret是一个低代码机器学习库的例子。正在开发的许多工具试图以不同的方式简化机器学习开发。要了解更多关于这些低工作量的机器学习库的信息，请参见我之前的文章。

[**低工作量机器学习工具**](https://towardsdatascience.com/low-effort-machine-learning-tools-9622d7d57135)

欲了解更多关于现实世界中机器学习的信息，请参阅下面的文章。

[**现实生活中的机器学习**](https://towardsdatascience.com/machine-learning-in-real-life-eebcb08f099c)

感谢阅读！

**简介: [Rebecca Vickery](https://www.linkedin.com/in/rebecca-vickery/)** 是一位数据科学家，拥有丰富的数据分析、机器学习和数据工程经验。拥有12年的SQL经验，4年以上的Python、R、Apache Airflow和Google Analytics经验。

**相关：**

+   [你不知道的10件关于Scikit-Learn的事](/2020/09/10-things-know-scikit-learn.html)

+   [五个用于数据科学的命令行工具](/2019/07/five-command-line-tools-data-science.html)

+   [可解释的机器学习Python库](/2019/09/python-libraries-interpretable-machine-learning.html)

### 更多相关话题

+   [将机器学习算法完整部署到生产环境中](https://www.kdnuggets.com/2021/12/deployment-machine-learning-algorithm-live-production-environment.html)

+   [5 款最佳端到端开源 MLOps 工具](https://www.kdnuggets.com/5-best-end-to-end-open-source-mlops-tools)

+   [用 HuggingFace 实现的简单端到端项目](https://www.kdnuggets.com/a-simple-to-implement-end-to-end-project-with-huggingface)

+   [2024 年必试的 7 个端到端 MLOps 平台](https://www.kdnuggets.com/7-end-to-end-mlops-platforms-you-must-try-in-2024)

+   [必备机器学习算法：初学者指南](https://www.kdnuggets.com/2021/05/essential-machine-learning-algorithms-beginners.html)

+   [初学者指南：十大机器学习算法](https://www.kdnuggets.com/a-beginner-guide-to-the-top-10-machine-learning-algorithms)
