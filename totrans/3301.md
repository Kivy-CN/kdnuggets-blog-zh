# 7个步骤掌握 Python 数据准备

> 原文：[https://www.kdnuggets.com/2017/06/7-steps-mastering-data-preparation-python.html/2](https://www.kdnuggets.com/2017/06/7-steps-mastering-data-preparation-python.html/2)

### 第4步：处理异常值

这不是一个关于在建模时处理数据中异常值的策略教程；在建模中包含异常值有时是合适的，有时则不然（无论有人试图告诉你什么）。这取决于情况，没有人能对你的情况是否属于A列或B列做出笼统的断言。

![异常值](../Images/83f05baa9ceceac3e6681aadf81698c0.png)

你能找到异常值吗？

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT。

* * *

处理异常值的一些讨论：

+   [异常值：是删除还是不删除](http://www.theanalysisfactor.com/outliers-to-drop-or-not-to-drop/)，分析因素

+   [删除数据中的异常值是否可以？](https://stats.stackexchange.com/questions/200534/is-it-ok-to-remove-outliers-from-data/200923)，Stack Exchange

异常值可能是由于数据收集不良导致的，也可能是确实好的、异常的数据。这是两种不同的情况，必须以不同的方式处理，因此没有适用于所有情况的“一刀切”建议，这与处理缺失值类似。来自上面分析因素文章的一个特别好的见解如下：

> 一个选项是尝试转换。平方根和对数转换都能将高数值拉回。这可以使假设在异常值是因变量时效果更好，如果异常值是自变量，也可以减少单点的影响。

我们将把是否在数据集中保留异常值的决定权留给你。然而，如果你的模型确实需要以某种方式处理异常值数据，这里有一些方法讨论：

+   [处理异常值的3种方法](/2017/01/3-methods-deal-outliers.html)，作者：Alberto Quesada

+   [使用标准差在 Python 中移除异常值](/2017/02/removing-outliers-standard-deviation-python.html)，作者：Punit Jajodia

+   [在 Pandas DataFrame 中使用百分位数移除异常值](https://stackoverflow.com/questions/35827863/remove-outliers-in-pandas-dataframe-using-percentiles)，Stack Overflow

### 第5步：处理不平衡数据

那么，如果你的数据集本身很健全——既没有缺失值也没有异常值——但由两个类别组成：一个包含95%的实例，另一个仅包含5%？或者更糟——99.8%对0.2%？

如果是这样，那么你的数据集在类别方面是不平衡的。这可能会引发问题，我相信这些问题不需要特别指出。但暂时不要将数据抛到一边；当然，有应对这种情况的策略。

请注意，虽然这可能不真正是一个数据准备任务，但这种数据集特征会在数据准备阶段早期显现出来（EDA的重要性），并且这种数据的有效性在准备阶段肯定可以进行初步评估。

首先，看看汤姆·福塞特关于如何处理这种情况的讨论：

+   [从不平衡类别中学习](/2016/08/learning-from-imbalanced-classes.html)，作者：汤姆·福塞特

接下来，看看这个关于处理类别不平衡的技术讨论：

+   [7种处理不平衡数据的技术](/2017/06/7-techniques-handle-imbalanced-data.html)，作者：叶武 & 里克·拉德瓦根

![不平衡的数据](../Images/c9cbb484ef13d59bff657b921d1b6624.png)

识别和处理不平衡是很重要的。

关于我们为什么会遇到不平衡数据的一个很好的解释，以及为什么在某些领域我们会比在其他领域更频繁地遇到这种情况（来自上述链接的《7种处理不平衡数据的技术》）：

> 这些领域中使用的数据通常少于1%的稀有但“有趣”的事件（例如，信用卡欺诈者、用户点击广告或受损服务器扫描其网络）。然而，大多数机器学习算法在处理不平衡数据集时表现并不好。以下七种技术可以帮助你训练一个分类器来检测异常类别。

### 第6步：数据转换

维基百科定义了[数据转换](https://en.wikipedia.org/wiki/Data_transformation_(statistics))为：

> 在统计学中，数据转换是对数据集中每个点应用一个确定性的数学函数——也就是说，每个数据点 zi 被替换为转换后的值 *y[i]* = *f(z[i])*，其中 *f* 是一个函数。转换通常是为了使数据更符合将要应用的统计推断程序的假设，或提高图形的可解释性或外观。

数据转换是数据准备中最重要的方面之一，比大多数其他方面更需要技巧。当数据中出现缺失值时，通常很容易找到，并且可以通过上述常见方法（至少从表面上看）来处理，或者通过在特定领域积累的复杂措施来应对。然而，何时以及是否需要数据转换——更不用说所需的转换类型——往往不那么容易识别。

存在大量变换；与其尝试概括变换何时以及为何有用，不如我们看看一些具体的变换，以便更好地理解它们。

Scikit-learn 文档中的这个概述提供了对一些最重要的预处理变换的合理解释，即标准化、归一化和二值化（以及一些其他变换）：

+   [数据预处理](http://scikit-learn.org/stable/modules/preprocessing.html)，Scikit-learn 文档

![独热编码](../Images/5fadf8e114fa3bd5734554c29040064e.png)

独热编码变换的示例结果。

独热编码“将分类特征转换为与分类和回归算法更兼容的格式”（取自下面的第一个链接）。请查看以下对独热编码变换的讨论，以及使用 Pandas 的方法：

+   [什么是独热编码，它在数据科学中何时使用？](https://www.quora.com/What-is-one-hot-encoding-and-when-is-it-used-in-data-science/answer/H%C3%A5kon-Hapnes-Strand)，Quora 上 Håkon Hapnes Strand 的回答

+   [如何在 Python 中进行独热编码？](http://stackoverflow.com/questions/37292872/how-can-i-one-hot-encode-in-python)，Stack Overflow

对数分布变换在“你假设模型形式是非线性的但可以转换为线性模型”时可能会很有用（如下文所述）。请稍微了解一下这种被低估的变换类型：

+   [何时（以及为什么）应该对分布（的数字）取对数？](https://stats.stackexchange.com/questions/18844/when-and-why-should-you-take-the-log-of-a-distribution-of-numbers)，Stack Exchange

如上所述，根据数据和你的需求，可能有许多变换。未来我会更详细地探讨数据变换，并在那时进行更深入的讨论。

请注意，这整个讨论也完全且故意跳过了对特征选择的提及，原因很简单：它需要比这更详细的讨论。有关特征选择的类似指南即将推出，完成后将链接于此。

### 第七步：最终修饰与前进

好了。你的数据已经“干净”。就我们的目的而言，这意味着你现在有一个有效且可用的 Pandas DataFrame。但你该如何处理它呢？

如果你想直接将数据输入机器学习算法以尝试构建模型，你可能需要将数据转换为更合适的表示。在 Python 生态系统中，这通常是一个 numpy ndarray（或矩阵）。你可以参考以下内容以获取一些初步的思路（从基础角度来看）：

+   [将 Pandas Dataframe 转换为数组并评估多元线性回归模型](https://stackoverflow.com/questions/28334091/turning-a-pandas-dataframe-to-an-array-and-evaluate-multiple-linear-regression-m)，Stack Overflow

![ML pipeline](../Images/2b1892e803954b3888cf48f32e0c71b7.png)

非常简单的数据准备过程。

一旦你在 Python 中获得了干净的数据并以适当的形式进行表示，为什么不查看以下一对文章，它们正好覆盖了你现在准备好的领域：

+   [掌握 Python 机器学习的 7 个步骤](/2015/11/seven-steps-machine-learning-python.html)，作者：Matthew Mayo

+   [掌握 Python 机器学习的 7 个额外步骤](/2017/03/seven-more-steps-machine-learning-python.html)，作者：Matthew Mayo

如果你还不想继续进行建模，或者你确实想继续，但希望将数据输出为更适合你情况的存储形式，这里有一些关于 Pandas DataFrame 存储的信息：

+   [将 Pandas DataFrame 写入 MySQL](https://stackoverflow.com/questions/39939716/writing-a-pandas-dataframe-to-mysql)，Stack Overflow

+   [快速 HDF5 与 Pandas](https://dzone.com/articles/quick-hdf5-pandas)，作者：Giuseppe Vettigli

不要忘记，在继续之前，还需要考虑一些数据集特定和相关的因素，包括（尤其？）将数据集拆分为训练集和测试集，这是适用于所有类型机器学习任务的过程：

+   [Numpy: 如何将数据集（数组）拆分/分区为训练集和测试集，例如交叉验证？](https://stackoverflow.com/questions/3674409/numpy-how-to-split-partition-a-dataset-array-into-training-and-test-datasets)，Stack Overflow

+   [是否有一个 Python 函数可以将数据拆分为训练集、交叉验证集和测试集？](https://www.quora.com/Is-there-a-Python-function-that-splits-data-into-train-cross-validation-and-test-sets/answer/Harizo-Rajaona)，Quora 答案，Harizo Rajaona

作为纯粹的惩罚，这里有一些关于数据准备的一般性额外看法：

+   [在 Python 中整理数据](/2017/01/tidying-data-python.html)，作者：Jean-Nicholas Hould

+   [数据科学实战：Kaggle 实践第 3 部分 – 清理数据](/2016/06/doing-data-science-kaggle-walkthrough-data-cleaning.html)，作者：Brett Romero

+   [从头开始的 Python 机器学习工作流 第 1 部分：数据准备](/2017/05/machine-learning-workflows-python-scratch-part-1.html)，作者：Matthew Mayo

**相关内容：**

+   [理解 NoSQL 数据库的 7 个步骤](/2016/07/seven-steps-understanding-nosql-databases.html)

+   [掌握数据科学 SQL 的 7 个步骤](/2016/06/seven-steps-mastering-sql-data-science.html)

+   [理解深度学习的 7 个步骤](/2016/01/seven-steps-deep-learning.html)

### 更多相关主题

+   [每个数据科学家都应该了解的三个 R 库（即使你使用 Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)

+   [使用管道编写干净的Python代码](https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html)

+   [是什么让Python成为初创公司的理想编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)

+   [停止学习数据科学以寻找目标，并以目标来…](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)

+   [成为优秀数据科学家所需的5项关键技能](https://www.kdnuggets.com/2021/12/5-key-skills-needed-become-great-data-scientist.html)

+   [每个初学者数据科学家应掌握的6种预测模型](https://www.kdnuggets.com/2021/12/6-predictive-models-every-beginner-data-scientist-master.html)
