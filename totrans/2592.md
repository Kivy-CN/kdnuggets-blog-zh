# 使用 PyCaret 进行多重时间序列预测

> 原文：[https://www.kdnuggets.com/2021/04/multiple-time-series-forecasting-pycaret.html](https://www.kdnuggets.com/2021/04/multiple-time-series-forecasting-pycaret.html)

[评论](#comments)

**由 [Moez Ali](https://www.linkedin.com/in/profile-moez/)，PyCaret 的创始人和作者**

![](../Images/c05ecb6b401ed3f08fb023e361b80252.png)

PyCaret — 一个开源的低代码机器学习库

### PyCaret

PyCaret 是一个开源的低代码机器学习库和端到端模型管理工具，构建于 Python 上，用于自动化机器学习工作流。它因其易用性、简单性以及快速高效地构建和部署端到端 ML 原型的能力而广受欢迎。

PyCaret 是一个替代的低代码库，可以用几行代码替代成百上千行代码。这使得实验周期变得极快且高效。

PyCaret 是**简单且** **易于使用**的。在 PyCaret 中执行的所有操作都会依次存储在一个**管道**中，该管道完全自动化以**便于部署**。无论是填补缺失值、独热编码、转换分类数据、特征工程，还是超参数调优，PyCaret 都能自动完成。

本教程假设你对 PyCaret 有一定的先前知识和经验。如果你以前没有使用过，没关系——你可以通过以下教程快速入门：

+   [PyCaret 2.2 发布了——有什么新变化](https://towardsdatascience.com/pycaret-2-2-is-here-whats-new-ad7612ca63b)

+   [宣布 PyCaret 2.0](https://towardsdatascience.com/announcing-pycaret-2-0-39c11014540e)

+   [你不知道的 PyCaret 五件事](https://towardsdatascience.com/5-things-you-dont-know-about-pycaret-528db0436eec)

### **总结**

在我[上一个教程](https://towardsdatascience.com/time-series-forecasting-with-pycaret-regression-module-237b703a0c63)中，我演示了如何通过[PyCaret 回归模块](https://pycaret.readthedocs.io/en/latest/api/regression.html)使用 PyCaret 预测时间序列数据。如果你还没有阅读那篇文章，你可以在继续阅读本教程之前，先阅读[使用 PyCaret 回归模块进行时间序列预测](https://towardsdatascience.com/time-series-forecasting-with-pycaret-regression-module-237b703a0c63)教程，因为本教程基于上一个教程中涉及的一些重要概念。

### 安装 PyCaret

安装 PyCaret 非常简单，只需几分钟。我们强烈推荐使用虚拟环境，以避免与其他库发生潜在的冲突。

PyCaret 的默认安装是 pycaret 的精简版，仅安装列在[这里](https://github.com/pycaret/pycaret/blob/master/requirements.txt)的硬性依赖项。

[PRE0]

当你安装 pycaret 的完整版时，所有的可选依赖项也会被安装，详细列表请见[这里](https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt)。

### ???? PyCaret回归模块

PyCaret**回归模块**是一个监督学习模块，用于估计**因变量**（通常称为“结果变量”或“目标”）与一个或多个**自变量**（通常称为“特征”或“预测变量”）之间的关系。

回归的目标是预测连续值，如销售额、数量、温度、顾客数量等。PyCaret中的所有模块提供了许多[预处理](https://www.pycaret.org/preprocessing)功能，通过[setup](https://www.pycaret.org/setup)函数来准备数据以进行建模。它拥有超过25种现成的算法和[若干图表](https://www.pycaret.org/plot-model)来分析训练模型的性能。

### ???? 数据集

在本教程中，我将展示多时间序列数据预测的端到端实现，包括训练和预测未来值。

我使用了Kaggle上的[Store Item Demand Forecasting Challenge](https://www.kaggle.com/c/demand-forecasting-kernels-only)数据集。该数据集包含10个不同的商店，每个商店有50个商品，即总共有500个日级别时间序列数据，时间跨度为五年（2013–2017）。

![](../Images/df759b487e1be619cd86c59ff474a925.png)

样本数据集

### ???? 加载和准备数据

[PRE1]

![](../Images/cee173d1e1b85ba3bf47c84c1805d384.png)

数据的样本行

[PRE2]

### ???? 可视化时间序列

[PRE3]

![](../Images/9d91598b4177e08e4a34837cc6145ecf.png)

store_1_item_1时间序列和30天移动平均

![](../Images/af2b1fa012292c287ca1c33f2da7257d.png)

store_2_item_1时间序列和30天移动平均

### ???? 开始训练过程

现在数据已经准备好了，让我们开始训练循环。注意在所有函数中`verbose = False`以避免在训练时在控制台上打印结果。

下面的代码是围绕我们在数据准备步骤中创建的`time_series`列的循环。总共有150个时间序列（10个商店 x 50个商品）。

以下第10行代码是为了过滤数据集中的`time_series`变量。循环中的第一部分是初始化`setup`函数，然后是`compare_models`以找到最佳模型。第24–26行捕捉结果，并将最佳模型的性能指标添加到一个名为`all_results`的列表中。代码的最后一部分使用`finalize_model`函数在整个数据集上重新训练最佳模型，包括测试集中剩余的5%，并将整个管道（包括模型）保存为pickle文件。

[https://gist.github.com/moezali1/f258195ba1c677654abffb0d1acb2cc0](https://gist.github.com/moezali1/f258195ba1c677654abffb0d1acb2cc0)

现在我们可以从`all_results`列表中创建一个数据框。它将显示每个时间序列选择的最佳模型。

[PRE4]

![](../Images/fb374f6e8afef94f8a2aef439173c3dd.png)

从concat_results中提取的sample_rows

### 训练过程????

![图示](../Images/425b2d2a63ec2c98390fbf8da89b63ad.png)

训练过程

### ???? 使用训练过的模型生成预测

现在我们已经训练了模型，让我们用它们来生成预测，但首先，我们需要创建用于评分的数据集（X 变量）。

[PRE5]

![](../Images/19a1fa56fa27d09a4afb8919582a888b.png)

从 score_df 数据集中取样行

现在让我们创建一个循环来加载训练好的管道，并使用 `predict_model` 函数生成预测标签。

[PRE6]

![](../Images/e4eba32882da3ce5ace399f07c02ec61.png)

从 concat_df 中取样行

我们现在将 `data` 和 `concat_df` 结合起来。

[PRE7]

![](../Images/68ab2e1ee3847753490af9aed8f84f82.png)

从 final_df 中取样行

我们现在可以创建一个循环来查看所有图表。

[PRE8]

![](../Images/6bad75640eafb65d8759b7a89ee53ebf.png)

store_1_item_1 实际销售和预测标签

![](../Images/741088670e001a6d1420457e739fc2d4.png)

store_2_item_1 实际销售和预测标签

我希望你能欣赏 PyCaret 的易用性和简单性。在不到 50 行代码和一小时的实验时间内，我已经训练了超过 10,000 个模型（25 个估计器 × 500 个时间序列），并将 500 个最佳模型投入生产以生成预测。

### 敬请期待！

下周我将撰写一篇关于使用 [PyCaret 异常检测模块](https://pycaret.readthedocs.io/en/latest/api/anomaly.html) 进行时间序列数据无监督异常检测的教程。请关注我的 [Medium](https://medium.com/@moez-62905)、[LinkedIn](https://www.linkedin.com/in/profile-moez/) 和 [Twitter](https://twitter.com/moezpycaretorg1) 以获取更多更新。

使用这个轻量级的 Python 工作流自动化库，你可以实现无限的可能。如果你觉得这很有用，请不要忘记在我们的 GitHub 仓库上给我们 ⭐️。

想了解更多关于 PyCaret 的信息，请关注我们的 [LinkedIn](https://www.linkedin.com/company/pycaret/) 和 [Youtube](https://www.youtube.com/channel/UCxA1YTYJ9BEeo50lxyI_B3g)。

加入我们的 Slack 频道。邀请链接 [这里](https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg)。

### 你可能也会对以下内容感兴趣：

[在 Power BI 中使用 PyCaret 2.0 自建 AutoML](https://towardsdatascience.com/build-your-own-automl-in-power-bi-using-pycaret-8291b64181d)

[在 Azure 上使用 Docker 部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-pipeline-on-cloud-using-docker-container-bec64458dc01)

[在 Google Kubernetes Engine 上部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-model-on-google-kubernetes-engine-94daac85108b)

[在 AWS Fargate 上部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-pipeline-on-aws-fargate-eb6e1c50507)

[构建并部署你的第一个机器学习网页应用](https://towardsdatascience.com/build-and-deploy-your-first-machine-learning-web-app-e020db344a99)

[使用 AWS Fargate 无服务器架构部署 PyCaret 和 Streamlit 应用](https://towardsdatascience.com/deploy-pycaret-and-streamlit-app-using-aws-fargate-serverless-infrastructure-8b7d7c0584c2)

[使用 PyCaret 和 Streamlit 构建并部署机器学习 web 应用](https://towardsdatascience.com/build-and-deploy-machine-learning-web-app-using-pycaret-and-streamlit-28883a569104)

[在 GKE 上部署使用 Streamlit 和 PyCaret 构建的机器学习应用](https://towardsdatascience.com/deploy-machine-learning-app-built-using-streamlit-and-pycaret-on-google-kubernetes-engine-fd7e393d99cb)

### 重要链接

[文档](https://pycaret.readthedocs.io/en/latest/installation.html)

[博客](https://medium.com/@moez_62905)

[GitHub](https://www.github.com/pycaret/pycaret)

[StackOverflow](https://stackoverflow.com/questions/tagged/pycaret)

[安装 PyCaret](https://pycaret.readthedocs.io/en/latest/installation.html) [Notebook 教程](https://pycaret.readthedocs.io/en/latest/tutorials.html) [在 PyCaret 中贡献](https://pycaret.readthedocs.io/en/latest/contribute.html)

### 想了解特定模块吗？

点击下面的链接查看文档和实际示例。

[分类](https://pycaret.readthedocs.io/en/latest/api/classification.html) [回归](https://pycaret.readthedocs.io/en/latest/api/regression.html)

[聚类](https://pycaret.readthedocs.io/en/latest/api/clustering.html)

[异常检测](https://pycaret.readthedocs.io/en/latest/api/anomaly.html)

[自然语言处理](https://pycaret.readthedocs.io/en/latest/api/nlp.html) [关联规则挖掘](https://pycaret.readthedocs.io/en/latest/api/arules.html)

**简介：[Moez Ali](https://www.linkedin.com/in/profile-moez/)** 是数据科学家，也是 PyCaret 的创始人和作者。

[原文](https://towardsdatascience.com/multiple-time-series-forecasting-with-pycaret-bc0a779a22fe)。转载已获许可。

**相关：**

+   [使用 PyCaret 回归模块进行时间序列预测](/2021/04/time-series-forecasting-pycaret-regression-module.html)

+   [使用 PyCaret 进行自动化异常检测](/2021/04/automated-anomaly-detection-pycaret.html)

+   [将机器学习管道部署到云端，使用 Docker 容器](/2020/06/deploy-machine-learning-pipeline-cloud-docker.html)

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业的快车道。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织在 IT 方面

* * *

### 更多相关话题

+   [使用 Ploomber、Arima、Python 和 Slurm 进行时间序列预测](https://www.kdnuggets.com/2022/03/time-series-forecasting-ploomber-arima-python-slurm.html)

+   [使用 statsmodels 和 Prophet 的时间序列预测](https://www.kdnuggets.com/2023/03/time-series-forecasting-statsmodels-prophet.html)

+   [利用 XGBoost 进行时间序列预测](https://www.kdnuggets.com/2023/08/leveraging-xgboost-timeseries-forecasting.html)

+   [如何管理 Python 中的多重继承](https://www.kdnuggets.com/2022/03/manage-multiple-inheritance-python.html)

+   [使用 PyCaret 的二分类介绍](https://www.kdnuggets.com/2021/12/introduction-binary-classification-pycaret.html)

+   [使用 PyCaret 的 Python 聚类介绍](https://www.kdnuggets.com/2021/12/introduction-clustering-python-pycaret.html)
