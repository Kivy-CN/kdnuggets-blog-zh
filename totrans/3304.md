# Python中的机器学习工作流从零开始 第1部分：数据准备

> 原文：[https://www.kdnuggets.com/2017/05/machine-learning-workflows-python-scratch-part-1.html](https://www.kdnuggets.com/2017/05/machine-learning-workflows-python-scratch-part-1.html)

似乎现在，机器学习的认知常常被简化为将一系列参数传递给越来越多的库和API，希望能见到奇迹，并等待结果。也许你对这些库内部的运作有很好的了解——从数据准备到模型构建，再到结果解释和可视化及其他——但你仍然依赖这些各种工具来完成工作。

![Python ML](../Images/121f3d758c7beab31102198c7374013c.png)

Python中的机器学习工作流。从零开始。

这没问题。使用经过充分测试和验证的工具来执行常规任务是有意义的。重新发明那些滚动不畅的轮子不是最佳实践……这很有限，而且花费不必要的时间。无论你是使用开源工具还是专有工具来完成工作，这些实现都经过团队的打磨，确保你可以使用最优质的工具来实现目标。

然而，即使是作为一种教育尝试，亲自做那些繁琐的工作也常常是有价值的。我不会建议你从头开始编写自己的分布式深度学习训练框架——至少，通常不建议这样做——但至少经历一次从零开始编写自己的算法实现和支持工具的试炼和考验是一个很好的主意。我可能错了，但我认为今天大多数学习机器学习、数据科学、人工智能或*<< 插入相关流行词 >>*的人实际上并没有这样做。

所以让我们从零开始构建一些Python中的机器学习工作流。

### 我们所说的“从头开始”是什么意思？

首先，让我们澄清一下：当我说“从头开始”时，我的意思是尽可能少地使用辅助工具。这是相对的，但为了我们的目的，我会把界限设在编写自己的矩阵、数据框和/或图形库这边，因此我们将分别依赖numpy、pandas和matplotlib。在某些情况下，我们甚至不会使用这些库的所有可用功能，正如我们稍后将看到的那样，为了更好地理解，我们会绕过它们。标准Python库中的任何东西也都可以使用。但除此之外，我们要自己动手。

我们需要从某个地方开始，因此这篇文章将首先介绍一些简单的数据准备任务。我们将慢慢开始，但在感受我们正在做什么之后，会在接下来的几篇文章中迅速增加内容。除了数据准备之外，我们还需要额外的数据转换、结果解释和可视化工具——更不用说机器学习算法——来完成我们的旅程，所有这些我们都会涉及到。

这个想法是手动拼凑出完成我们机器学习任务所需的所有非平凡功能。随着系列的展开，我们可以添加新的工具和算法，以及重新思考我们之前的一些假设，使整个过程既具有迭代性，又具有进步性。一步一步地，我们将关注我们的目标，制定实现目标的策略，使用Python实现这些策略，然后测试它们是否有效。

目前设想中的最终结果将是一个由**简单**Python模块组成的**简单**机器学习库。对于初学者来说，我相信这将是理解机器学习过程、工作流和算法运作的宝贵经验。

### 我们所说的工作流是什么意思？

工作流对不同的人可能意味着不同的东西，但我们通常指的是被视为机器学习项目一部分的整个过程。有许多[流程框架](/2016/03/data-science-process-rediscovered.html)可以帮助我们跟踪我们在做什么，但我们暂时将其简化为以下内容：

+   获取一些数据

+   处理和/或准备数据

+   构建模型

+   解释结果

我们可以在进行过程中详细探讨这些内容，但目前这就是我们简单的机器学习流程框架。此外，“管道”意味着能够将工作流功能串联在一起，因此我们在前进的过程中也会牢记这一点。

![](../Images/8c3fd95a2ad1af6bf6aab320fe16eeb7.png)

非常简单的机器学习流程框架。

### 获取我们的数据

在构建任何模型之前，我们需要一些数据，并且需要确保这些数据符合一些合理的期望。为了测试目的（不是训练/测试的意义，而是测试我们的基础设施），我们将使用鸢尾花数据集，[你可以在这里下载](https://raw.githubusercontent.com/uiuc-cse/data-fa14/gh-pages/data/iris.csv)。鉴于在线可以找到各种版本的数据集，我建议我们都从相同的原始数据开始，以确保我们的准备步骤都有效。

让我们来看一下：

![鸢尾花头部](../Images/a1b16b920d9db20d37557fb649789604.png)

根据我们对这样一个简单数据集及其文件的了解，我们首先需要考虑从原始数据到结果我们需要做什么：

+   数据存储在CSV文件中

+   实例主要由数值属性值组成

+   类别是分类文本

现在，以上所述的内容并不普遍适用于*所有*数据集，但也并非特定于*这个*数据集。这给了我们一个编写代码的机会，希望我们可以在未来重用这些代码。我们在这里关注的良好编码实践将包括可重用性和模块化。

以下展示了一些简单的[探索性数据分析](/2017/04/value-exploratory-data-analysis.html)。

![鸢尾花描述](../Images/b92651aef94bc787ab47401ac1b5bad2.png)

![鸢尾花直方图](../Images/60acdb508037bf752b6dd1d35d72a6fe.png)

对鸢尾花数据集的非常简单的探索性数据分析：数据集描述（上文），以及默认属性分布直方图（下文）。

### 准备我们的数据

虽然在这种特定情况下我们所需的数据准备工作是最小的，但仍然需要一些处理。具体来说，我们需要确保考虑头部行，移除pandas自动执行的任何索引，并将类别值从名义型转换为数值型。由于我们在用于建模的特征中没有名义值，因此不会需要更复杂的转换——至少，目前不需要。

最终，我们还需要为我们的算法提供更好的数据表示，因此我们会确保在继续之前得到一个矩阵——或者numpy ndarray。我们的数据准备工作流程应该如下所示：

![数据处理准备过程框架](../Images/2b1892e803954b3888cf48f32e0c71b7.png)

非常简单的数据准备过程。

此外，请注意，并没有理由相信所有有趣的数据都存储在以逗号分隔的文件中。我们可能想在某个时候从SQL数据库或直接从网络上获取数据，未来我们将回到这一点。

首先，让我们编写一个简单的函数，将CSV文件加载到DataFrame中；当然，直接编写代码很简单，但考虑到未来我们可能想要在数据集加载函数中添加一些额外的步骤。相信我。

这段代码相当直接。逐行读取数据文件可以轻松进行一些额外的预处理，例如忽略非数据行（我们假设数据文件中的注释以'#'开头，无论多么荒谬）。我们可以指定数据集文件是否包含头部，并且我们也允许CSV和TSV文件，CSV是默认值。

目前存在一些错误检查，但它还不够健壮，因此我们可能需要在之后回到这一点。此外，一行一行地读取文件并逐条决定如何处理这些行，将比使用内置功能直接将干净且符合规范的CSV读入DataFrame要慢，但在此阶段允许更多的灵活性是值得的（但对于更大的文件可能会花费更长的时间）。不要忘记，如果这些内部操作看起来不是最好的方法，我们可以随时在之后进行更改。

在尝试代码之前，我们首先需要编写一个函数，将名义类别值转换为数值。为了使函数具有通用性，我们应该允许它用于数据集中任何属性，而不仅仅是类别。我们还应该跟踪属性名称与最终整数之间的映射。鉴于我们之前将CSV或TSV数据文件加载到pandas DataFrame中的步骤，这个函数应接受pandas DataFrame以及要转换为数值的属性名称。

还需要注意的是，我们暂时回避了关于将独热编码应用于分类非类别属性的讨论，但我怀疑我们稍后会回到这个话题。

上述函数再次是简单的，但完成了我们希望它完成的任务。我们本可以通过多种方式来解决这个问题，包括使用pandas的内置功能，但从一开始就让我们稍微“动手”一下正是这篇文章的目的。

此时，我们现在可以从文件中加载数据集，并用数值替换分类属性值（我们还会保留这些映射的字典以备后用）。如前所述，我们希望最终将数据集转化为numpy ndarray，以便最轻松地与算法一起使用。再次，这是一项简单的任务，但将其制作成函数将允许我们在未来必要时进行扩展。

即使前面的函数看起来并不过于复杂，这个函数可能也会显得如此。但请耐心点；我们实际上是在遵循合理的——尽管是过于谨慎的——编程原则。随着我们向前推进，很有可能会对迄今为止构建的函数进行修改或添加功能。在一个地方实现这些更改，并且将这些更改记录好，从长远来看是有意义的。

### 测试我们的数据准备工作流程

我们迄今为止的工作流程可能仍处于构建块形式，但让我们对代码进行测试吧。

```py
  sepal_length sepal_width petal_length petal_width species
0          5.1         3.5          1.4         0.2  setosa
1          4.9           3          1.4         0.2  setosa
2          4.7         3.2          1.3         0.2  setosa
3          4.6         3.1          1.5         0.2  setosa
4            5         3.6          1.4         0.2  setosa

  sepal_length sepal_width petal_length petal_width  species
0          5.1         3.5          1.4         0.2        0
1          4.9           3          1.4         0.2        0
2          4.7         3.2          1.3         0.2        0
3          4.6         3.1          1.5         0.2        0
4            5         3.6          1.4         0.2        0

{'setosa': 0, 'versicolor': 1, 'virginica': 2}

[['5.1' '3.5' '1.4' '0.2' 0]
 ['4.9' '3' '1.4' '0.2' 0]
 ['4.7' '3.2' '1.3' '0.2' 0]
 ['4.6' '3.1' '1.5' '0.2' 0]
 ['5' '3.6' '1.4' '0.2' 0]
 ['5.4' '3.9' '1.7' '0.4' 0]
 ['4.6' '3.4' '1.4' '0.3' 0]
 ['5' '3.4' '1.5' '0.2' 0]
 ['4.4' '2.9' '1.4' '0.2' 0]
 ['4.9' '3.1' '1.5' '0.1' 0]]
```

在我们的代码按预期工作之后，让我们做一些快速的整理。我们将在代码正式运行后提出一个更全面的组织结构，但现在我们应该将[所有这些函数添加到一个文件中](https://gist.github.com/mmmayo13/9859a457760db10ec4842be3aa1a2334)，并将其保存为**dataset.py**。这将使代码的重复使用更加方便，我们将在下次看到这一点。

### 展望未来

接下来，我们将关注更有实质性的内容，即k均值聚类算法的实现。然后我们将看一个简单的分类算法——k最近邻。我们将看到如何在简单工作流程的背景下构建分类和聚类模型。毫无疑问，这将需要编写一些额外的工具来帮助我们的项目，我相信我们现有的代码也会需要进行修改。

但没关系；*实践*机器学习是*理解*机器学习的最佳方法。实现我们工作流所需的算法和支持工具应该最终证明是有用的。我希望你觉得这些内容对你有足够的帮助，以便查看下一期。

**相关**：

+   [数据准备提示、技巧和工具：与业内人士的访谈](/2016/10/data-preparation-tips-tricks-tools.html)

+   [Pandas 备忘单：Python 中的数据科学与数据整理](/2017/01/pandas-cheat-sheet.html)

+   [使用 Python 和 Scikit-learn 简化决策树的可解释性](/2017/05/simplifying-decision-tree-interpretation-decision-rules-python.html)

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速入门网络安全职业。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析水平

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT 部门

* * *

### 更多主题

+   [每个数据科学家都应该知道的三种 R 库（即使你使用 Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)

+   [使用管道编写清晰的 Python 代码](https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html)

+   [是什么让 Python 成为初创公司的理想编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)

+   [停止学习数据科学以寻找目标，找到目标去……](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)

+   [学习数据科学统计的顶级资源](https://www.kdnuggets.com/2021/12/springboard-top-resources-learn-data-science-statistics.html)

+   [建立一个坚实的数据团队](https://www.kdnuggets.com/2021/12/build-solid-data-team.html)
