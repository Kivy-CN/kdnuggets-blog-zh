# PyCaret 101：面向初学者的介绍

> 原文：[https://www.kdnuggets.com/2021/06/pycaret-101-introduction-beginners.html](https://www.kdnuggets.com/2021/06/pycaret-101-introduction-beginners.html)

[评论](#comments)

**由[ Moez Ali](https://www.linkedin.com/in/profile-moez/)，PyCaret创始人及作者**

![](../Images/2b4e095038b7e40091fb46813a4c773b.png)

PyCaret — 一个开源的低代码机器学习库，基于Python

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升您的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持您的组织IT工作

* * *

### PyCaret

[PyCaret](https://www.pycaret.org/) 是一个开源的低代码机器学习库和端到端模型管理工具，基于Python构建，用于自动化机器学习工作流。它的易用性、简单性以及快速高效地构建和部署端到端机器学习管道的能力将令你惊叹。

PyCaret是一个可替代的低代码库，可以用少量代码替代数百行代码。这使得实验周期迅速而高效。

PyCaret是**简单易用的**。所有在PyCaret中执行的操作都顺序存储在一个**管道**中，完全自动化**部署**。无论是填补缺失值、一键编码、转换分类数据、特征工程，还是超参数调优，PyCaret都能自动完成。想了解更多关于PyCaret的内容，请观看这个1分钟的视频。

PyCaret — 一个开源的低代码机器学习库，基于Python

### PyCaret的特点

![](../Images/eadab4d647dcf4f77f48fa4df54f1c5a.png)

作者提供的图片

### PyCaret中的模块

PyCaret是一个模块化库，分为多个模块，每个模块代表一个机器学习用例。截至撰写本文时，支持以下模块：

![](../Images/25cf0f7d01befb77986c3b39587cd96e.png)

作者提供的图片 — PyCaret支持的机器学习用例

**时间序列模块正在开发中，将在下一个主要版本中提供。**

### 安装PyCaret

安装PyCaret非常简单，仅需几分钟。我们强烈推荐使用虚拟环境以避免与其他库的潜在冲突。

PyCaret的默认安装是pycaret的精简版，仅安装必要的依赖，[列表见此](https://github.com/pycaret/pycaret/blob/master/requirements.txt)。

```py
**# install slim version (default)** pip install pycaret**# install the full version**
pip install pycaret[full]
```

当你安装 PyCaret 的完整版时，所有的可选依赖项也会被安装，如[这里列出的](https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt)。

![](../Images/61927545f7f850ddb656ad96326dd159.png)

PyCaret 数字 — 作者提供的图像

### ???? 开始吧

在展示如何使用 PyCaret 进行机器学习之前，让我们高层次地讨论一下机器学习生命周期：

![](../Images/a9a1254f49bf8637e4b40ea779055c7a.png)

机器学习生命周期 — 作者提供的图像（从左至右阅读）

+   **业务问题 —** 这是机器学习工作流的第一步。根据用例和问题的复杂性，这可能需要几天到几周的时间。在此阶段，数据科学家与领域专家会面，以了解问题、采访关键利益相关者、收集信息，并设定项目的总体期望。

+   **数据来源与 ETL —** 一旦理解了问题，就需要利用面谈中获得的信息从企业数据库中获取数据。

+   **探索性数据分析（EDA） —** 建模尚未开始。EDA 是分析原始数据的阶段。你的目标是探索数据，评估数据的质量、缺失值、特征分布、相关性等。

+   **数据准备 —** 现在是准备数据模型训练的时候了。这包括将数据分为训练集和测试集、填补缺失值、独热编码、目标编码、特征工程、特征选择等。

+   **模型训练与选择 —** 这是大家最期待的步骤。这涉及训练多个模型、调整超参数、模型集成、评估性能指标、模型分析如 AUC、混淆矩阵、残差等，最后选择一个最佳模型用于生产环境中的业务应用。

+   **部署与监控 —** 这是最终步骤，主要涉及 MLOps。包括打包最终模型、创建 docker 镜像、编写评分脚本，然后将它们整合在一起，最后将其发布为可以用于对新数据进行预测的 API。

传统的做法相当繁琐、耗时且需要大量的技术知识，这可能在一个教程中无法涵盖。然而，在本教程中，我将使用 PyCaret 演示数据科学家如何高效地完成这些任务。

### ???? 业务问题

对于本教程，我将使用达顿商学院发布在[哈佛商业](https://hbsp.harvard.edu/product/UV0869-PDF-ENG)的一个非常受欢迎的案例研究。这个案例讲述了两个即将结婚的人。一个名叫*Greg*的男孩想买一个戒指向一个名叫*Sarah*的女孩求婚。问题在于找到Sarah喜欢的戒指，但在得到他亲密朋友的建议后，Greg决定买一个钻石，以便Sarah可以选择。Greg随后收集了6000颗钻石的数据，包括它们的价格和切工、颜色、形状等属性。

### ???? 数据

在本教程中，我将使用一个非常受欢迎的案例研究数据集，该数据集由达顿商学院发布在[哈佛商业](https://hbsp.harvard.edu/product/UV0869-PDF-ENG)。本教程的目标是根据钻石的属性，如克拉重量、切工、颜色等，预测钻石价格。你可以从[PyCaret的仓库](https://github.com/pycaret/pycaret/tree/master/datasets)下载数据集。

```py
**# load the dataset from pycaret** from pycaret.datasets import get_data
data = get_data('diamond')
```

![](../Images/fb95a6b487372fcc0798bf241f463754.png)

数据样本行

### ???? 探索性数据分析

让我们做一些快速的可视化，以评估独立特征（如重量、切工、颜色、净度等）与目标变量即`Price`之间的关系。

```py
**# plot scatter carat_weight and Price**
import plotly.express as px
fig = px.scatter(x=data['Carat Weight'], y=data['Price'], 
                 facet_col = data['Cut'], opacity = 0.25, template = 'plotly_dark', trendline='ols',
                 trendline_color_override = 'red', title = 'SARAH GETS A DIAMOND - A CASE STUDY')
fig.show()
```

![](../Images/5e3fa68a8d11c0a17130264aa4d9f53d.png)

让我们检查一下目标变量的分布。

```py
**# plot histogram**
fig = px.histogram(data, x=["Price"], template = 'plotly_dark', title = 'Histogram of Price')
fig.show()
```

![](../Images/06f59e9b6448c861aa90716081884715.png)

注意到`Price`的分布是右偏的，我们可以快速检查对数变换是否能使`Price`接近正态分布，从而给假设正态性的算法提供机会。

```py
import numpy as np**# create a copy of data**
data_copy = data.copy()**# create a new feature Log_Price**
data_copy['Log_Price'] = np.log(data['Price'])**# plot histogram**
fig = px.histogram(data_copy, x=["Log_Price"], title = 'Histgram of Log Price', template = 'plotly_dark')
fig.show()
```

![](../Images/a4bba39265f978622d2702ae97bf7620.png)

这确认了我们的假设。转换将帮助我们消除偏斜，使目标变量接近正态分布。基于此，我们将在训练模型之前对`Price`变量进行转换。

### ???? 数据准备

PyCaret中的所有模块都共有，`setup`是任何机器学习实验中唯一的强制步骤。该函数处理训练模型之前所需的所有数据准备工作。除了执行一些基本的默认处理任务外，PyCaret还提供了广泛的预处理功能。要了解PyCaret中所有的预处理功能，可以查看此[链接](https://pycaret.org/preprocessing/)。

```py
**# initialize setup**
from pycaret.regression import *
s = setup(data, target = 'Price', transform_target = True, log_experiment = True, experiment_name = 'diamond')
```

![](../Images/f92622b3666c7bc68fe61fb6b46ddf5c.png)

pycaret.regression模块中的setup函数

当你在PyCaret中初始化`setup`函数时，它会对数据集进行分析，并推断所有输入特征的数据类型。如果所有数据类型都正确推断，你可以按回车键继续。

注意到：

+   我们已经传递了`log_experiment = True`和`experiment_name = 'diamond'`，这将告诉 PyCaret 在建模阶段自动记录所有的指标、超参数和模型工件。这是因为与[MLflow](https://www.mlflow.org/)的集成使之成为可能。

+   此外，我在`setup`中使用了`transform_target = True`。PyCaret 将在后台使用 box-cox 变换转换`Price`变量。这会以类似于对数变换的方式影响数据的分布（*技术上有所不同*）。如果您想了解更多关于 box-cox 变换的信息，可以参考这个[链接](https://onlinestatbook.com/2/transformations/box-cox.html)。

![](../Images/ac6d418cca0eb62de9b2bf43575dc318.png)

来自 setup 的输出 — 为显示而截断

### ???? 模型训练与选择

既然数据已经准备好进行建模，让我们使用`compare_models`函数开始训练过程。它将训练模型库中所有可用的算法，并使用 k 折交叉验证评估多个性能指标。

```py
**# compare all models**
best = compare_models()
```

![](../Images/07fecb193d63f93d20f3fea859771fe5.png)

compare_models 的输出

```py
**# check the residuals of trained model**
plot_model(best, plot = 'residuals_interactive')
```

![](../Images/eb43d501d3b721c528f968ef18076086.png)

最佳模型的残差和 QQ 图

```py
**# check feature importance**
plot_model(best, plot = 'feature')
```

![](../Images/0317c1fe59b3d80b2e167e051eab4208.png)

### 完成和保存管道

现在我们来完成最佳模型的最终步骤，即在整个数据集（包括测试集）上训练最佳模型，然后将管道保存为 pickle 文件。

```py
**# finalize the model**
final_best = finalize_model(best)**# save model to disk** save_model(final_best, 'diamond-pipeline')
```

`save_model`函数将整个管道（包括模型）保存为本地磁盘上的 pickle 文件。默认情况下，它会将文件保存在您的笔记本或脚本所在的文件夹中，但如果需要，您也可以传递完整路径：

```py
save_model(final_best, 'c:/users/moez/models/diamond-pipeline'
```

### ???? 部署

记住我们在 setup 函数中传递了`log_experiment = True`和`experiment_name = 'diamond'`。让我们看看 PyCaret 借助 MLflow 在后台完成的魔法。要查看这些魔法，让我们启动 MLflow 服务器：

```py
**# within notebook (notice ! sign infront)** !mlflow ui**# on command line in the same folder** mlflow ui
```

现在打开您的浏览器并输入“https://localhost:5000”。它将打开如下 UI：

![](../Images/b6170680042f3b2a36cc3b3356deb876.png)

[https://localhost:5000](https://localhost:5000/)

上表中的每个条目代表一次训练运行，产生了一个训练好的管道以及一系列元数据，如运行日期时间、性能指标、模型超参数、标签等。让我们点击其中一个模型：

![](../Images/99991e20fe48b1af29c79fe0a5967e7a.png)

第一部分 — CatBoost 回归器

![](../Images/d48bae6d168a6898337ee1394c12df66.png)

第二部分 — CatBoost 回归器（续）

![](../Images/901c1286a5f3784d006ef3fc25b7f9d2.png)

第三部分 — CatBoost 回归器

请注意，您有一个`logged_model`的地址路径。这是使用 CatBoost 回归器训练的管道。您可以使用`load_model`函数读取此管道。

```py
**# load model**
from pycaret.regression import load_model
pipeline = load_model('C:/Users/moezs/mlruns/1/b8c10d259b294b28a3e233a9d2c209c0/artifacts/model/model')**# print pipeline** print(pipeline)
```

![](../Images/bc9604047be618af559db94d8a86c428.png)

print(pipeline) 的输出

现在我们用这个管道在新数据上生成预测

```py
**# create a copy of data and drop Price** data2 = data.copy()
data2.drop('Price', axis=1, inplace=True)**# generate predictions** from pycaret.regression import predict_model
predictions = predict_model(pipeline, data=data2)
predictions.head()
```

![](../Images/1c1bee5b356af4b2b77b4227a490bd60.png)

从管道生成的预测

哇哦！我们现在有了从训练好的管道中得到的推断。恭喜你，如果这是你的第一个。请注意，所有的变换，如目标变换、独热编码、缺失值插补等，都是在后台自动完成的。你会得到一个带有实际规模预测的数据框，这才是你关心的。

![](../Images/83f3b7bb83ff24f6897be4a9f2a07d9b.png)

作者提供的图片

![](../Images/b36b63110de0ece1dd0a6283b02637a3.png)

作者提供的图片

使用这个轻量级的 Python 工作流自动化库，你可以实现无限的可能。如果你觉得有用，请不要忘记在我们的 GitHub 仓库上给我们 ⭐️。

想了解更多关于 PyCaret 的信息，关注我们的 [LinkedIn](https://www.linkedin.com/company/pycaret/) 和 [Youtube](https://www.youtube.com/channel/UCxA1YTYJ9BEeo50lxyI_B3g)。

加入我们的 Slack 频道。邀请链接 [这里](https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg)。

### 你可能还感兴趣：

[使用 PyCaret 2.0 在 Power BI 中构建自己的 AutoML](https://towardsdatascience.com/build-your-own-automl-in-power-bi-using-pycaret-8291b64181d)

[在 Azure 上使用 Docker 部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-pipeline-on-cloud-using-docker-container-bec64458dc01)

[在 Google Kubernetes Engine 上部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-model-on-google-kubernetes-engine-94daac85108b)

[在 AWS Fargate 上部署机器学习管道](https://towardsdatascience.com/deploy-machine-learning-pipeline-on-aws-fargate-eb6e1c50507)

[构建并部署你的第一个机器学习网页应用](https://towardsdatascience.com/build-and-deploy-your-first-machine-learning-web-app-e020db344a99)

[使用 AWS Fargate 无服务器基础设施部署 PyCaret 和 Streamlit 应用](https://towardsdatascience.com/deploy-pycaret-and-streamlit-app-using-aws-fargate-serverless-infrastructure-8b7d7c0584c2)

[使用 PyCaret 和 Streamlit 构建并部署机器学习网页应用](https://towardsdatascience.com/build-and-deploy-machine-learning-web-app-using-pycaret-and-streamlit-28883a569104)

[在 GKE 上部署使用 Streamlit 和 PyCaret 构建的机器学习应用](https://towardsdatascience.com/deploy-machine-learning-app-built-using-streamlit-and-pycaret-on-google-kubernetes-engine-fd7e393d99cb)

### 重要链接

[文档](https://pycaret.readthedocs.io/en/latest/installation.html)

[博客](https://medium.com/@moez_62905)

[GitHub](https://www.github.com/pycaret/pycaret)

[StackOverflow](https://stackoverflow.com/questions/tagged/pycaret)

[安装 PyCaret](https://pycaret.readthedocs.io/en/latest/installation.html) [Notebook 教程](https://pycaret.readthedocs.io/en/latest/tutorials.html) [为 PyCaret 贡献](https://pycaret.readthedocs.io/en/latest/contribute.html)

### 想了解某个特定模块吗？

点击下面的链接查看文档和工作示例。

[分类](https://pycaret.readthedocs.io/en/latest/api/classification.html) [回归](https://pycaret.readthedocs.io/en/latest/api/regression.html)

[聚类](https://pycaret.readthedocs.io/en/latest/api/clustering.html)

[异常检测](https://pycaret.readthedocs.io/en/latest/api/anomaly.html)

[自然语言处理](https://pycaret.readthedocs.io/en/latest/api/nlp.html) [关联规则挖掘](https://pycaret.readthedocs.io/en/latest/api/arules.html)

**结束**

**个人简介： [Moez Ali](https://www.linkedin.com/in/profile-moez/)** 是数据科学家，同时也是 PyCaret 的创始人和作者。

[原文](https://medium.com/analytics-vidhya/pycaret-101-for-beginners-27d9aefd34c5)。经许可转载。

**相关：**

+   [使用 PyCaret + MLflow 的简单 MLOps](/2021/05/easy-mlops-pycaret-mlflow.html)

+   [使用 PyCaret 编写和训练自定义机器学习模型](/2021/05/pycaret-write-train-custom-machine-learning-models.html)

+   [关于 PyCaret 的 5 件事](/2020/07/5-things-pycaret.html)

### 更多相关话题

+   [使用 PyCaret 的二分类介绍](https://www.kdnuggets.com/2021/12/introduction-binary-classification-pycaret.html)

+   [使用 PyCaret 的 Python 聚类介绍](https://www.kdnuggets.com/2021/12/introduction-clustering-python-pycaret.html)

+   [宣布 PyCaret 3.0：开源、低代码的 Python 机器学习](https://www.kdnuggets.com/2023/03/announcing-pycaret-30-opensource-lowcode-machine-learning-python.html)

+   [开始使用 PyCaret](https://www.kdnuggets.com/2022/11/getting-started-pycaret.html)

+   [数据科学家的线性编程 101](https://www.kdnuggets.com/2023/02/linear-programming-101-data-scientists.html)

+   [LangChain 101：构建你自己的 GPT 驱动应用程序](https://www.kdnuggets.com/2023/04/langchain-101-build-gptpowered-applications.html)
