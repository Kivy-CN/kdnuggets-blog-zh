# 使用pandasql让Python说SQL

> 原文：[https://www.kdnuggets.com/2017/02/python-speak-sql-pandasql.html](https://www.kdnuggets.com/2017/02/python-speak-sql-pandasql.html)

这篇文章最初出现在[Yhat博客](http://blog.yhat.com/)上。[**Yhat**](https://www.yhat.com/)是一家位于布鲁克林的公司，致力于使数据科学对开发者、数据科学家和企业同样适用。Yhat提供了一个软件平台，用于作为REST API部署和管理预测算法，同时消除了与生产环境相关的痛苦工程障碍，如测试、版本控制、扩展和安全性。

* * *

### 介绍

我最喜欢Python的一点是，用户可以借鉴R社区的经验，然后模拟其中的最佳部分。我坚信，一门语言的有用程度取决于其库和工具。

这篇文章介绍了`pandasql`，这是我们（Yhat）编写的一个Python包，它模拟了R包[`sqldf`](https://github.com/ggrothendieck/sqldf)。这是一个小巧却强大的库，包含了仅[358行代码](https://github.com/yhat/pandasql)。`pandasql`的想法是让Python能够使用SQL。对于那些来自SQL背景或仍然“用SQL思考”的用户，`pandasql`是一个很好的方式来利用这两种语言的优势。

在这次介绍中，我们将展示如何在我们为数据探索和分析构建的集成开发环境（IDE）[Rodeo](https://www.yhat.com/products/rodeo)中使用`pandasql`。Rodeo是一个开源且完全免费的工具。如果你是R用户，它是一个类似于[RStudio](https://www.rstudio.com/)的工具，具有相似的感觉。截至今天，Rodeo只能运行Python代码，但上周[我们添加了](http://blog.yhat.com/posts/rodeo-2.4.0.html)对许多其他语言（如markdown、JSON、julia、SQL）的语法高亮显示功能。正如你可能已经读到或猜到的那样，我们对Rodeo有很大的计划，包括添加SQL支持，使你能够直接在Rodeo中运行SQL查询，即使没有我们方便的`pandasql`。关于这一点，敬请期待下周或两周内的更多消息！

### 下载Rodeo

首先从[Yhat网站上的Rodeo页面](https://www.yhat.com/products/rodeo)下载适用于Mac、Windows或Linux的Rodeo。

ps 如果你下载了Rodeo并遇到问题或有任何问题，我们会24/7（好吧，几乎是）监控我们的[讨论论坛](http://discuss.yhat.com/)。

### 如果你感兴趣，以下是一些背景信息

在幕后，`pandasql`使用`pandas.io.sql`模块在`DataFrame`和SQLite数据库之间传输数据。操作在SQL中进行，结果被返回，然后数据库被拆除。这个库大量使用了`pandas`的`write_frame`和`frame_query`这两个函数，它们允许你从`pandas`读写数据到（大多数）SQL数据库。

### 安装 `pandasql`

使用 Rodeo 中的包管理器窗格安装 `pandasql`。只需搜索 `pandasql` 并点击安装包。

![Rodeo](../Images/df01e2be992655e3d8df842a35b7b555.png)

如果你更喜欢这种安装方式，也可以在文本编辑器中运行 `! pip install pandasql`。

### 查看数据集

`pandasql` 有两个内置的数据集，我们将在下面的示例中使用它们。

+   `meat`：来自美国农业部的数据集，包含关于牲畜、乳制品和家禽展望与生产的指标。

+   `births`：来自联合国统计司的数据集，包含按月统计的活产人口统计数据。

运行以下代码以查看数据集。

在 Rodeo 中，你实际上不需要 print.variable.head() 语句，因为你可以直接检查数据框。

![Rodeo](../Images/e16146ab2559389c09b51db6b64af166.png)

### 一个奇怪的图表

注意，图表会同时出现在控制台和图表选项卡（右下角选项卡）。

提示：你可以通过点击窗格顶部的箭头来“弹出”你的图表。如果你在使用多个显示器并希望专门用于数据可视化，这会很方便。

![Rodeo](../Images/033f5bc0a2de9b060afac0a299c60ecc.png)

### 用法

为了保持帖子简洁易读，我们在下面的大多数查询中仅提供了代码片段和几行结果。

如果你在使用 Rodeo，开始时可以参考以下几个提示：

+   `Run Script` 确实会运行你在文本编辑器中编写的所有内容。

+   你可以高亮一段代码并通过点击 `Run Line` 或按 Command + Enter 来运行它。

+   你可以调整窗格大小（当我不制作图表时，我会缩小右下角的窗格）。

**基础**

编写一些 SQL 并通过将 DataFrames 替换为表来在 `pandas` `DataFrame` 上执行它。

`pandasql` 创建一个数据库、模式及所有内容，加载你的数据，并运行你的 SQL。

**聚合**

`pandasql` 支持聚合。你可以在 `group by` 子句中使用 [别名列名](http://www.w3schools.com/sql/sql_alias.asp) 或列号。

**`locals()` 与 `globals()`**

`pandasql` 需要访问会话/环境中的其他变量。你可以在执行 SQL 语句时将 `locals()` 传递给 `pandasql`，但如果你运行很多查询，这可能会很麻烦。为了避免每次都传递 locals，你可以将此辅助函数添加到脚本中来设置 `globals()`，如下面所示：

**连接**

你可以使用普通的 SQL 语法来连接数据框。

**`WHERE` 条件**

这是一个 `WHERE` 子句。

### 这只是 SQL。

由于 `pandasql` 基于 [SQLite3](https://docs.python.org/2/library/sqlite3.html)，你可以做几乎所有你在 SQL 中能做的事情。以下是一些使用常见 SQL 特性如子查询、排序、函数和联合的示例。

### 最后的想法

![Rodeo](../Images/9d2174120c35e418253586777099d061.png)

`pandas` 是一个令人惊叹的数据分析工具，我们认为这在很大程度上是因为它非常易于理解、简洁和富有表现力。最终，学习 `merge`、`join`、`concatenate`、`melt` 和其他原生 `pandas` 功能来切片和处理数据有 *大量* 的理由。查看 [文档](http://pandas.pydata.org/pandas-docs/stable/merging.html) 以获取一些示例。

我们希望`pandasql`能成为对 Python 和`pandas`新手有帮助的学习工具。在我个人学习 R 的经历中，`sqldf`是一个熟悉的界面，帮助我尽快高效地使用新工具。

我们希望你能查看一下`pandasql`和 Rodeo；如果你这样做了，请 [告诉我们你的想法](http://discuss.yhat.com/)！

[原文](http://blog.yhat.com/posts/pandasql-intro.html)。经许可转载。

**相关：**

+   [优秀的最小化和干净的机器学习算法实现集合](/2017/01/great-collection-clean-machine-learning-algorithms.html)

+   [Pandas 备忘单：Python 中的数据科学与数据整理](/2017/01/pandas-cheat-sheet.html)

+   [Python 中的统计数据分析](/2016/07/statistical-data-analysis-python.html)

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业轨道。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析水平

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你所在组织的 IT 工作

* * *

### 了解更多相关话题

+   [在 Pandas 中使用 Pandasql 的 SQL](https://www.kdnuggets.com/sql-in-pandas-with-pandasql)

+   [预测：Python 中线性回归的初学者指南](https://www.kdnuggets.com/2023/06/making-predictions-beginner-guide-linear-regression-python.html)

+   [Ploomber 与 Kubeflow：简化 MLOps](https://www.kdnuggets.com/2022/02/ploomber-kubeflow-mlops-easier.html)

+   [数据质量在成功机器学习模型中的重要性](https://www.kdnuggets.com/2022/03/significance-data-quality-making-successful-machine-learning-model.html)

+   [让智能文档处理变得更智能：第一部分](https://www.kdnuggets.com/2023/02/making-intelligent-document-processing-smarter-part-1.html)

+   [从数据分析师到数据策略师：产生影响的职业路径](https://www.kdnuggets.com/2023/05/data-analyst-data-strategist-career-path-making-impact.html)
