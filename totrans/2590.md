# 日期时间变量的特征工程用于数据科学和机器学习

> 原文：[https://www.kdnuggets.com/2021/04/feature-engineering-datetime-variables-data-science-machine-learning.html](https://www.kdnuggets.com/2021/04/feature-engineering-datetime-variables-data-science-machine-learning.html)

[评论](#comments)

**作者：[Samarth Agrawal](https://www.linkedin.com/in/samarth-agrawal-2501/)，丰田的数据科学家**

![](../Images/4ed1b796931f51585f4049a3784eeaff.png)

日期时间变量的特征工程。图像由作者提供。

### 介绍

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速开启网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力。

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织 IT 工作。

* * *

日期时间字段需要[特征工程](https://www.kdnuggets.com/2018/12/feature-engineering-explained.html)将其从数据转化为可以被我们的机器学习模型使用的有洞察力的信息。本文分为 3 部分及最后的附加部分，我们将结合使用内置的 pandas 和 NumPy 函数以及我们自己的函数来提取有用的特征。

+   第 1 部分 — 提取日期/时间组件

+   第 2 部分 — 创建布尔标志

+   第 3 部分 — 计算日期/时间差异

+   附加部分 — 使用 `fast_ml` 进行 2 行代码的特征工程

### 背景

每当我处理与电子商务相关的数据时，数据集中总会包含日期时间列。

+   用户注册日期时间

+   用户登录日期时间

+   交易日期时间

+   有争议的交易日期时间

+   …以及更多

一开始，这个日期字段只是时间线上的一个特定点。但这些日期时间字段是潜在的数据宝库。如果使用得当，它们对揭示模式极为强大。

作为数据科学家，你的工作是提供洞察力，为此你需要提出正确的问题。例如：

+   **问题 1** — 你认为大多数购物车在什么时候被创建？

+   **问题 2** — 你认为大多数购物车在什么时候被放弃？

+   **问题 3** — 你认为最常见的欺诈交易发生在什么时候？

+   **问题 4** — 何时最多用户订阅？

+   **问题 5** — 某些商品通常在什么时候被购买？

+   **问题 6** — 注册后多少天/小时用户下了第一笔订单？

+   **问题 7** — 顾客在多长时间的不活跃后不再访问你的网站？

+   …等等

现在，为了回答这些问题，你需要回到数据中对这些日期时间字段进行特征工程。然后可以发现许多模式。

**第 1 部分** 将提供特征工程步骤，以回答类似于第 1、2 和 3 问题的问题

+   **答案 1** — 你会在什么时候看到最多的购物车被创建？***每月的第一周***

+   **答案 2** — 你会在什么时候看到大多数购物车被放弃？***星期三下午***

+   **答案 3** — 你会在什么时候看到最多的欺诈交易？***星期五深夜***

**第 2 部分** 将提供特征工程步骤，以回答类似于第 4 和第 5 问题的问题

+   **答案 4** — 什么时候用户最多订阅？***在年初***

+   **答案 5** — 某些物品最常在什么时候购买？***在月初***

**第 3 部分** 将提供特征工程步骤，以回答类似于第 6 和第 7 问题的问题

+   **答案 6** — 注册后多少天/小时用户会下第一个订单？***在 2 小时内***

+   **答案 7** — 在多少天的不活动后，客户不会再返回到你的站点？***在 14 天的不活动后***

我使用了一个电子商务数据的示例，在其中我个人发现了许多用例，但提取信息的范围并不仅限于此。在本文中，我们将看到通过提出正确的问题，例如进行适当的特征工程，可以学习到的一些行为在多个行业中解决各种问题时非常有用。

### 让我们开始吧

### 加载数据集

[PRE0]

Pandas 提供了一种非常简单但功能强大的方法来处理与 DateTime 相关的变量，通过将其解析为日期。你可以将所有与日期时间相关的变量作为列表传递到参数 `parse_dates` 中。

假设你事先不知道 DateTime 变量，并在调查数据后发现其中一些变量是日期时间类型。那么，pandas 提供了另一个有用的函数 `to_datetime` 来将数据类型转换为 DateTime，而不是重新加载数据。

[PRE1]

### 第 1 部分。提取日期/时间组件

如上述示例所示，我们可以从给定的日期时间变量中提取日期时间部分的组件（`year`、`quarter`、`month`、`day`、`day_of_week`、`day_of_year`、`week_of_year`、`time`、`hour`、`minute`、`second`、`day_part`）。下面的列表提供了可以使用 pandas 内置函数提取的几个此类组件。

### 语法：

我们可以使用 `.dt` 访问器提取所有这些组件。 [了解有关日期访问器的更多信息](https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#basics-dt-accessors)

![](../Images/865a594fd09fdc507e55080c852fbd2d.png)

从日期时间变量 issued_date 中提取的组件。图片作者

以下是图中所示的代码。所有其他组件也可以以类似的方式提取

[PRE2]

**注意：**

+   对于星期一：`day_of_week = 0`,

+   星期二：`day_of_week=1`,

+   …

+   星期天：`day_of_week=6`

### 创建日期部分：

[PRE3]

![](../Images/52e9229dcc9bf851d292a6ec9fc75fff.png)

为日期时间变量 issued_date 创建日期部分。图片作者

### 第 2 部分。创建布尔标志

如上述示例所示，我们可以从给定的日期时间变量中提取许多布尔标志（`is_month_start`，`is_month_end`，`is_quarter_start`，`is_quarter_end`，`is_year_start`，`is_year_end`，`is_weekend`）。以下列表提供了几个可以使用 pandas 内置函数以及创建一些我们自己的函数来提取的组件。

### 语法：

同样，我们可以使用 `.dt` 访问器提取许多布尔标志。

![](../Images/aa41450da8348b1993205f0ca49b54ef.png)

从 datetime 变量 issued_date 中提取的布尔标志。图片来源于作者

[PRE4]

### 创建周末标志：

![](../Images/4ce3c583bb90f829bdf179decda50834.png)

为 datetime 变量 issued_date 创建周末标志。图片来源于作者

如果我们查看日历，我们会发现2013年10月26日是星期六——一个周末。

[PRE5]

### 第3部分。计算日期/时间差异

你的问题/分析通常会相对于另一个参考点。例如，

1.  用户在注册后多少天/小时内下了第一笔订单？*registration_date & first_order_date*

1.  客户投诉在多少天/小时内得到解决？*complain_date & resolution_date*

1.  从今天起，客户最近一次从你的网站订购了什么？*today & last_order_date*

1.  …等等

在我们的示例数据集中，我们有两列 date_last_payment 和 date_issued。让我们看看当我们仅计算这两列的差异时会发生什么。

![](../Images/d4e4299913fdc2c2cf1b5cf9afe22449.png)

计算 pandas 中的时间差。图片来源于作者。

Pandas 默认提供“天”之间的差异。注意 `dtype: timedelta64[ns]`。

来自 numpy 文档：

> “因为 NumPy 在其核心没有物理量系统，所以创建了 timedelta64 数据类型以补充 datetime64”

现在，如果我们只想要数字部分而不是整个字符串 `947 days`，可以使用 .dt 访问器来实现。

![](../Images/607f87dc7013020fc7590929cb9f4d81.png)

使用 .dt 访问器计算 pandas 中的时间差。图片来源于作者。

不幸的是，我们无法以类似的方式获得月份。

![](../Images/bc4f9ebfcbfe10a6861580b07f57cc81.png)

使用 .dt 访问器计算 pandas 中的时间差不可扩展。图片来源于作者。

在这里，NumPy 的 `timedelta64` 非常有用。

### 语法：

为了获得贷款发放日期和最后还款日期之间的月份数，我们将这样编写

![](../Images/6e671aa2cc1f5543a911f1572b1fe269.png)

使用 NumPy timedelta64 计算 pandas 中的时间差。图片来源于作者。

[PRE6]

timedelta64 可以接受以下参数来计算两个日期之间的差异：

+   ‘D’ → 天

+   ‘W’ → 周

+   ‘M’ → 月

+   ‘Y’ → 年

+   ‘h’ → 小时

### 奖金！

你可以使用 fast_ml 创建所有这些 datetime 特征

首先，安装 `fast_ml` 包

[PRE7]

然后，从 `feature_engineering` 模块导入用于工程日期时间特征的方法

[PRE8]

现在，这与 sklearn 中的其他转换器、预处理器的工作方式完全相同。

+   实例化

+   适配

+   转变

[PRE9]

![](../Images/77c4c459ae7774e8713ba134f540f00f.png)

使用 Fast_ml 对日期时间变量进行特征工程。图片来源：作者。

截图中并未显示所有列。我们只查看数据集中的列。

[PRE10]

### 感谢阅读！！

+   如果你喜欢这个内容， [请在 medium 上关注我](https://samarthagrawal86.medium.com/) 以获取更多内容。

+   你的点赞对我来说是巨大的鼓励，有助于我写得更多更好。

+   有兴趣合作吗？让我们在 [Linkedin](https://www.linkedin.com/in/samarth-agrawal-2501/) 上联系。

+   请随时写下你的想法/建议/反馈。

+   [Kaggle 链接](https://www.kaggle.com/nextbigwhat/feature-engineering-datetime-variables)

+   [Fast_ml 链接](https://pypi.org/project/fast-ml/)

Notebook 可在以下位置获取，包含完整功能代码：

[**日期时间变量的特征工程**]

在 Kaggle Notebooks 上探索并运行机器学习代码 | 使用来自贷款数据的数据](https://www.kaggle.com/nextbigwhat/feature-engineering-of-datetime-variables?scriptVersionId=61041780)

**简历： [Samarth Agrawal](https://www.linkedin.com/in/samarth-agrawal-2501/)** 是丰田的数据科学家，同时也是数据科学从业者和传播者。

[原文](https://samarthagrawal86.medium.com/feature-engineering-of-datetime-variables-for-data-science-machine-learning-45e611c632ad)。已获授权转载。

**相关：**

+   [使用 fast.ai 进行快速特征工程](/2018/03/feature-engineering-dates-fastai.html)

+   [数值数据的特征工程](/2020/09/feature-engineering-numerical-data.html)

+   [数据科学 101：标准化、归一化和正则化](/2021/04/data-science-101-normalization-standardization-regularization.html)

### 更多相关主题

+   [Feature Store Summit 2022: 一场关于特征工程的免费会议](https://www.kdnuggets.com/2022/10/hopsworks-feature-store-summit-2022-free-conference-feature-engineering.html)

+   [机器学习中的实用特征工程方法](https://www.kdnuggets.com/2023/07/practical-approach-feature-engineering-machine-learning.html)

+   [为多变量时间序列构建一个可处理的特征工程管道…](https://www.kdnuggets.com/2022/03/building-tractable-feature-engineering-pipeline-multivariate-time-series.html)

+   [使用 RAPIDS cuDF 利用 GPU 进行特征工程](https://www.kdnuggets.com/2023/06/rapids-cudf-leverage-gpu-feature-engineering.html)

+   [初学者的特征工程](https://www.kdnuggets.com/feature-engineering-for-beginners)

+   [机器学习中的替代特征选择方法](https://www.kdnuggets.com/2021/12/alternative-feature-selection-methods-machine-learning.html)
