# PyTorch 入门第 1 部分：理解自动微分如何工作

> 原文：[https://www.kdnuggets.com/2018/04/getting-started-pytorch-understanding-automatic-differentiation.html](https://www.kdnuggets.com/2018/04/getting-started-pytorch-understanding-automatic-differentiation.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](/2018/04/getting-started-pytorch-understanding-automatic-differentiation.html?page=2#comments)

**由 [Ayoosh Kathuria](https://www.linkedin.com/in/ayoosh-kathuria-44a319132/)，研究实习生**

当我开始编写神经网络代码时，我最终使用了周围人都在使用的 TensorFlow。

* * *

## 我们的三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持您组织的 IT

* * *

但最近，PyTorch 已经成为深度学习框架的主要竞争者。它真正吸引人的地方在于其动态计算图范式。如果最后一句话现在对你没有意义，也不用担心。到这篇文章结束时，你会明白的。但请相信我，它使得调试神经网络变得容易得多。

> 我已经使用 PyTorch 几个月了，感觉从未如此好。我更有精力了。我的皮肤更清晰了。我的视力也有所改善。
> 
> — Andrej Karpathy (@karpathy) [2017年5月26日](https://twitter.com/karpathy/status/868178954032513024?ref_src=twsrc%5Etfw)

如果你想知道为什么你最近精力低下，试试 PyTorch 吧！

### 前提条件

在我们开始之前，我必须指出，您至少应对以下内容有基本了解：

+   与神经网络训练相关的概念，特别是反向传播和梯度下降。

+   应用链式法则计算导数。

+   Python 中的类如何工作。（或面向对象编程的一般概念）

如果您缺少上述任何内容，我已在文章末尾提供了链接以供参考。

所以，是时候开始学习 PyTorch 了。这是 PyTorch 系列教程中的第一篇。

这是第一部分，我将描述基本构建块和*Autograd*。

> **注意：** 一个重要的事情是，这个教程是针对 PyTorch 0.3 及更低版本制作的。现在提供的最新版本是 0.4。我决定坚持使用 0.3，因为到目前为止，0.3 是 Conda 和 pip 渠道中提供的版本。此外，开源社区中使用的大多数 PyTorch 代码尚未更新以纳入 0.4 中提出的一些更改。不过，我会在某些地方指出 0.3 和 0.4 之间的不同。

### 构建模块 #1：张量

如果你曾经在 Python 中做过机器学习，你可能遇到过 NumPy。我们使用 NumPy 的原因是它在执行矩阵操作时比 Python 列表快得多。为什么？因为它在 C 中完成了大部分繁重的工作。

但是，在训练深度神经网络时，NumPy 数组根本不够用。我懒得在这里做实际计算（可以在谷歌中搜索“ResNet 一次迭代的 FLOPS 以获取大致了解”），但仅使用 NumPy 数组的代码可能需要几个月的时间来训练一些最先进的网络。

**这就是** **张量** **发挥作用的地方。PyTorch 提供了一种称为** *张量* **的数据结构，这与 NumPy 的** *ndarray* **非常相似。但与后者不同，** **张量可以利用 GPU 的资源显著加快矩阵操作的速度。**

这是你如何创建一个张量。

```py
In [1]: import torch 

In [2]: import numpy as np

In [3]: arr = np.random.randn((3,5))

In [4]: arr

Out[4]:
array([[-1.00034281, -0.07042071,  0.81870386],
       [-0.86401346, -1.4290267 , -1.12398822],
       [-1.14619856,  0.39963316, -1.11038695],
       [ 0.00215314,  0.68790149, -0.55967659]])

In [5]: tens = torch.from_numpy(arr)

In [6]: tens

Out[6]:

-1.0003 -0.0704  0.8187
-0.8640 -1.4290 -1.1240
-1.1462  0.3996 -1.1104
0.0022  0.6879 -0.5597
[torch.DoubleTensor of size 4x3]

In [7]: another_tensor = torch.LongTensor([[2,4],[5,6]])

In [7]: another_tensor

Out[13]: 
 2  4
 5  6
[torch.LongTensor of size 2x2]

In [8]: random_tensor = torch.randn((4,3))

In [9]: random_tensor

Out[9]:
1.0070 -0.6404  1.2707
-0.7767  0.1075  0.4539
-0.1782 -0.0091 -1.0463
 0.4164 -1.1172 -0.2888
[torch.FloatTensor of size 4x3]
```

### 构建模块 #2：计算图

现在，我们进入了实际操作的部分。当神经网络被训练时，我们需要计算损失函数的梯度，针对每个权重和偏置，然后使用梯度下降法更新这些权重。

随着神经网络权重达到数十亿，如何高效地执行上述步骤可能会影响训练的可行性。

**构建模块 #2.1：计算图**

计算图是现代深度学习网络工作原理的核心，PyTorch 也不例外。让我们首先了解它们是什么。

假设，你的模型描述如下：

```py
*b = w1 * a
c = w2 * a 
d = (w3 * b) + (w4 * c)
L = f(d)*
```

如果我实际绘制计算图，它可能会看起来像这样。

![](../Images/b1185cdfd81dacc7da52b88949b4cd17.png)

我们模型的计算图

**现在**，你必须注意，上面的图并不完全准确地表示 PyTorch 内部如何表示图形。然而，目前这足以说明我们的观点。

我们为什么要创建这样的图形，而不是顺序执行计算输出所需的操作呢？

想象一下，如果你不仅需要计算输出，还需要训练网络会发生什么。你将不得不为所有由紫色节点标记的权重计算梯度。这将要求你弄清楚链式法则，然后更新这些权重。

**计算图只是一个数据结构，允许你高效地应用链式法则来计算所有参数的梯度。**

![](../Images/142a367a1968d0a892540f69c74dedc3.png)

使用计算图应用链式法则

这里有几件事需要注意。首先，箭头的方向现在在图中被反转了。这是因为我们在进行反向传播，箭头标记了梯度反向流动的方向。

其次，为了这些示例，你可以将我写的梯度视为 *边权重*。注意，这些梯度不需要链式法则来计算。

现在，为了计算 *任何节点的梯度，例如 L，相对于任何其他节点，例如 c (dL / dc)*，我们只需做以下操作。

1.  跟踪路径 *从 L 到 c*。这将是 *L → d → c*。

1.  在沿着这条路径遍历时，乘以所有的 *边权重*。你最终得到的量是：( *dL / dd* ) * ( *dd / dc* ) = (dL / dc)

1.  如果有多条路径，请将它们的结果相加。例如，在 *dL/da* 的情况下，我们有两条路径：*L → d → c → a* 和 *L → d → b → a*。我们将它们的贡献相加，以获得 *L 对 a 的梯度*。

*[*( *dL / dd* ) * ( *dd / dc* ) * ( *dc / da* )] * + *[*( *dL / dd* ) * ( *dd / db* ) * ( *db / da* )]*

原则上，可以从 *L* 开始，向后遍历图，计算每个经过节点的梯度。

### 更多相关话题

+   [开始使用 PyTorch Lightning](https://www.kdnuggets.com/2022/12/getting-started-pytorch-lightning.html)

+   [用 5 个步骤开始使用 PyTorch](https://www.kdnuggets.com/5-steps-getting-started-pytorch)

+   [如何通过使用自动 EDA 工具来应对数据科学评估测试](https://www.kdnuggets.com/2022/04/ace-data-science-assessment-test-automatic-eda-tools.html)

+   [我如何使用 Grounding DINO 进行自动图像标记](https://www.kdnuggets.com/2023/05/automatic-image-labeling-grounding-dino.html)

+   [ChatGPT 如何运作：机器人背后的模型](https://www.kdnuggets.com/2023/04/chatgpt-works-model-behind-bot.html)

+   [Burtch Works 2023 数据科学与 AI 专业人士薪资报告…](https://www.kdnuggets.com/2023/08/burtch-works-2023-data-science-ai-professionals-salary-report.html)
