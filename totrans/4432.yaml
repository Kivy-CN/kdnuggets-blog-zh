- en: A Complete Guide To Survival Analysis In Python, part 3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://www.kdnuggets.com/2020/07/guide-survival-analysis-python-part-3.html](https://www.kdnuggets.com/2020/07/guide-survival-analysis-python-part-3.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[comments](#comments)'
  prefs: []
  type: TYPE_NORMAL
- en: '**By [Pratik Shukla](https://medium.com/@shuklapratik22), Aspiring machine
    learning engineer**.'
  prefs: []
  type: TYPE_NORMAL
- en: Index of the series
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Our Top 3 Course Recommendations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google Cybersecurity
    Certificate](https://www.kdnuggets.com/google-cybersecurity) - Get on the fast
    track to a career in cybersecurity.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google Data Analytics
    Professional Certificate](https://www.kdnuggets.com/google-data-analytics) - Up
    your data analytics game'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT Support
    Professional Certificate](https://www.kdnuggets.com/google-itsupport) - Support
    your organization in IT'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '**[Part 1](https://www.kdnuggets.com/2020/07/complete-guide-survival-analysis-python-part1.html): **'
  prefs: []
  type: TYPE_NORMAL
- en: (1) Basics of survival analysis.
  prefs: []
  type: TYPE_NORMAL
- en: '**[Part 2](https://www.kdnuggets.com/2020/07/guide-survival-analysis-python-part-2.html):**'
  prefs: []
  type: TYPE_NORMAL
- en: (2) Kaplan-Meier fitter theory with an example.
  prefs: []
  type: TYPE_NORMAL
- en: (3) Nelson-Aalen fitter theory with an example.
  prefs: []
  type: TYPE_NORMAL
- en: '**Part 3:**'
  prefs: []
  type: TYPE_NORMAL
- en: (4) Kaplan-Meier fitter based on different groups.
  prefs: []
  type: TYPE_NORMAL
- en: (5) Log-Rank Test with an example.
  prefs: []
  type: TYPE_NORMAL
- en: (6) Cox Regression with an example.
  prefs: []
  type: TYPE_NORMAL
- en: In the previous article, we saw how we could analyze the survival probability
    for patients. But it’s very important for us to know which factor affects survival
    most. So in this article, we discuss the Kaplan-Meier Estimator based on various
    groups.
  prefs: []
  type: TYPE_NORMAL
- en: 'Example 3: Kaplan-Meier Estimator with groups'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s divide our data into 2 groups: Male and Female. Our goal here is to check
    is there any significant difference in survival rate if we divide our data set
    based on sex.'
  prefs: []
  type: TYPE_NORMAL
- en: '**(1) Import required libraries:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a98e1d29859ed38f7aca99118ddd0ac4.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(2) Read the dataset:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0fd6f50d8f037d0116e8eaf2dc20a47e.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(3) Organize our data:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/508afac7e0a10ae0aed4e341cf3981bb.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(4) Create two objects of KaplanMeierFitter():**'
  prefs: []
  type: TYPE_NORMAL
- en: '*kmf_m* is for male dataset.'
  prefs: []
  type: TYPE_NORMAL
- en: '*kmf_f* is for female dataset.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cb44ce5fa7c8ac486dc98f5fca31120f.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(5) Divide data into groups:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a6678c79a22511f5485f9f7ae34cc0c5.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(6) Fit data into our objects:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3e57916c122d0ee976c60dd7f1d54bcc.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(7) Generate event_tables:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4c09df0ddb93ef610fdbc3aa5afe1497.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Event Table For Male.*'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/eaa7fd49bc96c6ee20538fde573a8d9c.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Event Table For Female.*'
  prefs: []
  type: TYPE_NORMAL
- en: '**(7) Predicting survival probabilities:**'
  prefs: []
  type: TYPE_NORMAL
- en: Now we can predict the survival probability for both the groups.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e489ead25115d300d791611fd310862f.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(8) Get the complete list of survival_probability:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/91c898c05a1581e4a61408408250e081.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](../Images/20eb9f7edafe2c36f6c518f99d80053d.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(9) Plot the graph:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f7ad28ee270cedcf1f1b7af23c845377.png)'
  prefs: []
  type: TYPE_IMG
- en: Notice that the probability of a female surviving lung cancer is higher than
    the probability of a male surviving lung cancer. So from this data, we can say
    that the medical researchers should focus more on the factors that lead to poor
    survival rates for male patients.
  prefs: []
  type: TYPE_NORMAL
- en: '**(10) Cumulitive_density:**'
  prefs: []
  type: TYPE_NORMAL
- en: It gives us a probability of a person dying at a certain timeline.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/681efbf20c16afe80f6e5d7651eb1ac1.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](../Images/c13339fe127e3d68ee919da091e95096.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(11) Plot the data:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9a6b1bdef159ba263ac27ad872620a2a.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(12) Hazard function:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9f79b46a4c10175250897a0ee52cb7f8.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(13) Data fitting:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/be0f4e9ce6162a53f6ac37ff13789d52.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(14) Cumulative hazard:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7911d97d14dcec5d8ae7009bf9ad8738.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](../Images/65feb99dcce21e424e78fd193aa4a386.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(15) Plot the data:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6fa7fb18f9002851970a8921a24f4f9f.png)'
  prefs: []
  type: TYPE_IMG
- en: Log-Rank Test
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Goal: Here, our goal is to see if there is any significant difference between
    the groups being compared.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Null Hypothesis**: The null hypothesis states that there is no significant
    difference between the groups being studied. If there is a significant difference
    between these groups, then we have to reject our null hypothesis.'
  prefs: []
  type: TYPE_NORMAL
- en: '**How do we say that there is a significant difference?**'
  prefs: []
  type: TYPE_NORMAL
- en: The statistical significance is denoted by a p-value between 0 and 1\. The smaller
    the p-value, the greater the statistical difference between groups being studied.
    Notice that here our goal is to find if there is any difference between the groups
    we are comparing. If yes, then we can do more research on why there are lower
    survival chances for a particular group based on various information like their
    diet, lifestyle, etc.
  prefs: []
  type: TYPE_NORMAL
- en: '**Less than (5% = 0.05) P**-**value** means that there is a significant difference
    between the groups that we compared. We can partition our groups based on their
    sex, age, race, method of treatment, etc.'
  prefs: []
  type: TYPE_NORMAL
- en: '**It’s a test to find out the value of P.**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b421214d381f53a72f37a8a2d1ff604a.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](../Images/d3c7c092c02af7b018b73416d73f9c4a.png)'
  prefs: []
  type: TYPE_IMG
- en: Here we’ll compare the survival distributions of two different groups by the
    famous statistical method of the log-rank test. Here notice that for our groups,
    the test_statistic equals 10.33, and the P-value indicates (<0.005), which is
    statistically significant and denotes that we have to reject our null hypothesis
    and admit that the survival function for both groups is significantly different.
    The P-value gives us strong evidence that “sex” was associated with survival days.
    In short, we can say that in our example, “sex” has a major contribution to survival
    days.
  prefs: []
  type: TYPE_NORMAL
- en: 'Putting it all together:'
  prefs: []
  type: TYPE_NORMAL
- en: '**[You can download the Jupyter notebooks from here.](https://drive.google.com/open?id=1Vj9UNMfcsqP3S7D3-oQRjEuc2Gnw43dF)**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Example 4: Cox proportional hazard model'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The Cox proportional hazard model is basically a regression model generally
    used by medical researchers to find out the relationship between the survival
    time of a subject and one or more predictor variables. In short, we want to find
    out how different parameters like age, sex, weight, height affects the length
    of survival for a subject.
  prefs: []
  type: TYPE_NORMAL
- en: In the previous section, we saw Kaplan-Meier, Nelson-Aalen, and Log-Rank Test.
    But in that, we were only able to consider one variable at a time. And one more
    thing to notice here is that we were performing operations only on categorical
    variables like sex, status, etc., which are not generally used for non-categorical
    data like age, weight, etc. As a solution, we use the Cox proportional hazards
    regression analysis, **which works for both quantitative predictor (non-categorical)
    variables and categorical variables.**
  prefs: []
  type: TYPE_NORMAL
- en: '**Why do we need it?**'
  prefs: []
  type: TYPE_NORMAL
- en: In medical research, generally, we are considering more than one factor to diagnose
    a person’s health or survival time, i.e., we generally make use of their sex, 
    age, blood pressure, and blood sugar to find out if there is any significant difference
    between those in different groups. For example, if we are grouping our data based
    on a person’s age, then our goal will be to find out which age group has a higher
    survival chance. Is that the children’s group, adult’s group, or old person’s
    group? Now what we need to find is on what basis do we make the group? To find
    that we use Cox regression and find the coefficients of different parameters.
    Let’s see how that works!
  prefs: []
  type: TYPE_NORMAL
- en: '**Basics of the Cox proportional hazard method:**'
  prefs: []
  type: TYPE_NORMAL
- en: The ultimate purpose of the Cox proportional hazard method is to notice how
    different factors in our dataset impact the event of interest.
  prefs: []
  type: TYPE_NORMAL
- en: '**Hazard function:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f5ccb83ec979341166f78e8ba57fe5ef.png)'
  prefs: []
  type: TYPE_IMG
- en: '**The values exp(bi) is called the hazard ratio (HR)**. The HR greater than
    1 indicates that as the value of ith covariate increases, the event hazard increases,
    and thus the duration of survival decreases.'
  prefs: []
  type: TYPE_NORMAL
- en: In summary,
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/714aec5c8f27b924fbe7cdfa46ba2001.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Let’s code:**'
  prefs: []
  type: TYPE_NORMAL
- en: '**(1) Import required libraries:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a98e1d29859ed38f7aca99118ddd0ac4.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(2) Read the CSV file:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d02b904ec8a401506c29026ba1a4b71a.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(3) Delete rows that contain null values:**'
  prefs: []
  type: TYPE_NORMAL
- en: Here we need to delete the rows which have null values. Our model can’t work
    on rows which has null values. If we don’t preprocess our data, then we might
    get an error.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9a5b72f1ea4163588cddeb3fb031d9df.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(4) Create an object for KapanMeierFitter:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a2f8f82d9f5136fa91f968a2578c4d9e.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(5) Organize our data:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cbcc1bde9cfa0ee11eba7666b9a9a118.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(6) Fit the values:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4ca2a13c145dc5fd55db4061376a4537.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(7) Event table:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8695f88461fbf9a294a12a6d18364657.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(8) Import Cox regression library:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1a68dade41fffb969bf73052d30fce2c.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(9) Parameters we want to consider while fitting our model:**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2a1e8a8c38f083dd0216d2f2fe99f4cb.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(10) Fit the data and print the summary:**'
  prefs: []
  type: TYPE_NORMAL
- en: Our model will consider all the parameters to find the coefficient values for
    that.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3d6452bad3e1f1d48867c0f0d5b57cc9.png)'
  prefs: []
  type: TYPE_IMG
- en: '![](../Images/23ddc30db01973db3a506386be10b8da.png)'
  prefs: []
  type: TYPE_IMG
- en: Here notice the p-value of different parameters as we know that a p-value (<0.05)
    is considered significant. Here you can see that the p-value of sex and ph.ecog
    are <0.05\. So, we can say that we can group our data based on those parameters.
  prefs: []
  type: TYPE_NORMAL
- en: '**HR (Hazard Ratio) = exp(bi)**'
  prefs: []
  type: TYPE_NORMAL
- en: The p-value for sex is 0.01 and HR (Hazard Ratio) is 0.57 indicating a strong
    relationship between the patients’ sex and decreased risk of death. For example,
    holding the other covariates constant,** being female (sex=2) reduces the hazard
    by a factor of 0.58, or 42%.** That means that females have higher survival chances.
    Notice that we came to this conclusion using a graph in the previous section.
  prefs: []
  type: TYPE_NORMAL
- en: The p-value for ph.ecog is <0.005 and HR is 2.09, indicating a strong relationship
    between the ph.ecog value and increased risk of death. Holding the other covariates
    constant, a higher value of ph.ecog is associated with poor survival.** Here person
    with higher ph.ecog value has a 109% higher risk of death.** So, in short, we
    can say that doctors try to reduce the value of ph.ecog by providing relevant
    medicines.
  prefs: []
  type: TYPE_NORMAL
- en: Now notice that HR for Age is 1.01, which suggests only a 1% increase for the
    higher age group. So we can say that there is no significant difference between
    different age groups.
  prefs: []
  type: TYPE_NORMAL
- en: In short,
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/714aec5c8f27b924fbe7cdfa46ba2001.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(11) Check which factor affects the most from the graph:**'
  prefs: []
  type: TYPE_NORMAL
- en: You can clearly see that ph.ecog and sex variables have significant differences.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ca785dd72a220b6628e7c982ea0c9c41.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(12) Plot the graph:**'
  prefs: []
  type: TYPE_NORMAL
- en: Here I have plotted the survival probability for different persons in our dataset.
    Here notice that person-1 has the highest survival chances, and person-3 has the
    lowest survival chances. If you look at the main data, you can see that person-3
    has a higher ph.ecog value.
  prefs: []
  type: TYPE_NORMAL
- en: Here notice that even if person-5 is alive, his/her survival probability is
    less since he/she has higher ph.ecog value.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/af0a4200fb92a0718e7dbd4f20520e36.png)'
  prefs: []
  type: TYPE_IMG
- en: '**(13) Find out median time to event for timeline:**'
  prefs: []
  type: TYPE_NORMAL
- en: Here notice that as the number of days passed, the median survival time is decreasing.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e2ff499174e128e650fd0cd1f645d487.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Putting it all together:**'
  prefs: []
  type: TYPE_NORMAL
- en: '**[You can download the Jupyter notebooks from here.](https://drive.google.com/open?id=1Vj9UNMfcsqP3S7D3-oQRjEuc2Gnw43dF)**'
  prefs: []
  type: TYPE_NORMAL
- en: '[Original](https://medium.com/@shuklapratik22/a-complete-guide-to-survival-analysis-in-python-956588e4dd17).
    Reposted with permission.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Bio: **[Pratik Shukla](https://medium.com/@shuklapratik22) is an aspiring
    machine learning engineer who loves to put complex theories in simple ways. Pratik
    pursued his undergraduate in computer science and is going for a master''s program
    in computer science at University of Southern California.  “Shoot for the moon.
    Even if you miss it you will land among the stars. -- Les Brown”'
  prefs: []
  type: TYPE_NORMAL
- en: '**Related:**'
  prefs: []
  type: TYPE_NORMAL
- en: '[A Complete Guide To Survival Analysis In Python, part 1](https://www.kdnuggets.com/2020/07/complete-guide-survival-analysis-python-part1.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[A Complete Guide To Survival Analysis In Python, part 2](https://www.kdnuggets.com/2020/07/guide-survival-analysis-python-part-2.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Survival Analysis for Business Analytics](https://www.kdnuggets.com/2017/11/survival-analysis-business-analytics.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: More On This Topic
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[The Complete Collection of Data Science Cheat Sheets - Part 1](https://www.kdnuggets.com/2022/02/complete-collection-data-science-cheat-sheets-part-1.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Complete Collection of Data Science Cheat Sheets - Part 2](https://www.kdnuggets.com/2022/02/complete-collection-data-science-cheat-sheets-part-2.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Complete Collection Of Data Repositories - Part 1](https://www.kdnuggets.com/2022/04/complete-collection-data-repositories-part-1.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Complete Collection Of Data Repositories - Part 2](https://www.kdnuggets.com/2022/04/complete-collection-data-repositories-part-2.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Complete Collection of Data Science Books - Part 1](https://www.kdnuggets.com/2022/05/complete-collection-data-science-books-part-1.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Complete Collection of Data Science Books - Part 2](https://www.kdnuggets.com/2022/05/complete-collection-data-science-books-part-2.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
