# 在 Google Colaboratory 上利用免费的 GPU 掌握快速梯度提升

> 原文：[https://www.kdnuggets.com/2019/03/mastering-fast-gradient-boosting-google-colaboratory-free-gpu.html](https://www.kdnuggets.com/2019/03/mastering-fast-gradient-boosting-google-colaboratory-free-gpu.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

**由 [Anna Veronika Dorogush](https://www.linkedin.com/in/anna-veronika-dorogush-08739637/), CatBoost 团队负责人**

![掌握梯度提升图 1](../Images/62dab8909af11b3717938905d64a8f7c.png)

**NVIDIA K80 GPU, [https://www.nvidia.com/ru-ru/data-center/tesla-k80/](https://www.nvidia.com/ru-ru/data-center/tesla-k80/)**

**决策树上的梯度提升**（GBDT）是一种先进的机器学习工具，用于处理异质或结构化数据。在处理数据时，理想的算法高度依赖于数据类型。对于同质数据，例如图像、声音或文本，最佳解决方案是神经网络。而对于结构化数据，例如信用评分、推荐或任何其他表格数据，最佳解决方案是 GBDT。

因此，许多 [Kaggle](https://www.kaggle.com/) 比赛的获胜解决方案都基于 GBDT。GBDT 还广泛应用于各种推荐系统的生产中、搜索引擎中以及许多金融结构中。

许多人认为 GBDT 无法通过 GPU 高效加速，但实际上并非如此。在这篇文章中，我将解释如何利用 GPU 来加速 GBDT。

对于 GBDT 实现，我将使用 **CatBoost**，这是一个以支持类别特征和高效的 GPU 实现而闻名的库。它不仅处理类别数据，还处理任何数据，在许多情况下，它的表现优于其他 GBDT 库。

该库是为俄罗斯领先的科技公司 [Yandex](https://yandex.com) 的生产需求开发的，并在大约一年半前以 [Apache 2 许可证](https://en.wikipedia.org/wiki/Apache_License) 开源。

![掌握梯度提升图 2](../Images/9bb20a26e6a3b27261e83e1bc0a2c29f.png)

我的演示测试环境将是 **Google Colaboratory**。这是一个机器学习研究工具，提供免费的 GPU 运行时访问。它是一个 Jupyter 笔记本环境，无需设置即可使用。

Google Colaboratory 提供了免费的较旧的 GPU——一块大约 11GB 内存的 Tesla K80 GPU。使用更新的 GPU，速度提升会更显著。但即使使用这块旧 GPU，你也会看到令人印象深刻的速度差异。如果我们谈论的是 CPU，那么每个实例为 2x Intel Xeon E5-2600v3。

下面你将找到几个简单步骤，用于在 Colab 中设置 CatBoost、下载数据集、在 CPU 和 GPU 上训练模型并比较执行时间。

### 创建笔记本

访问 [Colaboratory](https://colab.research.google.com) 并创建一个新的 Python 3 笔记本。

![掌握梯度提升图 3](../Images/4be7e2cb46334ca9eb4ecd65f18c0d9a.png)

### 设置 GPU 作为硬件加速器

选择 GPU 作为硬件加速器有两个简单步骤：

第一步：导航到“运行时”菜单并选择“更改运行时类型”

![掌握梯度提升图 4](../Images/691557beda28be1fc217785b2b258ccd.png)

第二步：选择“GPU”作为硬件加速器。

![掌握梯度提升图 5](../Images/bcb8c4599e6ea3a34d6a2b89d152f19e.png)

### 导入 CatBoost

下一步是将 CatBoost 导入环境中。Colaboratory 已安装内置库，大多数库可以通过简单的 *!pip install* 命令快速安装。

请忽略关于已导入枚举包的警告消息。此外，请注意，每次启动新的 Colab 会话时，您需要重新导入库。

*!pip install catboost*

![掌握梯度提升图 6](../Images/3ec24905d856d4a3bede106e32662599.png)

从 pypi 安装的 CatBoost 库支持 GPU，因此您可以立即使用它。您只需在机器上安装 NVIDIA 驱动程序，其余一切都会开箱即用。这对 Windows 也是如此，使得希望在 GPU 上训练模型的 Windows 用户更加方便。

### 下载并准备数据集

现在是编码的时候了！一旦我们配置好环境，下一步是下载并准备数据集。对于 GPU 训练，数据集越大，加速效果越显著。对于一千个或更少的对象，使用 GPU 训练并没有太大意义，但从大约 10,000 开始，您将获得良好的加速效果。

我们需要一个大数据集来展示 GPU 在 GBDT 任务中的强大性能。我们将使用 Epsilon，它包含 500,000 个文档和 2,000 个特征，并且已包含在 catboost.datasets 中。

下面的代码大约需要 10-15 分钟完成这个任务。请耐心等待。

### 在 CPU 上训练

为了揭开 GBDT 在 GPU 上没有显著速度提升的神话，我想比较 CPU 和 GPU 上 GBDT 的训练时间。让我们从 CPU 开始。下面的代码创建一个模型，训练它，并测量训练的执行时间。它使用默认参数，因为在许多情况下，默认参数提供了一个相当好的基线。

我们将首先训练所有模型 100 次迭代（因为在 CPU 上训练需要很长时间）。

运行此代码后，您可以将其更改为默认的 1000 次或更多迭代，以获得更好的结果。

CatBoost 在 CPU 上训练 100 次迭代大约需要 15 分钟。

你想展示可以有加速的速度提升，对吗？

如果 feed = training，回答是的。

在 CPU 上拟合模型的时间：862 秒

### 在 GPU 上训练

所有先前的代码执行都在 CPU 上完成。现在是时候使用 GPU 了！

要启用 GPU 训练，您需要使用 *task_type='GPU'* 参数。

让我们在 GPU 上重新运行实验，看看结果时间会是怎样的。

如果 Colab 显示警告“GPU 内存使用接近限制”，请点击“忽略”。

![掌握梯度提升 第7章](../Images/2b65f3aa59ac6d9a48ce75e0fdbb633f.png)

在 GPU 上拟合模型的时间：195 秒

GPU 相对于 CPU 的加速：4倍

如你所见，GPU 的速度是 **CPU 的 4 倍**。使用 GPU 拟合模型只需 3-4 分钟，而 CPU 则需 14-15 分钟。此外，学习过程仅需 30 秒，而 CPU 则需 12 分钟。

当我们训练 100 次迭代时，瓶颈在于预处理，而不是训练本身。但对于需要在巨大数据集上获得最佳质量的数千次迭代，这个瓶颈将不再显著。你可以尝试在 CPU 和 GPU 上训练 5,000 次迭代，并再次比较。

### `Code`

你可以在 CatBoost 仓库中找到上述所有代码的 [教程](https://colab.research.google.com/github/catboost/tutorials/blob/master/tools/google_colaboratory_cpu_vs_gpu_tutorial.ipynb)。

### 替代的 GBDT 库

公平地说，还有至少两个流行的开源 GBDT 库：

+   [XGBoost](https://github.com/dmlc/xgboost/)

+   [LightGBM](https://github.com/Microsoft/LightGBM)

两者都作为预装库提供在 Colaboratory 上。让我们在 CPU / GPU 上训练它们，并比较时间。剧透：我们没有成功得到它们的结果。详细信息如下。

### XGBoost

首先，让我们尝试 XGBoost 的 CPU 版本。需要强调的是，训练参数与 CatBoost 库相同。

代码非常简单，但一旦我们使用 Epsilon 数据集运行它，Colaboratory 会话就崩溃了。

![掌握梯度提升 第8章](../Images/95585dac0f80bdc1a163fc298f4a43cc.png)

不幸的是，GPU 版本也出现了相同的错误。启动上述简单代码后，内核会崩溃。

### LightGBM

LightGBM 的 CPU 版本也出现了相同的错误消息“您的会话在使用完所有可用内存后崩溃。”。

Colaboratory 预装版本的 LightGBM 不包含 GPU 支持。而且，[安装指南](https://github.com/Microsoft/LightGBM/tree/master/python-package) 的 GPU 版本不幸无法使用。详见下文。

*!pip install -U lightgbm --install-option=--gpu*

![掌握梯度提升 第9章](../Images/57c772f59ed4bf65e1531d1f68b2d360.png)

可惜的是，除了 CatBoost 的库外，我们无法比较其他库的 CPU 与 GPU 执行时间。可能使用更小的数据集会有效。

### 总结

+   GBDT 算法在 GPU 上运行效率很高。

+   CatBoost 是一个快速实现的 GBDT 库，开箱即用的 GPU 支持。

+   XGBoost 和 LightGBM 在 Colaboratory 上处理大数据集时并不总是能正常工作。

+   Google Colaboratory 是一个有用的工具，提供免费的 GPU 支持。

### 进一步阅读

[1] V. Ershov, [CatBoost 支持使用 GPU 的快速梯度提升](https://devblogs.nvidia.com/catboost-fast-gradient-boosting-decision-trees/)，NVIDIA 博客文章

[2] R. Mitchell, [使用 CUDA 的梯度提升、决策树和 XGBoost](https://devblogs.nvidia.com/gradient-boosting-decision-trees-xgboost-cuda/)，NVIDIA 博客文章

[3] [LightGBM GPU 教程](https://lightgbm.readthedocs.io/en/latest/GPU-Tutorial.html)

[4] [CatBoost GitHub](https://github.com/catboost)

**简介**: [安娜·维罗尼卡·多罗古什](https://www.linkedin.com/in/anna-veronika-dorogush-08739637/ ) 是 Yandex 机器学习系统的负责人。

**资源：**

+   [在线和基于网络的：分析、数据挖掘、数据科学、机器学习教育](https://www.kdnuggets.com/education/online.html)

+   [分析、数据科学、数据挖掘和机器学习的软件](https://www.kdnuggets.com/software/index.html)

**相关：**

+   [理解梯度提升机](https://www.kdnuggets.com/2019/02/understanding-gradient-boosting-machines.html)

+   [3 个 Google Colab 环境管理技巧](https://www.kdnuggets.com/2019/01/more-google-colab-environment-management-tips.html)

+   [使用 Google CoLaboratory 创建简单的文本分类器](https://www.kdnuggets.com/2018/03/simple-text-classifier-google-colaboratory.html)

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3. [Google IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持组织的 IT

* * *

### 更多相关话题

+   [构建 GPU 机器与使用 GPU 云服务](https://www.kdnuggets.com/building-a-gpu-machine-vs-using-the-gpu-cloud)

+   [掌握季节性和提升业务成果的终极指南](https://www.kdnuggets.com/2023/08/media-mix-modeling-ultimate-guide-mastering-seasonality-boosting-business-results.html)

+   [掌握 GPU：Python 中 GPU 加速数据框的初学者指南](https://www.kdnuggets.com/2023/07/mastering-gpus-beginners-guide-gpu-accelerated-dataframes-python.html)

+   [提升机器学习算法：概述](https://www.kdnuggets.com/2022/07/boosting-machine-learning-algorithms-overview.html)

+   [宣布博客写作比赛，获胜者将获得 NVIDIA GPU！](https://www.kdnuggets.com/2022/11/blog-writing-contest-nvidia-gpu.html)

+   [使用 RAPIDS cuDF 利用 GPU 进行特征工程](https://www.kdnuggets.com/2023/06/rapids-cudf-leverage-gpu-feature-engineering.html)
