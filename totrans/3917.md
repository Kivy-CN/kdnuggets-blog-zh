# 如何通过简单的面向对象编程混合来提升你的深度学习原型

> 原文：[https://www.kdnuggets.com/2019/08/simple-mix-object-oriented-programming-sharpen-deep-learning-prototype.html](https://www.kdnuggets.com/2019/08/simple-mix-object-oriented-programming-sharpen-deep-learning-prototype.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

![](../Images/639dd33fb84f100e7f6a32b3beae256d.png)

### 介绍

本文不针对经验丰富的软件工程师。**这面向数据科学家和机器学习（ML）从业者**，他们像我一样，没有软件工程背景。

我们在工作中大量使用Python。为什么？因为它对机器学习和数据科学社区来说非常棒。

它正逐渐成为现代数据驱动分析和人工智能（AI）应用的[增长最快的主要语言](https://stackoverflow.blog/2017/09/14/python-growing-quickly/?source=post_page---------------------------)。

然而，它也用于简单的脚本编写，来[自动化任务](https://automatetheboringstuff.com/?source=post_page---------------------------)，[测试假设](https://machinelearningmastery.com/statistical-hypothesis-tests-in-python-cheat-sheet/?source=post_page---------------------------)，创建[用于头脑风暴的交互式图表](https://mode.com/blog/python-interactive-plot-libraries?source=post_page---------------------------)，[控制实验室仪器](https://hackaday.com/2016/11/16/how-to-control-your-instruments-from-a-computer-its-easier-than-you-think/?source=post_page---------------------------)等。

但问题是。

**用于软件开发的Python和用于脚本编写的Python并不是完全相同的东西——至少在数据科学领域中如此。**

> 脚本编写（主要是）你为自己编写的代码。软件则是你（以及其他团队成员）为他人编写的代码集合。

明智的做法是承认，当（大多数）没有软件工程背景的数据科学家为AI/ML模型和统计分析编写Python程序时，他们往往编写这种代码*仅仅是为了自己*。

他们只想迅速抓住数据中隐藏的模式。不深入思考普通用户——*用户*。

他们编写了一段代码以生成丰富美观的图表。但他们不会将其创建为一个***函数***，以便后续使用。

他们从标准库中导入了许多***方法***和***类***。但他们不会通过***继承***来创建自己的***子类***，并为其添加方法以扩展功能。

***函数、继承、方法、类***——这些是稳健的**面向对象编程（OOP）**的核心，但如果你只是想用数据分析和图表创建一个Jupyter笔记本，它们在一定程度上是可以避免的。

> 你可以避免最初使用面向对象编程原则的痛苦，但这几乎总会导致你的笔记本代码不可重用和不可扩展。

简而言之，这段代码仅对你自己有用（直到你忘记了你编写的具体逻辑），对其他人则无效。

但 [**可读性（因此可重用性）至关重要**](https://devblogs.microsoft.com/oldnewthing/20070406-00/?p=27343&source=post_page---------------------------)。这是你所编写内容真正的价值测试。不是为了你自己，而是为了他人。

事实上，数据科学家 [Will Koehrsen](https://towardsdatascience.com/u/e2f299e30cb9?source=post_page---------------------------) 刚刚写了一篇关于这个想法的精彩文章。

**[《代码大全》中的软件构建笔记](https://towardsdatascience.com/notes-on-software-construction-from-code-complete-8d2a8a959c69?source=post_page---------------------------)**

《代码大全：软件构建的实用手册》的经验教训在数据科学中的应用

更重要的是，[**数以百计的受欢迎的 MOOC 或在线数据科学和 AI/ML 课程也没有强调这种编码方面，因为对于年轻的热情学习者来说，这感觉像是一种负担**]。他们在这里是为了学习酷炫的算法和神经网络优化，而不是 Python 中的面向对象编程。因此，这一方面往往被忽视。

那么，你可以做些什么呢？

### 适当的面向对象编程可以提升你深度学习（DL）代码的质量。

我不是软件工程师，生活中从未做过这类工作。所以，当我开始探索机器学习和数据科学时，我写了大量粗糙、不具可重用性的代码。

我正在逐步尝试改进自己，使用简单的代码风格增强来使其对世界上的任何人更有用。

> 而且，我发现开始在数据科学代码中混合面向对象编程原则并不难。

即使你一生中从未上过软件工程课程，一些想法可能也会自然而然地浮现给你。[**你只需设身处地思考，考虑其他人如何以建设性的方式使用你的代码**]。

+   如果你的分析中有一个代码块出现多次（形式完全相同或略有变化），你能将它封装成一个函数吗？

+   当你创建这样的函数时，哪些参数需要传递？[其中哪些可以是可选的？默认值是什么](https://www.programiz.com/python-programming/function-argument?source=post_page---------------------------)？

+   如果你遇到一个你不知道需要传递多少参数的情况，[你是否使用了 Python 提供的 *args, **kwargs](https://www.geeksforgeeks.org/args-kwargs-python/?source=post_page---------------------------)？

+   你是否为那个函数编写了 [文档字符串](https://www.geeksforgeeks.org/python-docstrings/?source=post_page---------------------------) 来让其他人知道函数的作用和期望的参数，或许还包括一个示例？

+   当你收集了一堆这样的实用函数时，你是否还在使用同一个笔记本，或者[切换到一个新的、干净的笔记本，并直接调用](http://web.cs.iastate.edu/~smkautz/cs127f16/notes/chapter07/?source=post_page---------------------------)“from *my_utility_script* import *func1, func2, func3*”（你是否将*my_utility_script*创建为一个简单的Python文件而不是Jupyter笔记本）？

+   你是否把*my_utility_script*放在了一个目录中，[在同一目录下放置一个*__init__.py*文件（即使是空的），并将其设置为一个Python模块](https://timothybramlett.com/How_to_create_a_Python_Package_with___init__py.html?source=post_page---------------------------)，以便像NumPy或Pandas一样可以导入？

+   你是否在考虑不仅仅从像NumPy和TensorFlow这样的优秀包中导入类和方法，而是[为它们添加自己的方法并扩展其功能](https://stackoverflow.com/questions/25458433/how-to-extend-class-method?source=post_page---------------------------)？

我说的这些到底是什么意思？让我们用一个简单的案例来演示——一个使用[fashion MNIST](https://github.com/zalandoresearch/fashion-mnist?source=post_page---------------------------)数据集的DL图像分类问题。

### 用DL分类任务案例说明：

### 方法

[详细的笔记本在我的Github库中给出](https://github.com/tirthajyoti/Deep-learning-with-Python/blob/master/Notebooks/OOP_principle_deep_learning.ipynb?source=post_page---------------------------)。鼓励你阅读并进行自己的分叉以便使用和扩展。

代码对于构建伟大的软件至关重要，但不一定适合Medium文章，而你阅读这些文章是为了获得见解，而不是进行调试或重构练习。

因此，我将挑选一些代码片段，并尝试指出我如何在本Notebook中编码之前详细说明的一些原则。

### 核心机器学习任务和高阶业务问题

核心机器学习任务很简单——为[**fashion MNIST**](https://github.com/zalandoresearch/fashion-mnist?source=post_page---------------------------)数据集构建一个深度学习分类器，这是对原始著名的MNIST手写数字数据集的一种有趣变体。Fashion MNIST包含60,000张28 x 28像素大小的训练图像——这些图像与时尚相关，如帽子、鞋子、裤子、T恤、裙子等。它还包含10,000张测试图像用于模型验证和测试。

![图](../Images/70adab23bb60dcdfb43ae1c220a47516.png)

**Fashion MNIST (**[**https://github.com/zalandoresearch/fashion-mnist**](https://github.com/zalandoresearch/fashion-mnist?source=post_page---------------------------)**)**

但如果围绕这个核心机器学习任务有一个高阶优化或可视化分析问题——***模型架构复杂度如何影响达到期望准确度所需的最小周期数***？

> 应该让读者明白，为什么我们还要考虑这样的问题。**因为这与整体业务优化相关**。[训练神经网络并非一个简单的计算问题](https://www.technologyreview.com/s/613630/training-a-single-ai-model-can-emit-as-much-carbon-as-five-cars-in-their-lifetimes/?source=post_page---------------------------)。因此，调查 **达到目标性能指标所需的最小训练努力以及架构选择如何影响这一点** 是有意义的。

在这个示例中，我们甚至不使用卷积网络，因为一个简单的密集连接神经网络就可以达到相当高的准确性，实际上，我们故意使用了一些次优性能来阐明我们提出的更高阶优化问题的主要观点。

### 我们的解决方案

因此，我们必须解决两个问题 -

+   如何确定达到所需准确度目标的最小轮次是多少？

+   模型的具体架构如何影响这个数字或训练行为？

为了实现这些目标，我们将使用两个简单的面向对象编程原则，

+   创建一个 [从基类对象继承的类](https://www.digitalocean.com/community/tutorials/understanding-class-inheritance-in-python-3?source=post_page---------------------------)

+   创建实用函数并从紧凑的代码块中调用它们，这些代码块可以呈现给外部用户用于更高阶优化和分析

### 代码片段以展示良好的实践

这里展示了一些代码片段，以说明如何利用简单的面向对象编程原则来实现我们的解决方案。这些片段附有注释以便于理解。

*首先，我们继承一个 Keras 类，并编写自己的子类，添加一个方法来检查训练准确度，并根据该值采取相应的行动。*

![](../Images/bd4010a9987717834876f7f1c5552bfd.png)

这个 [简单的回调函数](http://keras.io/callbacks/?source=post_page---------------------------) 结果实现了 **动态控制训练轮次** —— 当准确性达到所需阈值时，训练会自动停止。

![](../Images/257b65d8deecbf013ad98cd406f9182a.png)

我们将 Keras 模型构建代码放入一个实用函数中，以便 **可以通过一些函数参数的简单用户输入生成任意层数和架构的模型（只要它们是密集连接的）**。

![](../Images/89ad51c5f979024fb921cffb7c4b97f8.png)

我们甚至可以将编译和训练代码放入一个实用函数中，以便 **在更高阶优化循环中方便地使用这些超参数**。

![](../Images/30056cdf2206d15d4c48d431e76dbf4c.png)

接下来是可视化环节。这里，我们依然采用功能化的做法。通用的绘图函数以原始数据为输入。然而，如果我们有特定的目的，如绘制训练集准确性的变化并展示其与目标的比较，那么我们的**绘图函数应该仅以深度学习模型为输入**并生成所需的图表。

![](../Images/6b64701031704a27e0a3bd626167ddf5.png)

一个典型的结果如下所示，

![](../Images/0bdfd3c2e031522e8a65b82f7a7d4e94.png)

### 最终分析代码 — 超级紧凑且简单

现在我们可以利用之前定义的所有函数和类，并将它们整合在一起完成更高阶的任务。

因此，我们的最终代码将非常紧凑，但它将生成与上述相同的损失和准确性随训练轮次变化的有趣图表，适用于各种准确性阈值和神经网络架构。

这将使用户能够使用最少量的代码来生成关于性能指标（在本例中为准确性）和神经网络架构的视觉分析。**这是构建优化的机器学习系统的第一步。**

我们生成了几个案例进行调查，

![](../Images/d80a17328c8bc26cc0bc355ca2dce3bb.png)

我们最终的分析/优化代码简洁明了，适合高阶用户使用，**不需要了解 Keras 模型构建或回调类的复杂性**。

> 这就是面向对象编程的核心原则 — 复杂性层次的抽象，我们在深度学习任务中实现了这一点。

注意，我们如何将`print_msg=False`传递给类实例。虽然我们在初始检查/调试时需要基本的状态打印，但在优化任务中我们应当静默执行分析。如果在类定义中没有这个参数，那么我们将无法停止打印调试信息。

我们展示了一些代表性的结果，这些结果是通过执行上述代码块自动生成的。它清楚地显示了，通过少量的高阶代码，我们能够生成视觉分析，以评估不同神经网络架构在各种性能指标下的相对表现。这使得用户无需调整低级函数，即可根据其性能需求轻松判断模型的选择。

![](../Images/d3231e01d1652f36248138eddf1eb779.png)

同时，请注意每个图表的自定义标题。这些标题清晰地阐述了目标性能和神经网络的复杂性，从而使分析变得简单。

这是对绘图工具函数的小补充，但这表明在创建此类函数时需要仔细规划。如果我们没有为函数规划这样的参数，就不可能为每个图生成自定义标题。**这种 API（应用程序接口）的精心规划是良好面向对象编程（OOP）的核心部分**。

### 最后，将脚本转化为一个简单的 Python 模块。

目前，你可能正在使用 Jupyter notebook，但你可能希望将这个练习转化为一个整洁的 Python 模块，随时可以导入。

就像你写“*from matplotlib import pyplot*”一样，你可以在任何地方导入这些工具函数（Keras 模型构建、训练和绘图）。

![](../Images/30ffeea0a36dbac4577c113acf61caec.png)

### 总结与结论

我们展示了一些从 OOP 借来的简单良好实践，以应用于 DL 分析任务。对经验丰富的软件开发人员来说，这些可能看起来微不足道，但**这篇文章是为那些可能没有相关背景但应该理解在机器学习工作流中融入这些良好实践重要性的新兴数据科学家们**。

[笔记本在这里](https://github.com/tirthajyoti/Deep-learning-with-Python/blob/master/Notebooks/OOP_principle_deep_learning.ipynb?source=post_page---------------------------)。

虽然有些话可能说得太多了，但让我在这里再次总结一下良好的实践，

+   每当有机会时，**将重复的代码块转化为工具函数**。

+   **仔细考虑函数的 API**，即需要哪些最小参数集以及它们如何为更高级的编程任务服务。

+   不要忘记为函数**编写文档字符串**，即使它只是一个简短的描述。

+   如果你开始积累许多与同一对象相关的工具函数，可以考虑**将该对象转化为一个类**，并将这些工具函数作为方法放入类中。

+   **每当有机会时扩展类的功能**，通过继承来完成复杂的分析。

+   **不要停留在 Jupyter notebooks**。将它们转化为**可执行脚本**并放入一个**小模块**。养成**模块化工作**的习惯，这样可以让任何人、任何地方都能轻松重用和扩展你的工作。

谁知道呢，当你积累足够有用的类和子模块时，你可能会在 Python 包存储库（PyPi 服务器）上发布一个实用程序包。到时你将拥有发布原创开源包的 bragging right :-)

如果你有任何问题或想法分享，请通过 [**tirthajyoti[AT]gmail.com**](mailto:tirthajyoti@gmail.com?source=post_page---------------------------) 联系作者。此外，你还可以查看作者的 [**GitHub**](https://github.com/tirthajyoti?tab=repositories&source=post_page---------------------------) **库**，获取其他有趣的 Python、R 或 MATLAB 代码片段和机器学习资源。如果你像我一样，对机器学习/数据科学充满热情，请随时 [在 LinkedIn 上添加我](https://www.linkedin.com/in/tirthajyoti-sarkar-2127aa7/?source=post_page---------------------------) 或 [在 Twitter 上关注我。](https://twitter.com/tirthajyotiS?source=post_page---------------------------)

**个人简介： [提尔塔吉约提·萨尔卡](https://www.linkedin.com/in/tirthajyoti-sarkar-2127aa7/)** 是 ON Semiconductor 的高级首席工程师，专注于基于深度学习/机器学习的设计自动化项目。

[原文](https://towardsdatascience.com/how-a-simple-mix-of-object-oriented-programming-can-sharpen-your-deep-learning-prototype-19893bd969bd)。已获得许可转载。

**相关：**

+   [用 Python 进行优化：如何在最小风险下赚取最多的钱？](/2019/06/optimization-python-money-risk.html)

+   [如何在 Python 中检查回归模型的质量？](/2019/07/check-quality-regression-model-python.html)

+   [数学编程——提升数据科学的关键习惯](/2019/05/mathematical-programming-key-habit-advancing-data-science.html)

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你组织的 IT

* * *

### 更多相关内容

+   [机器学习并不像你的大脑 第 5 部分: 生物神经元……](https://www.kdnuggets.com/2022/07/machine-learning-like-brain-part-5-biological-neurons-cant-summation-inputs.html)

+   [Python: 机器学习的编程语言](https://www.kdnuggets.com/2022/06/mlm-python-programming-language-machine-learning.html)

+   [加速你的 Python 代码的 3 种简单方法](https://www.kdnuggets.com/2022/10/3-simple-ways-speed-python-code.html)

+   [简化的个性化 AI：你的无代码 GPT 适配指南](https://www.kdnuggets.com/personalized-ai-made-simple-your-no-code-guide-to-adapting-gpts)

+   [Llama, Llama, Llama: 用你的内容进行本地 RAG 的 3 个简单步骤](https://www.kdnuggets.com/3-simple-steps-to-local-rag-with-your-content)

+   [生成式 AI 如何帮助你改善数据可视化图表](https://www.kdnuggets.com/how-generative-ai-can-help-you-improve-your-data-visualization-charts)
