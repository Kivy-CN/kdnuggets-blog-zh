# 数据科学实践：Kaggle 步骤指南 – 清理数据

> 原文：[https://www.kdnuggets.com/2016/03/doing-data-science-kaggle-walkthrough-cleaning-data.html/2](https://www.kdnuggets.com/2016/03/doing-data-science-kaggle-walkthrough-cleaning-data.html/2)

### 逐步进行

在完成这个概述后，让我们开始清理 Airbnb 数据。针对 Airbnb Kaggle 比赛提供的数据集，我们将重点清理两个文件——`train_users_2.csv` 和 `test_users.csv`，并暂时不处理 `sessions.csv`。

**加载数据**

第一步是使用 Python 从 CSV 文件中加载数据。为此，我们将使用 Pandas 库，从两个文件 `train_users_2.csv` 和 `test_users.csv` 中加载数据。加载后，我们会将它们合并为一个数据集，以便对所有数据进行清理（以及以后进行任何其他更改）[1]。

```py
import pandas as pd
# Import data
print("Reading in data...")
tr_filepath = "./train_users_2.csv"
df_train = pd.read_csv(tr_filepath, header=0, index_col=None)
te_filepath = "./test_users.csv"
df_test = pd.read_csv(te_filepath, header=0, index_col=None)

# Combine into one dataset
df_all = pd.concat((df_train, df_test), axis=0, ignore_index=True)

```

**清理时间戳**

一旦数据被加载和合并，我们将进行的第一步清理是修复日期格式——正如我们在[第二部分](http://brettromero.com/wordpress/data-science-a-kaggle-walkthrough-understanding-the-data/)中看到的，至少一个日期列看起来像是格式为一个长数字。你可能会想知道为什么这是必要的——毕竟，当我们查看数据时，不是都可以看到日期应该表示什么吗？

我们需要转换日期列中的值，因为如果我们想对这些日期进行任何操作（例如，相减两个日期，提取每个日期的月份等），如果 Python 能识别这些值为日期，将会容易得多。下周，当我们开始基于这些日期信息向训练数据中添加各种新特征时，这一点将变得更加清晰。

幸运的是，修复日期格式相对简单。Pandas 提供了一个简单的函数，[to_datetime](http://pandas.pydata.org/pandas-docs/stable/generated/pandas.to_datetime.html)，可以让我们输入一列数据，并得到格式正确的日期作为结果。在使用这个函数时，我们还需要提供一个名为‘format’的参数，这类似于日期的[正则表达式](https://en.wikipedia.org/wiki/Regular_expression)。简单来说，我们为函数提供了一个通用的日期形式，以便它能够解读列中的数据。例如，对于`date_account_created`列，我们告诉函数期望一个四位数的年份（%Y），后跟一个‘-’，然后是两位数的月份（%m），接着是‘-’，最后是两位数的日期（%d）——整体表达式为‘%Y-%m-%d’（有关可以使用的完整指令列表，请参见[这里](https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior)）。对于`timestamp_first_active`列，由于提供的日期格式不同，我们会相应地调整表达式。

一旦我们修正了日期格式，就可以用更正后的数据替换现有的日期列。最后，由于`date_account_created`列有时为空，我们使用[fillna](http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.fillna.html)函数将空值替换为`date_account_created`列中的值。此步骤的代码如下：

```py
# Change Dates to consistent format
print("Fixing timestamps...")
df_all['date_account_created'] = pd.to_datetime(df_all['date_account_created'], format='%Y-%m-%d')
df_all['timestamp_first_active'] = pd.to_datetime(df_all['timestamp_first_active'], format='%Y%m%d%H%M%S')
df_all['date_account_created'].fillna(df_all.timestamp_first_active, inplace=True)

```

**移除预订日期字段**

那些跟随和/或关注的可能注意到，在原始数据集中有三个日期字段，但我们上面只覆盖了两个。剩下的日期字段`date_first_booking`，我们将从训练数据中完全删除。原因是这个字段仅对已进行预订的用户进行填充。对于训练_users_2.csv中的数据，所有具有首次预订国家的用户在`date_first_booking`列中都有值，对于那些未进行预订的用户（`country_destination` = NDF），该值是缺失的。然而，对于`test_users.csv`中的数据，`date_first_booking`列在所有记录中都是空的。

![清理数据](../Images/24e861db776514b0deb4604084003055.png)

这意味着这个列对于预测预订将在哪个国家进行没有帮助。更重要的是，如果在构建模型时将其保留在训练数据集中，可能会增加模型预测NDF的机会，因为这些记录在训练数据集中没有日期。移除该列的代码如下：

```py
# Remove date_first_booking column
df_all.drop('date_first_booking', axis=1, inplace=True)

```

**清理年龄列**

如[第二部分](http://brettromero.com/wordpress/data-science-a-kaggle-walkthrough-understanding-the-data/)所述，有几个人年龄值明显不正确（不合理的高或低）。在这一步，我们将这些错误值替换为‘NaN’，NaN字面意思是“不是一个数字”，但意味着我们不知道年龄值。换句话说，我们将错误的值转换为缺失值。为此，我们创建了一个简单的函数，该函数接收一个数据框（表格）、一个列名、一个最大可接受值（90）和一个最小可接受值（15）。然后，该函数将指定列中超出可接受范围的值替换为NaN。

再次来自[第二部分](http://brettromero.com/wordpress/data-science-a-kaggle-walkthrough-understanding-the-data/)，我们知道有相当多的用户完全没有提供年龄——因此它们在数据集中也显示为NaN。在将错误的年龄值转换为NaN后，我们将所有NaN值更改为-1。

这些步骤的代码如下所示：

```py
import numpy as np

# Remove outliers function
def remove_outliers(df, column, min_val, max_val):
col_values = df[column].values
df[column] = np.where(np.logical_or(col_values&lt;=min_val, col_values&gt;=max_val), np.NaN, col_values)
return df

# Fixing age column
print("Fixing age column...")
df_all = remove_outliers(df=df_all, column='age', min_val=15, max_val=90)
df_all['age'].fillna(-1, inplace=True)

```

如前所述，有几种更复杂的方法可以填补年龄列中的缺失值。我们选择这种简单的方法有两个主要原因：

+   清晰性——这系列文章会很长，不希望添加复杂的缺失年龄填补方法。

+   有争议的结果——在实际比赛中的测试中，我确实测试了几种更复杂的插补方法。然而，我测试的这些方法都没有比上述方法产生更好的最终结果。

**识别并填充其他缺失值列**

从对数据的更详细分析中，你可能还会发现有一列缺失值——`first_affiliate_tracked` 列。按照我们之前在其他列中填充缺失值的方法，现在我们也填充这一列的值。

```py
# Fill first_affiliate_tracked column
print("Filling first_affiliate_tracked column...")
df_all['first_affiliate_tracked'].fillna(-1, inplace=True)

```

**这就全部了吗？**

对数据处理更有经验的人可能会觉得我们对这些数据的清理做得不够——你是对的。Kaggle 比赛的一个好处是提供的数据不需要过多的清理，因为数据提供者并不希望参与者将重点放在此上。许多在现实世界数据中可能会发现的问题（如前所述）在这个数据集中并不存在，节省了我们大量时间。

然而，这种相对简单的清理过程也告诉我们，即使数据集提供的初衷是无需或仅需最小清理，仍然总会有一些事情需要处理。

### 下一次

在下一部分中，我们将重点关注数据转换和特征提取，从而创建一个训练数据集，期望能使模型做出更好的预测。为了确保你不会错过，使用下面的订阅功能。

[1] 对于那些有更多数据挖掘经验的人，你可能会意识到此阶段将测试数据和训练数据合并并不是最佳实践。最佳实践是避免在任何数据预处理或模型调整/验证步骤中使用测试数据集，以避免过拟合。然而，在这次比赛的背景下，由于我们只是试图创建一个分类单一不变数据集的模型，因此最大化该数据集模型的准确性是主要关注点。

**简介： [布雷特·罗梅罗](http://brettromero.com/)** 是一位数据分析师，拥有在多个国家和行业（包括政府、管理咨询和金融）的工作经验。目前，他在科索沃的普里什蒂纳担任数据顾问，与联合国开发计划署（UNDP）以及[开放数据科索沃](http://opendatakosovo.org/)等发展机构合作。

[原文](http://brettromero.com/wordpress/data-science-kaggle-walkthrough-cleaning-data/)。经许可转载。

**相关：**

+   [进行数据科学：Kaggle 演练第 1 部分 – 介绍](/2016/05/doing-data-science-kaggle-walkthrough-intro.html)

+   [在 Twitter 上进行数据科学](/2015/09/data-science-at-twitter.html)

+   [掌握 Python 机器学习的 7 个步骤](/2015/11/seven-steps-machine-learning-python.html)

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 为你的组织提供IT支持

* * *

### 相关文章

+   [分类指标演示：逻辑回归与…](https://www.kdnuggets.com/2022/10/classification-metrics-walkthrough-logistic-regression-accuracy-precision-recall-roc.html)

+   [集成学习技术：使用Python中的随机森林进行演示](https://www.kdnuggets.com/ensemble-learning-techniques-a-walkthrough-with-random-forests-in-python)

+   [7个免费的Kaggle微课程，适合数据科学初学者](https://www.kdnuggets.com/7-free-kaggle-micro-courses-for-data-science-beginners)

+   [2024年成为数据科学家的前10名Kaggle机器学习项目](https://www.kdnuggets.com/top-10-kaggle-machine-learning-projects-to-become-data-scientist-in-2024)

+   [在Kaggle竞赛中的前4个技巧及其重要性](https://www.kdnuggets.com/2022/05/packt-top-4-tricks-competing-kaggle-start.html)

+   [最全面的Kaggle解决方案和创意列表](https://www.kdnuggets.com/2022/11/comprehensive-list-kaggle-solutions-ideas.html)
