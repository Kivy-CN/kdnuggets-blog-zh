- en: 'Must Know for Data Scientists and Data Analysts: Causal Design Patterns'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据科学家和数据分析师必须了解：因果设计模式
- en: 原文：[https://www.kdnuggets.com/2021/03/causal-design-patterns.html](https://www.kdnuggets.com/2021/03/causal-design-patterns.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://www.kdnuggets.com/2021/03/causal-design-patterns.html](https://www.kdnuggets.com/2021/03/causal-design-patterns.html)
- en: '[comments](#comments)'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[评论](#comments)'
- en: '**By [Emily Riederer](https://twitter.com/EmilyRiederer), Senior Analytics
    Manager at Capital One**.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '**由 [Emily Riederer](https://twitter.com/EmilyRiederer)，Capital One 高级分析经理**。'
- en: '* * *'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Our Top 3 Course Recommendations
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 我们的前三个课程推荐
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google Cybersecurity
    Certificate](https://www.kdnuggets.com/google-cybersecurity) - Get on the fast
    track to a career in cybersecurity.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity)
    - 快速进入网络安全职业。'
- en: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google Data Analytics
    Professional Certificate](https://www.kdnuggets.com/google-data-analytics) - Up
    your data analytics game'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics)
    - 提升你的数据分析能力'
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT Support
    Professional Certificate](https://www.kdnuggets.com/google-itsupport) - Support
    your organization in IT'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport)
    - 支持你的组织的 IT'
- en: '* * *'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '![](../Images/6b3065f1d12e8b4d0d41a5edf9fdf287.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6b3065f1d12e8b4d0d41a5edf9fdf287.png)'
- en: '*Mnemonic illustrations of CI methods, made with [Excalidraw](https://excalidraw.com/).*'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '*因果推断方法的记忆插图，由 [Excalidraw](https://excalidraw.com/) 制作。*'
- en: Software engineers study design patterns¹ to help them recognize archetypes,
    consider approaches with a common language, and reuse tried-and-true architectures.
    Similarly, statistics has many prototypical analyses, but too often, these frameworks
    are siloed within specific disciplines and clouded by domain-specific language.
    This makes methods harder to discover and hides their general applicability. Consequently,
    it can be hard for practitioners outside of these fields to recognize when the
    problem they are facing fits one of these paradigms.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 软件工程师研究设计模式¹ 以帮助他们识别原型，考虑具有共同语言的方法，并重复使用经过验证的架构。同样，统计学有许多典型的分析，但这些框架往往被孤立在特定学科内，并被领域特定语言所遮蔽。这使得方法更难以发现，并隐藏了它们的普遍适用性。因此，来自这些领域之外的从业者可能很难识别他们面临的问题是否符合这些范式之一。
- en: Observational causal inference is one such field. The need to understand true
    causal (versus correlative) effects and to derive meaning and strategy from “found”
    historical data (as opposed to experimentally “produced” data) is nearly universal,
    but methods are scattered across epidemiology, economics, political science, and
    more.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 观察性因果推断就是其中一个领域。理解真实的因果（而非相关）效应，并从“发现”的历史数据（而非实验“产生”的数据）中推导意义和策略的需求几乎是普遍存在的，但方法分散在流行病学、经济学、政治科学等多个领域。
- en: This post aims to break down some of those barriers by briefly summarizing common
    cross-disciplinary design patterns for measuring causal effects from observational
    data with an emphasis on potential use in industry. For each method, I provide
    an illustration, an overview of the method, a summary of the required data structure
    and key assumptions, and a hypothetical consumer retail example.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这篇文章旨在通过简要总结跨学科设计模式来打破一些障碍，这些模式用于从观察数据中测量因果效应，重点是其在行业中的潜在应用。对于每种方法，我提供了插图、方法概述、所需数据结构和关键假设的总结，以及一个假设的消费者零售示例。
- en: Causal inference is complex, and doing it well requires both statistical and
    domain expertise. Instead of providing all of the details that are already eloquently
    described in countless free resources, this post humbly aims to advertise these
    methods so analysts can add them into their mental index and investigate them
    further when they encounter a relevant question.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 因果推断是复杂的，做到这一点需要统计学和领域专业知识。与其提供在无数免费资源中已被巧妙描述的所有细节，这篇文章谦逊地旨在宣传这些方法，以便分析师能够将其纳入他们的思维索引中，并在遇到相关问题时进一步研究。
- en: Why CI in Industry?
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为什么在行业中需要因果推断？
- en: Classic examples of causal questions include “Does smoking cause cancer?” and
    “Does education cause extra income?” Naively, we might compare outcomes (cancer
    or income) for those receiving the treatment (smoking and education) and those
    not. However, the fact that someone chose to smoke or pursue higher education
    creates selection bias; these behaviors likely correlate to other factors (risk-taking,
    financial support, etc.), which can also impact the outcome.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 经典的因果问题包括“吸烟是否导致癌症？”和“教育是否导致额外收入？”天真地，我们可能会比较接受处理（吸烟和教育）与未接受处理的结果（癌症或收入）。然而，选择吸烟或追求高等教育的事实会产生选择偏差；这些行为可能与其他因素（冒险精神、经济支持等）相关，这也会影响结果。
- en: In industry, businesses want to know what causal effect their strategies (e.g. promotional
    offers) have on customer behavior. Here, of course, businesses have a major advantage
    over the examples above because the assignment mechanism into the treatment group
    (e.g., whom to send a discount code) is *known* and *under their control*. They
    often also have richer “pre-treatment” behavior for each individual (customer),
    which can help both assess and correct for bias.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在行业中，企业希望知道其策略（如促销优惠）对客户行为的因果效应。当然，这里企业比上述例子有很大优势，因为分配到处理组（如，谁获得折扣码）的机制是*已知的*且*在其控制之下*。他们通常还拥有每个个体（客户）的更丰富的“处理前”行为数据，这可以帮助评估和修正偏差。
- en: However, these advantages don’t make causal inference unnecessary; if anything,
    they simply make it more possible and more relevant. Good businesses don’t act
    at random. For example, we market to customers who are likely to be interested
    in our company and who, therefore, might have been interested even without marketing.
    When it comes to measuring effectiveness, good business is bad science. Because
    our *treatments* are not given at random, comparing the *outcomes* of treated
    and untreated groups is confounded and biased towards making us think we are more
    effective than we actually may be.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这些优势并没有使因果推断变得不必要；如果有的话，它们只是使因果推断变得更可行和更相关。好的企业不会随机行动。例如，我们会向那些可能对我们公司感兴趣的客户进行营销，因此，他们即使没有营销也可能会感兴趣。在衡量效果时，好的业务是坏科学。由于我们的*处理*不是随机给予的，因此比较处理组和未处理组的*结果*会被混淆和偏向，使我们认为自己比实际情况更有效。
- en: One antidote to this is true experimentation in which treatment is randomly
    assigned *within* the homogenous target population. Experimentation, particularly
    A/B tests, have become a mainstay of industry data science, so why does observational
    causal inference matter?
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 对此的一个解药是真正的实验，其中处理是*在*同质目标人群中随机分配的。实验，尤其是A/B测试，已成为行业数据科学的主流，那么观察性因果推断为什么仍然重要呢？
- en: Some situations you cannot test due to ethics, logistics, or reputational risk.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些情况由于伦理、物流或声誉风险，你不能进行测试。
- en: Testing can be expensive. There are *direct costs* (e.g. testing a marketing
    promotion) of instituting a policy that might not be effective, *implementation
    costs* (e.g. having a tech team implement a new display), and *opportunity costs* (e.g. holding
    out a control group and not applying what you hope to be a profitable strategy
    as broadly as possible).²
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试可能很昂贵。实施可能无效的政策有*直接成本*（如测试营销促销）、*实施成本*（如让技术团队实现新的展示）和*机会成本*（如保留对照组而不尽可能广泛地应用你希望是有利的策略）。²
- en: Randomized experimentation is harder than it sounds! Sometimes experiments may
    not go as planned, but treating the results as observational data may help salvage
    some information value.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机实验比听起来要难！有时实验可能不会按计划进行，但将结果视为观察数据可能有助于挽回一些信息价值。
- en: Data collection can take time. We may want to read long-term endpoints like
    customer retention or attrition after many years.³ When we long to read an experiment
    that *wasn’t* launched three years ago, historical observational data can help
    us get a preliminary answer sooner.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据收集可能需要时间。我们可能希望在多年后阅读长期终点数据，比如客户保留或流失。³ 当我们希望查看三年前*未*推出的实验时，历史观察数据可以帮助我们更早地获得初步答案。
- en: Similarly, we can’t time travel. Some strategies that we’ve fully launched we
    cannot unwind just to test. If we regret not testing after the fact, we can potentially
    find a quasi-experiment to analyze.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样地，我们不能进行时间旅行。对于一些我们已经全面推出的策略，我们不能只是为了测试而撤回。如果我们事后遗憾没有进行测试，我们可以寻找一种准实验来进行分析。
- en: It’s not either-or but both-and. Due to the financial and temporal costs of
    experimentation, causal inference can also be a tool to help us better prioritize
    what experiments are worth running.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这不是非此即彼，而是两者兼具。由于实验的财务和时间成本，因果推断也可以成为帮助我们更好地优先考虑哪些实验值得进行的工具。
- en: Even when you can experiment, understanding observational causal inference can
    help you better identify biases and design your experiments.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即使你可以进行实验，理解观察性因果推断也能帮助你更好地识别偏倚并设计实验。
- en: Beyond these specific challenges, perhaps the best reason is that there are
    so many questions that you can answer. As we’ll see, almost all of these methods
    rely on exploiting some arbitrary amount of randomness in whether or not a specific
    individual or group received a certain treatment. Industry (and life in general)
    is full of non-random but well-defined (and somewhat arbitrary) policies, which
    make it fertile ground for observational causal inference. Analysts can embark
    on data search-and-rescue missions and find new uses in reams of historical data
    that might be otherwise discounted as hopelessly biased or outdated.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这些具体挑战，也许最好的理由是你可以回答很多问题。正如我们将看到的，这些方法几乎都依赖于利用某种任意的随机性来确定特定个体或群体是否接受了某种治疗。行业（以及生活中的其他领域）充满了非随机但定义明确（且有些任意）的政策，这使得观察性因果推断成为一个沃土。分析师可以进行数据搜救任务，在大量历史数据中找到新的用途，这些数据可能被视为无望的偏见或过时的数据。
- en: Unifying themes
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 统一主题
- en: To illustrate potential applications, this post will provide a brief overview
    of Stratification, Propensity Score Weighting, Regression Discontinuity, and Difference
    in Differences with motivating examples from consumer retail. Each of these methods
    deals with situations where different groups receive different treatments, but
    the assignment of groups was not completely random.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明潜在的应用，这篇文章将简要概述分层、倾向评分加权、回归不连续性和差分中的差异，并通过消费者零售中的动机示例来说明它们的应用。这些方法都处理不同组接受不同处理的情况，但组的分配并非完全随机。
- en: To measure a causal effect, we want to somehow consider the [potential outcomes](https://en.wikipedia.org/wiki/Rubin_causal_model) and
    be able to contrast the average outcome under the treatment versus the average
    outcome under a *counterfactual* scenario in which similar observations went untreated.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测量因果效应，我们希望以某种方式考虑[潜在结果](https://en.wikipedia.org/wiki/Rubin_causal_model)，并能够对比在治疗下的平均结果与在*反事实*情境下（即类似观察未接受治疗）的平均结果。
- en: To create this counterfactual without true randomization, these methods attempt
    to exploit different sources of partial random variation⁴ while avoiding different
    types of confounding in order to derive a valid inference.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在没有真正随机化的情况下创建这种反事实，这些方法尝试利用不同来源的部分随机变异⁴，同时避免各种混杂因素，以得出有效的推断。
- en: 'The types of partial randomization found in your historical data and the types
    of biases you are concerned about dictate which methods are applicable. In short:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 你历史数据中发现的部分随机化类型和你关心的偏倚类型决定了哪些方法适用。简言之：
- en: If you have significant overlap between “similar” treated and untreated individuals,
    but the treatment was not randomly assigned, stratification or propensity score
    weighting can help you *rebalance* your data so that your treated and untreated
    groups have a more similar distribution of traits and their average outcomes are
    more comparable.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你有“相似”处理组和未处理组之间的显著重叠，但治疗并非随机分配，分层或倾向评分加权可以帮助你*重新平衡*你的数据，使处理组和未处理组在特征分布上更为相似，其平均结果更具可比性。
- en: If you have *disjoint* treated and untreated groups partitioned by a sharp cut-off, regression
    discontinuity allows you to measure the *local* treatment effect at the juncture
    between groups.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你有通过明显的分界线划分的*不重叠*处理组和未处理组，回归不连续性允许你在组之间的交接处测量*局部*治疗效应。
- en: If treatments are assigned to different *populations*, difference-in-differences and
    event study methods help to compare different groups across multiple *time* periods.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果将治疗分配给不同的*群体*，差分中的差异和事件研究方法有助于比较跨多个*时间*周期的不同组。
- en: Stratification
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分层
- en: '![](../Images/a83f7c5f013900cf56734bb62c595a1d.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a83f7c5f013900cf56734bb62c595a1d.png)'
- en: Stratification helps us correct for imbalanced weighting of treated and control
    populations that arise due to a non-random assignment mechanism.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 分层帮助我们纠正由于非随机分配机制引起的处理组和对照组人口的不平衡权重。
- en: '**TLDR**: When you have “similar”⁵ treated and untreated *individuals* with
    different distributions on a small number of relevant dimensions, use stratification
    helps to *rebalance* these groups to make their average effects more comparable'
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**TLDR**：当你有“相似”的*个体*，但在少数相关维度上具有不同的分布时，使用分层有助于*重新平衡*这些组，使它们的平均效果更具可比性。'
- en: '**Motivating Example:**'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**激励示例：**'
- en: Suppose we attempted to A/B test “one-click instant checkout” on our Black Friday
    website and want to measure the effect on total purchase amount.⁶
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设我们在黑色星期五的网站上尝试了“一键即时结账”的A/B测试，并希望测量对总购买金额的影响。
- en: Due to a glitch in the code, web users had a 50% chance of being in the treatment
    group (i.e., seeing the button), but mobile users only had a 30% chance.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于代码中的一个小故障，网页用户有50%的概率进入治疗组（即，看到按钮），但移动用户只有30%的概率。
- en: Additionally, we know that mobile users tend to spend less per order. Thus,
    the fact that web users are *over-represented* in the treatment group means that
    simply comparing treatment versus control outcomes will bias our results and make
    the causal effect of the button appear higher than it is in actuality.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此外，我们知道移动用户每笔订单的支出倾向较少。因此，网页用户在治疗组中的*过度代表*意味着简单地比较治疗组与对照组的结果会使我们的结果偏倚，使按钮的因果效果看起来比实际要高。
- en: '**Approach:**'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**方法：**'
- en: Bin (stratify) the population by subgroups based on values of each observation’s
    characteristics.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据每个观测值的特征，将总体按子组进行分类（分层）。
- en: Calculate the average treatment effect in each subgroup.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算每个子组中的平均治疗效果。
- en: Take the weighted average of the subgroup effects, weighted for the population
    of interest (e.g. treatment distribution, control distribution, population distribution).
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 取子组效果的加权平均值，按目标人群（例如治疗分布、对照分布、总体分布）加权。
- en: '**Key Assumptions:**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键假设：**'
- en: All common causes of the treatment and the outcome can be captured through the
    covariates (more mathematically, the outcome and the treatment are independent
    conditional on the covariates).
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 治疗和结果的所有常见原因都可以通过协变量捕捉（更数学地说，结果和治疗在协变量条件下是独立的）。
- en: All observations had some positive probability of being treated. Heuristically,
    you can think of this as meaning in the image above that there are no major regions
    where there are only green control observations and no blue treatment observations.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有观测值都有一定的被治疗的正概率。从启发式角度看，你可以认为在上面的图像中，没有主要区域只有绿色对照观测值而没有蓝色治疗观测值。
- en: Only a small number of variables require adjustment (because they impact both
    the treatment likelihood and the outcome) Otherwise, we are plagued by the [curse
    of dimensionality](https://en.wikipedia.org/wiki/Curse_of_dimensionality).
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只有少数几个变量需要调整（因为它们影响治疗的可能性和结果），否则，我们将面临[**维度诅咒**](https://en.wikipedia.org/wiki/Curse_of_dimensionality)。
- en: '**Example Application:**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例应用：**'
- en: Although we could run another A/B test, we only had one shot at Black Friday
    and need to decide whether or not to include this button next year. We can calculate
    separate treatment effects within web orders versus mobile orders and then weight
    average these effects based on the overall channel distribution across all orders.
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽管我们可以进行另一个A/B测试，但我们只有一次黑色星期五的机会，需要决定是否在明年包含这个按钮。我们可以计算网页订单和移动订单中的独立治疗效果，然后根据所有订单的整体渠道分布加权平均这些效果。
- en: (Technically, with modern web design, we could make separate decisions for mobile
    and web users, so we might not actually care about the overall treatment effect.
    This is just an example.)
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: （从技术上讲，随着现代网页设计的发展，我们可以为移动和网页用户做出不同的决定，因此我们可能实际上并不关心整体治疗效果。这只是一个示例。）
- en: '**Related Methods:**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关方法：**'
- en: Propensity score weighting (covered next) can be seen as a more advanced form
    of stratification. Both methods share the goal of making the distribution of treatment
    and control groups more similar.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倾向评分加权（下一节将讨论）可以看作是一种更高级的分层形式。这两种方法的目标都是使治疗组和对照组的分布更加相似。
- en: '**Tools:**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**工具：**'
- en: This method is computationally simple, so it can essentially be done with SQL or
    any basic data wrangling package like *dplyr *or *pandas *so long as the tool
    can perform aggregations by group
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个方法计算上非常简单，因此本质上可以使用`SQL`或任何基本的数据处理包，如*dplyr*或*pandas*，只要工具能够按组执行聚合操作即可。
- en: Propensity Score Weighting
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 倾向评分加权
- en: '![](../Images/a94ff8a1ad28c6e0cda487eafb089343.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a94ff8a1ad28c6e0cda487eafb089343.png)'
- en: Similar to stratification, propensity score (think “likelihood of treatment”)
    weighting helps us correct for systemic differences between treatment and control
    populations that stem from non-random assignment mechanisms. However, this approach
    allows us to control for many observable characteristics that influence assignment
    by reducing all relevant information into a single score on which we balance.[⁷](https://emilyriederer.netlify.app/post/causal-design-patterns/#fn:7)
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于分层，倾向评分（考虑“治疗可能性”）加权帮助我们纠正治疗组和对照组之间由于非随机分配机制造成的系统性差异。然而，这种方法允许我们通过将所有相关信息减少到一个单一的评分来控制许多可观察的特征，从而进行平衡。[⁷](https://emilyriederer.netlify.app/post/causal-design-patterns/#fn:7)
- en: '**TLDR**: When you have “similar”⁸ treated and untreated *individuals* with
    different distributions on a larger number of relevant dimensions, propensity
    score weighting helps to *rebalance* these groups to make their average effects
    more comparable'
  id: totrans-63
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**TLDR**：当你有“相似”的⁸ 处理过和未处理的*个体*，但在大量相关维度上的分布不同，倾向评分加权有助于*重新平衡*这些组，使其平均效果更具可比性。'
- en: '**Motivating Example:**'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '**激励示例：**'
- en: We sent a marketing promotion text message to all of our customers for whom
    we have a valid cell phone number and want to know the causal effect on the likelihood
    to make a purchase in the next month.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们向所有有有效手机号码的客户发送了一条营销推广短信，并希望了解对下个月购买可能性的因果效应。
- en: We did not intentionally leave a control group untreated, but we can observe
    the untreated response for customers for whom we do *not* have a valid cell phone
    number.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们并没有故意将对照组留未处理，但我们可以观察到那些没有有效手机号码的客户的未处理响应。
- en: Phone number is an optional field on UI when making a purchase, so there is
    some randomness between the population; however, we know that those who do not
    provide a phone number are less frequent shoppers *on average* , but a full spectrum
    of low-to-high frequency shoppers exists in both groups
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在购买时，电话号码是UI上的一个可选字段，因此在人群之间存在一些随机性；然而，我们知道那些没有提供电话号码的人*平均*上购物频率较低，但两组中都存在从低到高频率购物者的完整谱系。
- en: Thus, if we simply compare the treated and untreated groups, the promotion will
    look *more effective* than it really was because it is being sent to generally *more
    active* customers.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 因此，如果我们仅仅比较处理过和未处理的组，促销看起来会比实际情况*更有效*，因为它被发送给了通常*更活跃*的客户。
- en: '**Approach:**'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '**方法：**'
- en: Model the probability of *receiving* the treatment (the propensity score) based
    on each observation’s observable characteristics that are relevant both to their
    treatment assignment and to their outcome.⁹
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据每个观察值的可观察特征建模*接受*治疗的概率（倾向评分），这些特征与治疗分配和结果均相关。⁹
- en: In observational data, the treatment group’s distribution of propensity scores
    will generally skew right (tend higher, shown in solid blue), and the control
    group’s distribution will skew left (tend lower, shown in solid green).
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在观察数据中，处理组的倾向评分分布通常会向右偏斜（较高，见实线蓝色），而对照组的分布会向左偏斜（较低，见实线绿色）。
- en: Use predicted probabilities (propensity scores) to weight the untreated observations
    to fit the same distribution of treatment likelihood as the control group (shown
    in dotted green).
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用预测概率（倾向评分）来加权未处理的观察值，以使其与对照组（用绿色虚线显示）的治疗可能性分布相匹配。
- en: Weights can be constructed in different ways depending on the quantity of interest
    (average treatment effect of treated, average treatment effect of population,
    average treatment effect if given to the control population, etc.).
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 权重可以根据感兴趣的量（处理过的平均处理效果、总体的平均处理效果、如果给予对照人群的平均处理效果等）以不同的方式构建。
- en: Apply weights when calculating the average outcome in each of the treated and
    control groups and subtract to find the treatment effect.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在计算每个处理组和对照组的平均结果时应用权重，然后相减以找出治疗效果。
- en: '**Key Assumptions:**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键假设：**'
- en: All common causes of the treatment and the outcome can be captured through the
    covariates (more mathematically, the outcome and the treatment are independent
    conditional on the covariates).
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过协变量可以捕捉治疗和结果的所有共同原因（从数学上讲，结果和治疗在协变量条件下是独立的）。
- en: All observations had some positive probability^(10) of being treated. Heuristically,
    you can think of this as meaning in the image above there are no regions on the
    line where the treatment or control frequency curves go all the way down to zero.
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有观察值都有一定的正概率^(10) 被处理。从启发式角度来看，你可以认为在上面的图像中，处理或对照频率曲线没有完全降到零的区域。
- en: '**Example Application:**'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例应用：**'
- en: Model the propensity of treatment (or equivalently, having a phone number on
    record) based on demographics and historical purchase behavior.
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于人口统计和历史购买行为对处理的倾向（或等同于，有记录的电话号码）进行建模。
- en: Derive weights to calculate the average treatment effect of the treated. Treated
    observations are left unweighted; for untreated observations, the weight is the
    ratio of the propensity score over one minus the propensity score.^(11) ^(12)
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 推导权重以计算被处理者的平均处理效应。被处理观察值保持不加权；对于未被处理的观察值，权重是倾向得分与一个减去倾向得分的比率。^(11) ^(12)
- en: '**Related Methods:**'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关方法：**'
- en: Stratification is conceptually similar to propensity score weighting since it
    implicitly calculates the treatment effect on a reweighted sample. There, the
    reweighting comes after computing localized effects instead of before.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分层在概念上类似于倾向得分加权，因为它隐含地计算了在重新加权样本上的处理效应。在这里，重新加权是在计算局部效应之后进行的，而不是之前。
- en: Propensity scores are sometimes also used in matching, but there are [arguments](https://www.youtube.com/watch?v=rBv39pK1iEs&list=PL0n492lUg2sjYNAtpfatEm-AuGkAmCz4G) against
    this approach.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倾向得分有时也用于匹配，但对这种方法存在 [争论](https://www.youtube.com/watch?v=rBv39pK1iEs&list=PL0n492lUg2sjYNAtpfatEm-AuGkAmCz4G)。
- en: '**Tools:**'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '**工具：**'
- en: '[WeightIt](https://cran.r-project.org/web/packages/WeightIt/index.html) R package'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[WeightIt](https://cran.r-project.org/web/packages/WeightIt/index.html) R包'
- en: Easy to implement with simple [*stats::glm()*](https://rdrr.io/r/stats/glm.html)as
    shown in Lucy D’Agostino McGowan’s [blog post](https://livefreeordichotomize.com/2019/01/17/understanding-propensity-score-weighting/).
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 易于使用简单的 [*stats::glm()*](https://rdrr.io/r/stats/glm.html)实现，如Lucy D’Agostino
    McGowan的 [博客文章](https://livefreeordichotomize.com/2019/01/17/understanding-propensity-score-weighting/)中所示。
- en: Regression Discontinuity
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 回归不连续性
- en: '![](../Images/ae4ac74d6c9e716dd169e54f65ca6d36.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ae4ac74d6c9e716dd169e54f65ca6d36.png)'
- en: Often, in real life and particularly in industry, we violate the “positive probability
    of treatment throughout the covariate space” assumption required by stratification
    and propensity score weighting. Business and public policy often use strategies
    that have sharp cut-offs (e.g., customer segmentation based on age and spend)
    with individuals on either side of this cut-off receiving different treatments.
    In such cases, we have no relevant observations to re-weight. However, we can
    apply a regression discontinuity design to understand the local effect of a treatment
    at the point of discontinuity.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实生活中，特别是在工业中，我们经常违反分层和倾向得分加权所需的“整个协变量空间中的正处理概率”假设。商业和公共政策经常使用具有严格截断的策略（例如，基于年龄和消费的客户细分），这些截断两侧的个体接受不同的处理。在这种情况下，我们没有相关的观察值来重新加权。然而，我们可以应用回归不连续性设计来理解处理在不连续点的局部效应。
- en: '**TLDR**: When you have disjoint treated and untreated *individuals* separated
    by a sharp cut-off, use the arbitrary variation in treatment assignment for those
    right above or below the cut-off to measure a local causal effect.'
  id: totrans-90
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**TLDR**: 当你有被处理和未被处理的*个体*被严格截断分开时，使用截断值上下的处理分配的任意变异来衡量局部因果效应。'
- en: '**Motivating Example:**'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**激励示例：**'
- en: Customers who have not made a purchase in 90 days are sent a “$10 Off Your Next
    Purchase” coupon.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在90天内没有进行购买的顾客会收到一张“下一次购买立减$10”的优惠券。
- en: We can use the sharp cut-off in “days since last purchase” to measure the effect
    of a coupon on spending in the next year.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用“自上次购买以来的天数”这一严格的截断值来衡量优惠券对下一年消费的影响。
- en: While it’s implausible to think that customers who haven’t purchased in 10 days
    are similar to those who have not in 150 days, customers who haven’t purchased
    in 88 days are likely not substantively different from those who have not purchased
    in 92 days except for the different treatment.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽管认为在10天内没有购买的顾客与在150天内没有购买的顾客类似是不现实的，但在88天内没有购买的顾客可能与在92天内没有购买的顾客在实质上没有显著不同，除了处理不同。
- en: '**Approach:**'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '**方法：**'
- en: A set of individuals either do or do not receive a treatment based on an arbitrary
    cut-off.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一组个体根据一个任意的截断值接受或不接受处理。
- en: Model the relationship between the “running” variable (the variable used in
    the cut-off) and the outcome on both sides of the cut-off. Then, the *local* treatment
    effect at the point of the cut-off can be determined by the difference in modeled
    outcome at this value of the running variable.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对“运行”变量（用于截断的变量）与截断两侧的结果进行建模。然后，*局部*处理效应可以通过在此“运行”变量值下建模结果的差异来确定。
- en: Note that we can only measure the *local* treatment effect *at the cut-off* –
    not the global average treatment effect, as we did with stratification and propensity
    score weighting
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注意，我们只能测量*局部*处理效应*在截断点*，而不是像使用分层和倾向得分加权那样的全局平均处理效应。
- en: '**Key Assumptions:**'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键假设：**'
- en: The assignment rule is unknown to the individuals being observed, so it cannot
    be gamed.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分配规则对被观察者来说是未知的，因此无法进行操控。
- en: The outcome of interest can be modeled as a continuous function with respect
    to the decision variable.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 感兴趣的结果可以建模为相对于决策变量的连续函数。
- en: We can fit a reasonably well-specified and simple model between the outcome
    of interest and the decision variable. Since RDD necessarily requires us to use
    estimates from the very “tails” of our model, overly complex models (e.g., high
    degree polynomials) can reach bizarre conclusions.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以拟合一个合理规范且简单的模型，以关联感兴趣的结果和决策变量。由于RDD 必须使用模型的“尾部”估计值，过于复杂的模型（例如，高次多项式）可能会得出奇怪的结论。
- en: '**Example Application:**'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例应用：**'
- en: We can model the relationship between “days since last spend” and “spend in
    the next year” and evaluate the difference in modeled values at the value of 90
    for “days since last spend”.
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以建模“自上次消费以来的天数”和“下一年消费”之间的关系，并评估在“自上次消费以来的天数”值为90时建模值的差异。
- en: A *counter-example* that violates the assumption would be advertising “Free
    Shipping and Returns over $50” and attempting to measure the effect of offering
    free shipping on future customer loyalty. Why? This cut-off is *known* to individuals
    ahead of time and can be gamed. For example, perhaps less loyal are more skeptical
    of a company’s products and more likely to return, so they might intentionally
    spend more than $50 to change their classification and gain entrance to the treatment
    group.
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 违反假设的*反例*可能是广告宣传“超过$50免费配送和退货”，并尝试测量提供免费配送对未来客户忠诚度的影响。为什么？这个截断点是*已知的*，因此可以被操控。例如，可能不太忠诚的客户对公司的产品更为怀疑，更可能退货，因此他们可能故意花费超过$50以改变他们的分类，从而进入处理组。
- en: As a side note, could you have simply A/B tested in this case? Definitely! It
    would be easy to get a fairer comparison by randomly withholding the coupon from
    some customers. However, it's unlikely that *every* historical campaign your organization
    ever ran had good randomized control. With this approach, you can still extract
    some useful insights to inform your next steps.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为附注，你是否可以在这种情况下简单地进行A/B测试？绝对可以！通过随机不给一些客户优惠券，你可以得到一个更公平的比较。然而，不太可能你的组织曾经运行的*每一个*历史活动都有良好的随机对照。通过这种方法，你仍然可以提取一些有用的见解，以指导你的下一步。
- en: '**Related Methods:**'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关方法：**'
- en: Fuzzy regression discontinuity allows for cut-off points to be probabilistic
    instead of absolute.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模糊回归不连续性允许将截断点设置为概率性的，而不是绝对的。
- en: '[Instrumental variable methods](https://en.wikipedia.org/wiki/Instrumental_variables_estimation) and
    two-stage least squares can be thought of as a broader family in which regression
    discontinuity is a simple example. More broadly, these methods address confounding
    between a treatment and an outcome by modeling the relationship between a treatment
    and an instrument which is only related to the outcome through the treatment.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[工具变量方法](https://en.wikipedia.org/wiki/Instrumental_variables_estimation)和两阶段最小二乘法可以被认为是一个更广泛的家族，其中回归不连续性是一个简单的例子。更广泛地说，这些方法通过建模处理和工具之间的关系来解决处理和结果之间的混杂问题，其中工具仅通过处理与结果相关。'
- en: '**Tools:**'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**工具：**'
- en: '[rdd](https://cran.r-project.org/web/packages/rdd/index.html) R package for
    regression discontinuity.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[rdd](https://cran.r-project.org/web/packages/rdd/index.html) R包用于回归不连续性。'
- en: '[AER](https://cran.r-project.org/web/packages/AER/index.html) R package for
    instrumental variable methods.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[AER](https://cran.r-project.org/web/packages/AER/index.html) R包用于工具变量方法。'
- en: Difference in Differences
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 差分中的差分
- en: '![](../Images/492541fd0575b7acaaa38affc8a3fca2.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/492541fd0575b7acaaa38affc8a3fca2.png)'
- en: So far, we’ve looked at methods that try to make groups as *similar* before
    treatment as possible. One way we can evaluate these methods is to see if, as
    we would expect, their values of the variable of interest before treatment are
    similar (e.g., spend in the 6 months leading up to a promotion.) However, the
    data we have available makes that intractably restrictive. Instead of looking
    for similarity in the absolute level, difference-in-differences helps us more
    flexibly settle for similarity in trajectories over time. That is, instead of
    comparing treatment and control groups within the same population at the same
    time, we can compare the *relative change* across treatment and control populations *across
    time*.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们查看了尽可能使组在处理前*相似*的方法。评估这些方法的一种方式是查看在处理前，它们的感兴趣变量的值是否相似（例如，在促销前的6个月支出）。然而，我们可用的数据使得这种绝对水平的相似性过于严格。相反，差分中的差分方法更灵活地帮助我们在时间上确定轨迹的相似性。也就是说，我们可以比较处理和对照群体*跨时间*的*相对变化*。
- en: '**TLDR**: When you have group-level treatments or data available, use random
    variation *across populations* to compare their overall trends *over time.*'
  id: totrans-116
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**TLDR**：当你有群体级别的处理或数据可用时，使用*跨群体*的随机变化来比较其*随时间变化的总体趋势*。'
- en: '**Motivating Example:**'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**动机示例：**'
- en: We want to estimate the effect of a store remodel on visits.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们想要估计商店改造对访问量的影响。
- en: A remodel affects all potential customers, so this “treatment” cannot be applied
    at the individual level; in theory, it could be randomized to individual *stores*,
    but we do not have the budget for or interest to randomly remodel many stores
    before there is evidence of a positive effect.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一次改造影响所有潜在客户，因此这种“处理”不能在个体层面上应用；理论上，它可以随机分配到个体*商店*，但我们没有预算或兴趣在有正面效果的证据出现之前随机改造许多商店。
- en: '**Approach:**'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '**方法：**'
- en: In two separate populations, one receives the treatment, and one does not. We
    believe but-for the treatment, the two populations would have similar trends in
    outcome.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在两个不同的群体中，一个接受了处理，另一个没有。我们相信，如果没有处理，这两个群体在结果上会有相似的趋势。
- en: We can estimate the treatment effect by taking the *difference* between the
    post-treatment *difference* between populations and the pre-treatment *difference* between
    populations.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以通过计算处理后群体的*差异*与处理前群体的*差异*之间的*差异*来估计处理效果。
- en: In effect, this is the same as extrapolating the counterfactual for the treated
    population in the post-treatment period if it had not received treatment (the
    dashed line in the image above).
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实际上，这与推断处理后期未接受处理的处理群体的反事实情况相同（如上图中的虚线）。
- en: Technically, this is implemented as a fixed-effects regression model.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从技术上讲，这被实施为一个固定效应回归模型。
- en: '**Key Assumptions:**'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键假设：**'
- en: The decision to treat the treatment group was not influenced by the outcome.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理组的决定并未受到结果的影响。
- en: If not for the treatment, the two groups being compared would have parallel
    trends in the outcome. Note that groups are allowed to have different *levels* but
    must have similar trends over time.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果没有处理，比较的两组在结果上会有平行的趋势。注意，组别允许有不同的*水平*，但必须在时间上有类似的趋势。
- en: There is no spill-over effect such that treating the treatment group has an
    effect on the control group.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有溢出效应，即处理处理组不会对对照组产生影响。
- en: '**Example Application:**'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例应用：**'
- en: We can estimate the effect of a store remodel on visits by comparing store traffic
    before and after the remodel with traffic at a store that did not remodel.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以通过比较改造前后商店的流量与未改造商店的流量来估计商店改造对访问量的影响。
- en: 'Note how sensitive this method is to our assumptions:'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注意这种方法对我们假设的敏感性：
- en: if the remodel is an expansion and caused by a foreseen increase in traffic,
    our first assumption is violated, and our effect will be overestimated.
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果改造是扩展并且由于预见到的流量增加，那么我们的第一个假设就被违背了，我们的效果会被高估。
- en: if the control we chose is another nearby store in the same town, we could experience
    spill-over effects where more people who would have otherwise gone to the control
    store decide to go to the treatment store instead. This again would overestimate
    the effect.
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们选择的对照是同城的另一家附近商店，我们可能会经历溢出效应，使得更多原本会去对照商店的人决定去处理商店。这将再次高估效果。
- en: Another *counter-example* that violates the assumption would be measuring the
    effect of placing a certain product brand near a store’s checkout on sales and
    using sales of a different brand of the same product as the control. Why? Since
    these products are substitutes, the product placement of the treatment group could
    “spill-over” to negatively affect sales of the control.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 另一个*反例*是测量将某个产品品牌放在商店结账处对销售的影响，并使用不同品牌的相同产品作为对照。为什么？由于这些产品是替代品，处理组的产品摆放可能会“溢出”到负面影响对照组的销售。
- en: '**Related Methods:**'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关方法：**'
- en: Variants exist that relax different assumptions. For example, we may consider
    cases in which different units receive the treatment at different times, different
    units have different (heterogenous) treatment effects, the parallel trend assumption
    only holds after conditioning on covariates, and many more scenarios.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在放宽不同假设的变体。例如，我们可以考虑不同单元在不同时间接受处理的情况，不同单元具有不同（异质的）处理效应，平行趋势假设仅在调整协变量后成立，以及更多场景。
- en: Synthetic control methods can be thought of as an extension of difference-in-differences
    where the control is a weighted average of a number of different possible controls.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 合成控制方法可以被视为差分中的扩展，其中控制是若干不同可能控制的加权平均。
- en: Bayesian structural time-series methods relax the “parallel trends” assumptions
    of difference-in-differences by modeling the relationship between time series
    (including trend and seasonal components).
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯结构时间序列方法通过建模时间序列之间的关系（包括趋势和季节性成分）来放宽差分中的平行趋势假设。
- en: '**Tools:**'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**工具：**'
- en: '[did](https://bcallaway11.github.io/did/) R package for difference-in-differences.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[did](https://bcallaway11.github.io/did/) R包用于差分中的差分。'
- en: '[Synth](https://www.jstatsoft.org/article/view/v042i13) R package for synthetic
    controls.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Synth](https://www.jstatsoft.org/article/view/v042i13) R包用于合成控制。'
- en: '[CausalImpact](http://google.github.io/CausalImpact/CausalImpact.html) R package
    for Bayesian structural time-series.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[CausalImpact](http://google.github.io/CausalImpact/CausalImpact.html) R包用于贝叶斯结构时间序列。'
- en: Implications
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 含义
- en: '![](../Images/f35a3562855b3e9c635d50f9454e7b02.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f35a3562855b3e9c635d50f9454e7b02.png)'
- en: If the examples above have at all intrigued you, there are a few more things
    to keep in mind. Explaining these design patterns is easy; implementing them when,
    and *only* when relevant is hard. Causal inference requires investment in data
    management, domain knowledge, and probabilistic reasoning.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 如果上述示例让你感到兴趣，仍有一些事情需要记住。解释这些设计模式很容易；在相关时实施它们却很困难。因果推断需要在数据管理、领域知识和概率推理上的投资。
- en: Data management is needed to ensure that data on past treatments are preserved,
    discoverable, and sufficiently detailed. All of these methods require rich data
    with measures of baseline characteristics of each individual being studied and
    a solid understanding of the treatment they received. This may seem obvious, but
    it’s easy to neglect to preserve data of sufficient granularity. For example,
    we might have a database that maps every customer’s account to a system-generated campaign_id denoting
    some marketing campaign that they participated in; however, unless information
    about that specific campaign (the specific treatment, the targeting, the timing,
    etc.) is readily available, this is not terribly useful. Additionally, as in our
    stratification example, some of the best opportunities for causal inference come
    from execution errors (or, more gently, “natural experiments”). We may be inclined
    to forget about these errors and move on, but information on events that did not
    go as intended can be powerful fodder for future analysis.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 数据管理是必需的，以确保过去处理的数据被保存、可发现且详细充分。所有这些方法都需要丰富的数据，包含每个研究对象的基线特征测量，并对他们所接受的处理有充分的理解。这可能看起来很明显，但很容易忽视保存足够详细的数据。例如，我们可能有一个数据库，将每个客户的账户映射到系统生成的 campaign_id，表示他们参与的某个营销活动；然而，除非有关该特定活动（具体处理、目标、时间等）的信息
    readily available，否则这并不是特别有用。此外，就像我们在分层示例中看到的那样，一些最佳的因果推断机会来自执行错误（或者，更温和地说，“自然实验”）。我们可能倾向于忽略这些错误并继续前进，但有关未按计划进行的事件的信息可能是未来分析的强大素材。
- en: Domain knowledge is essential to validate the assumptions. Unlike other forms
    of inference (e.g., a basic linear regression), many of the assumptions we discussed
    for the methods above cannot be computational or visually assessed (e.g., not
    like the quintessential residual or QQ plots). Instead, assumptions rely largely
    on and careful attention to detail combined with intuition and background knowledge
    from one’s domain. This means causal inference should necessarily be a human-in-the-loop
    activity.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 域知识对于验证假设至关重要。与其他形式的推断（例如，基本线性回归）不同，我们讨论的许多方法的假设无法通过计算或视觉评估（例如，不像经典的残差图或QQ图）。相反，假设很大程度上依赖于细致的关注、直觉以及来自领域的背景知识。这意味着因果推断必然应该是一个人机互动的活动。
- en: Finally, a solid grasp of probabilistic reasoning and understanding of these
    methods is also critical. As many of the resources I link below discuss at length,
    it’s easy to do causal inference wrong. For example, attempting to control for
    the wrong variables can sometimes *induce* correlations and cause biases instead
    of eliminating them.[^(13)](https://emilyriederer.netlify.app/post/causal-design-patterns/#fn:13)
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，对概率推理和这些方法的扎实掌握也很关键。正如我下面链接的许多资源详细讨论的那样，因果推断很容易做错。例如，试图控制错误的变量有时会*引入*相关性并导致偏差，而不是消除它们。[^(13)](https://emilyriederer.netlify.app/post/causal-design-patterns/#fn:13)
- en: Learn More
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 了解更多
- en: The point of this post is not to teach any one method of causal inference but
    to help raise awareness for basic causal questions, data requirements, and analysis
    designs which one might be able to use in the wild. There are a plethora of fantastic
    resources available to learn more about the specific implementation of these or
    other methods. Please check out my companion [resource roundup post](https://emilyriederer.netlify.app/post/resource-roundup-causal/) for
    links to many free books, courses, talks, tutorials, and more.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 本文的重点不是教授任何一种因果推断方法，而是帮助提高对基本因果问题、数据需求和分析设计的认识，这些是你在实际应用中可能会用到的。关于这些或其他方法的具体实施，有大量出色的资源可供学习。请查看我的[资源汇总帖子](https://emilyriederer.netlify.app/post/resource-roundup-causal/)以获取许多免费的书籍、课程、讲座、教程等链接。
- en: Footnotes
  id: totrans-151
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 脚注
- en: 'A concept popularized by the 1994 book *Design Patterns: Elements of Reusable
    Object-Oriented Software*. See more on [Wikipedia](https://en.wikipedia.org/wiki/Design_Patterns).'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这一概念由1994年出版的*《设计模式：可重用面向对象软件的元素》*一书普及。更多内容请见[维基百科](https://en.wikipedia.org/wiki/Design_Patterns)。
- en: Regarding opportunity costs, however, [multi-armed bandits](https://multithreaded.stitchfix.com/blog/2020/08/05/bandits/) can
    help balance this opportunity cost by deciding when to “explore versus exploit.”
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关于机会成本，[多臂强盗问题](https://multithreaded.stitchfix.com/blog/2020/08/05/bandits/)可以通过决定何时“探索与利用”来帮助平衡这种机会成本。
- en: Specifically, we *should *consider these endpoints. Notoriously, short-term
    tests can be superficially rosy due to a novelty effect.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 具体来说，我们*应该*考虑这些终点。众所周知，由于新颖效应，短期测试可能表面上看起来很乐观。
- en: You may see this called “exogeneity” in the economics literature.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可能会在经济学文献中看到这被称为“外生性”。
- en: What is “similarity”? Without going into too much detail, we’re specifically
    concerned here about characteristics of an individual that affect both their likelihood
    to receive the treatment of interest **and **affect the outcome of interest.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么是“相似性”？在不深入细节的情况下，我们这里特别关注的是影响个体接受感兴趣的治疗**和**影响感兴趣结果的特征。
- en: On one hand, we might think this would reduce abandoned baskets; on the other
    hand, it might decrease browsing.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一方面，我们可能认为这会减少放弃的购物车；另一方面，这可能会减少浏览量。
- en: Heuristically, you can think of it as a type of “dimensionality reduction” based
    on *relevance *instead of *variance*.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从启发式的角度看，你可以将其视为一种基于*相关性*的“维度减少”方法，而不是基于*方差*。
- en: See previous footnote on “similarity”.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 参见前面的脚注“相似性”。
- en: Note that we are modeling whether or not they *receive *treatment - not if they *respond* to
    it. This may seem unintuitive since we *know* whether or not they received treatment,
    but you can intuitively think of it as modeling how similar various untreated
    observation are to treated ones.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意，我们建模的是他们是否*接受*治疗，而不是他们是否*对治疗有反应*。这可能看起来不直观，因为我们*知道*他们是否接受了治疗，但你可以直观地将其视为建模各种未治疗观察与治疗观察的相似性。
- en: This is often called the positivity assumption.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这通常被称为积极性假设。
- en: Intuitively, you can think of this as canceling out the probability of being
    untreated (the actual state) and replacing it with the probability of receiving
    treatment (the target state) in the same way one converts 60 inches to feet by
    multiplying by (1 foot / 12 inches).
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从直观上讲，你可以将其视为抵消未治疗的概率（实际状态），并用接受治疗的概率（目标状态）来替换，就像通过乘以（1英尺 / 12英寸）将60英寸转换为英尺一样。
- en: I promised I wouldn’t get into the math and formulas in the post, but here’s
    a short numerical illustration of how this works. Suppose we have two groups A
    and B. A has 30 treated individuals and 20 untreated individuals, so the true
    propensity score is 60% (30/50). B has 10 treated individuals and 40 untreated
    individuals so the true propensity score is 20% (10/50). Thus, Group A accounts
    for 75% (30/40) of the treated group and 33% (20/60) of the untreated group. If
    the distinction between Group A and Group B suggests different performance on
    the outcome of interest, this imbalance would skew our comparison between the
    treated and untreated. Following our formula, the weight to apply to the untreated
    Group A population is 3/2 (0.6/0.4) and the weight to apply to the untreated Group
    B population is 1/4 (0.2/0.8). When we weight average our untreated group then,
    the weight on Group A in the untreated group is (20 * 3/2) / ( 20*3/2 + 40*1/4)
    = 30 / 40 = 3/4 = 75%. And voila! Now the distribution is the same as in the treated
    group. In reality, we would apply propensity scores instead to situations with *multiple *and *continuous *factors
    effecting the propensity score (not just “Groups A and B”), but a univariate and
    discrete example can make it easier to see what is happening.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我承诺不会在帖子中涉及数学和公式，但这里有一个简短的数字示例来说明这一点。假设我们有两个组A和B。A组有30个治疗个体和20个未治疗个体，因此真实的倾向评分是60%（30/50）。B组有10个治疗个体和40个未治疗个体，因此真实的倾向评分是20%（10/50）。因此，A组占治疗组的75%（30/40）和未治疗组的33%（20/60）。如果A组和B组之间的区别暗示了在感兴趣的结果上表现不同，这种不平衡会影响我们对治疗和未治疗之间的比较。按照我们的公式，未治疗A组的权重为3/2（0.6/0.4），未治疗B组的权重为1/4（0.2/0.8）。当我们加权平均未治疗组时，未治疗组中的A组权重为（20
    * 3/2）/（20*3/2 + 40*1/4）= 30 / 40 = 3/4 = 75%。瞧！现在分布与治疗组相同。实际上，我们会应用倾向评分到具有*多个*和*连续*因素影响的情境中（而不仅仅是“A组和B组”），但单变量和离散的例子可以更容易看清发生了什么。
- en: 'For more here, look for references to “collider bias” in the linked resources,
    such as [this section](https://mixtape.scunning.com/ch2.html#colliding) of *Causal
    Inference: the Mixtape*.'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更多内容，请查看链接资源中的“collider bias”相关参考资料，例如 [《因果推断：混音带》](https://mixtape.scunning.com/ch2.html#colliding)中的这一部分。
- en: '[Original](https://emilyriederer.netlify.app/post/causal-design-patterns/).
    Reposted with permission.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '[原文](https://emilyriederer.netlify.app/post/causal-design-patterns/)。已获得许可转载。'
- en: '**Bio:** [Emily Riederer](https://www.linkedin.com/in/emilyriederer/) is a
    Senior Analytics Manager at Capital One where she leads a team focused on building
    innersource analysis tools, data marts, and communities of practices to improve
    business analysis.'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '**简介：** [艾米莉·里德（Emily Riederer）](https://www.linkedin.com/in/emilyriederer/)是Capital
    One的高级分析经理，她领导一个团队，专注于构建内部源分析工具、数据集市和实践社区，以改善业务分析。'
- en: '**Related:**'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关内容：**'
- en: '[Design of Experiments in Data Science](https://www.kdnuggets.com/2020/09/design-experiments-data-science.html)'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[数据科学中的实验设计](https://www.kdnuggets.com/2020/09/design-experiments-data-science.html)'
- en: '[Microsoft’s DoWhy is a Cool Framework for Causal Inference](https://www.kdnuggets.com/2020/08/microsoft-dowhy-framework-causal-inference.html)'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[微软的DoWhy是一个很酷的因果推断框架](https://www.kdnuggets.com/2020/08/microsoft-dowhy-framework-causal-inference.html)'
- en: '[Why Ice Cream Is Linked to Shark Attacks – Correlation/Causation Smackdown](https://www.kdnuggets.com/2019/01/dr-data-ice-cream-linked-shark-attacks.html)'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[为什么冰淇淋与鲨鱼攻击有关 - 相关性/因果性对决](https://www.kdnuggets.com/2019/01/dr-data-ice-cream-linked-shark-attacks.html)'
- en: More On This Topic
  id: totrans-171
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更多相关内容
- en: '[Three R Libraries Every Data Scientist Should Know (Even if You Use Python)](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[每个数据科学家都应该知道的三个R语言库（即使你使用Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)'
- en: '[Stop Learning Data Science to Find Purpose and Find Purpose to…](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[停止学习数据科学以寻找目标，并寻找目标来……](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)'
- en: '[Top Resources for Learning Statistics for Data Science](https://www.kdnuggets.com/2021/12/springboard-top-resources-learn-data-science-statistics.html)'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[数据科学学习统计学的顶级资源](https://www.kdnuggets.com/2021/12/springboard-top-resources-learn-data-science-statistics.html)'
- en: '[The 5 Characteristics of a Successful Data Scientist](https://www.kdnuggets.com/2021/12/5-characteristics-successful-data-scientist.html)'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[成功数据科学家的5个特征](https://www.kdnuggets.com/2021/12/5-characteristics-successful-data-scientist.html)'
- en: '[A $9B AI Failure, Examined](https://www.kdnuggets.com/2021/12/9b-ai-failure-examined.html)'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[一个90亿美元的AI失败，探讨](https://www.kdnuggets.com/2021/12/9b-ai-failure-examined.html)'
- en: '[What Makes Python An Ideal Programming Language For Startups](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[是什么让Python成为初创公司的理想编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)'
