- en: Feature Engineering of DateTime Variables for Data Science, Machine Learning
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://www.kdnuggets.com/2021/04/feature-engineering-datetime-variables-data-science-machine-learning.html](https://www.kdnuggets.com/2021/04/feature-engineering-datetime-variables-data-science-machine-learning.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[comments](#comments)'
  prefs: []
  type: TYPE_NORMAL
- en: '**By [Samarth Agrawal](https://www.linkedin.com/in/samarth-agrawal-2501/),
    Data Scientist at Toyota**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4ed1b796931f51585f4049a3784eeaff.png)'
  prefs: []
  type: TYPE_IMG
- en: Feature Engineering of DateTime Variables. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: INTRODUCTION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Our Top 3 Course Recommendations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google Cybersecurity
    Certificate](https://www.kdnuggets.com/google-cybersecurity) - Get on the fast
    track to a career in cybersecurity.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google Data Analytics
    Professional Certificate](https://www.kdnuggets.com/google-data-analytics) - Up
    your data analytics game'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT Support
    Professional Certificate](https://www.kdnuggets.com/google-itsupport) - Support
    your organization in IT'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: DateTime fields require [Feature Engineering](https://www.kdnuggets.com/2018/12/feature-engineering-explained.html)
    to turn them from data to insightful information that can be used by our Machine
    Learning Models. This post is divided into 3 parts and a Bonus section towards
    the end, we will use a combination of inbuilt pandas and NumPy functions as well
    as our functions to extract useful features.
  prefs: []
  type: TYPE_NORMAL
- en: Part 1 — Extract Date / Time Components
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Part 2 — Create Boolean Flags
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Part 3 — Calculate Date / Time Differences
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bonus — Feature Engineering in 2 lines of code using `fast_ml`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: BACKGROUND
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Whenever I have worked on e-commerce related data, in some way or the other
    dataset contains DateTime columns.
  prefs: []
  type: TYPE_NORMAL
- en: User registration date-time
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User login date-time
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Transaction date-time
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Disputed transaction date-time
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: … and many more
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: At the outset, this date field gives us nothing more than a specific point on
    a timeline. But these DateTime fields are potential treasure troves of data. These
    fields are immensely powerful ‘if used rightly’ for uncovering patterns.
  prefs: []
  type: TYPE_NORMAL
- en: As a Data Scientist, your job is to bring the insight to the table, and for
    that, you are required to ask the right questions. For Ex.
  prefs: []
  type: TYPE_NORMAL
- en: '**Ques 1** — When do you see most carts getting created?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 2 **— When do you see most carts getting abandoned?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 3** — When do you see the most fraudulent transactions?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 4** — When do the maximum users subscribe?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 5** — When are certain items purchased most often?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 6** — After how many days/hours after registration user makes the first
    order?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ques 7** — After how many days of inactivity customer never returns to your
    site?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: … etc
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now, To answer these questions, you get back to data to engineer these DateTime
    fields. And then a whole lot of patterns can be discovered.
  prefs: []
  type: TYPE_NORMAL
- en: '**Part 1** of the post will provide you feature engineering steps to answer
    questions like 1, 2 & 3'
  prefs: []
  type: TYPE_NORMAL
- en: '**Ans 1** — When do you see most carts getting created? ***The first week of
    the month***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ans 2** — When do you see most carts getting abandoned? ***Wednesday-Afternoon***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ans 3** — When do you see the most fraudulent transactions? ***Friday-Late
    nite***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Part 2** of the post will provide you feature engineering steps to answer
    questions like in 4 & 5'
  prefs: []
  type: TYPE_NORMAL
- en: '**Ans 4** — When do the maximum users subscribe? ***At the start of the year***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ans 5** — When are certain items purchased most often? ***At the start of
    the month***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Part 3** of the post will provide you feature engineering steps to answer
    questions like in 6 & 7'
  prefs: []
  type: TYPE_NORMAL
- en: '**Ans 6** — After how many days/hours after registration user makes the first
    order? ***Within 2 hours***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ans 7** — After how many days of inactivity customer never returns to your
    site? ***After 14 days of inactivity***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I have used an example of e-commerce data where I have personally found a lot
    of use cases but by no means the scope of extracting information is related to
    just that. We will see in this post how some of the behaviors that can be learned
    by asking the right question ie. doing the right feature engineering has proved
    useful in multiple industries across a variety of problems.
  prefs: []
  type: TYPE_NORMAL
- en: LET’S GET STARTED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Load the dataset
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Pandas provide a very simple yet very powerful way to deal with DateTime-related
    variables by parsing them as dates. You can pass as a list all the variables that
    are date-time related in the parameter `parse_dates`.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s say you are not aware of the DateTime variables upfront and after investigating
    the data you found that some of the variables are date-time. So instead of reloading
    the data, pandas provide another useful function `to_datetime` to convert the
    data type to DateTime.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Part 1\. Extract Date / Time Component
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As illustrated in the example above, we can extract the component of the date-time
    part (`year`, `quarter`, `month`, `day`, `day_of_week`, `day_of_year`, `week_of_year`,
    `time`, `hour`, `minute`, `second`, `day_part`) from the given date-time variable.
    The below list provides several of such components that can be extracted using
    pandas inbuilt functions.
  prefs: []
  type: TYPE_NORMAL
- en: 'Syntax:'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We can extract all these components using `.dt` accessor. [Read more about the
    date accessors here](https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#basics-dt-accessors)
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/865a594fd09fdc507e55080c852fbd2d.png)'
  prefs: []
  type: TYPE_IMG
- en: Extracted components from datetime variable issued_date. Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: Below is the code as shown in the image. All the other components can also be
    extracted in a similar way
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '**Note:**'
  prefs: []
  type: TYPE_NORMAL
- en: For Monday : `day_of_week = 0`,
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tuesday : `day_of_week=1`,
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: …
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sunday : `day_of_week=6`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Creating Day Part:'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/52e9229dcc9bf851d292a6ec9fc75fff.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating day part for datetime variable issued_date. Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: Part 2\. Create Boolean Flags
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As illustrated in the example above, we can extract a lot of boolean Flags (`is_month_start`,
    `is_month_end`, `is_quarter_start`, `is_quarter_end`, `is_year_start`, `is_year_end`,
    `is_weekend`) from the given date-time variable. The below list provides several
    of such components that can be extracted using pandas inbuilt functions as well
    as by creating some of our functions.
  prefs: []
  type: TYPE_NORMAL
- en: 'Syntax:'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Again, we can use `.dt` accessor to extract a lot of these boolean flags.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/aa41450da8348b1993205f0ca49b54ef.png)'
  prefs: []
  type: TYPE_IMG
- en: Extracted boolean flags from datetime variable issued_date. Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Creating Weekend Flag:'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](../Images/4ce3c583bb90f829bdf179decda50834.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating weekend flag for datetime variable issued_date. Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: If we check the calendar, we will see that 26th of Oct, 2013 was a Saturday
    — a weekend.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Part 3\. Calculate Date / Time Differences
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Often your questions/analysis will be relative to another point of reference.
    Like,
  prefs: []
  type: TYPE_NORMAL
- en: After how many days/hours after registration user makes the first order? *registration_date
    & first_order_date*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In how many days/hours customer’s complaint was resolved? *complain_date & resolution_date*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From today, how recently customer ordered from your site? *today & last_order_date*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: …etc
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In our example dataset, we have two columns date_last_payment & date_issued.
    Let’s see what happens when we just take a difference of these 2 columns.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d4e4299913fdc2c2cf1b5cf9afe22449.png)'
  prefs: []
  type: TYPE_IMG
- en: Calculating time differences in pandas. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: 'Pandas by default provide the difference in ‘days’. Notice the `dtype: timedelta64[ns]`.'
  prefs: []
  type: TYPE_NORMAL
- en: 'From the numpy documentation:'
  prefs: []
  type: TYPE_NORMAL
- en: “Because NumPy doesn’t have a physical quantities system in its core, the timedelta64
    data type was created to complement datetime64”
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Now, if we just want the numeric part and not the entire string `947 days`,
    we can do that by using the .dt accessor.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/607f87dc7013020fc7590929cb9f4d81.png)'
  prefs: []
  type: TYPE_IMG
- en: Calculating time differences in pandas using .dt accessor. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately we can’t get the months in similar fashion.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bc4f9ebfcbfe10a6861580b07f57cc81.png)'
  prefs: []
  type: TYPE_IMG
- en: Calculating time differences in pandas using .dt accessor is not scalable. Image
    by Author.
  prefs: []
  type: TYPE_NORMAL
- en: Here the `timedelta64` from NumPy becomes very useful.
  prefs: []
  type: TYPE_NORMAL
- en: 'Syntax:'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In order to get the number of months between date loan was issued and date last
    payment was done, we will write this
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6e671aa2cc1f5543a911f1572b1fe269.png)'
  prefs: []
  type: TYPE_IMG
- en: Calculating time differences in pandas using NumPy timedelta64\. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'timedelta64 can take following parameters for calculating the difference between
    2 dates:'
  prefs: []
  type: TYPE_NORMAL
- en: ‘D’ → for Days
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ‘W’ → for Weeks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ‘M’ → for Months
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ‘Y’ → for Years
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ‘h’ → for Hours
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: BONUS!
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can use fast_ml to create all these datetime features
  prefs: []
  type: TYPE_NORMAL
- en: First, install `fast_ml` package
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: And then, from the `feature_engineering` module import the method for engineering
    date time features
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Now, this works in the exact same way as other transformers, preprocessors from
    sklearn.
  prefs: []
  type: TYPE_NORMAL
- en: Instantiate
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Transform
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/77c4c459ae7774e8713ba134f540f00f.png)'
  prefs: []
  type: TYPE_IMG
- en: Feature Engineering of Datetime variables using Fast_ml. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: All the columns are not visible in the screenshot. Let’s just look at the columns
    of the dataset
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Thanks for reading!!
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you enjoyed this, [follow me on medium](https://samarthagrawal86.medium.com/) for
    more.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your claps are a huge encouragement and help in writing more and writing better.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Interested in collaborating? Let’s connect on [Linkedin](https://www.linkedin.com/in/samarth-agrawal-2501/).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Please feel free to write your thoughts/suggestions/feedback.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Kaggle link](https://www.kaggle.com/nextbigwhat/feature-engineering-datetime-variables)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Fast_ml link](https://pypi.org/project/fast-ml/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Notebook is available at the following location with fully functional code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[**Feature Engineering of DateTime Variables**'
  prefs: []
  type: TYPE_NORMAL
- en: Explore and run machine learning code with Kaggle Notebooks | Using data from
    loan_data](https://www.kaggle.com/nextbigwhat/feature-engineering-of-datetime-variables?scriptVersionId=61041780)
  prefs: []
  type: TYPE_NORMAL
- en: '**Bio: [Samarth Agrawal](https://www.linkedin.com/in/samarth-agrawal-2501/)**
    is a Data Scientist at Toyota, and a Data Science practitioner and communicator.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Original](https://samarthagrawal86.medium.com/feature-engineering-of-datetime-variables-for-data-science-machine-learning-45e611c632ad).
    Reposted with permission.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Related:**'
  prefs: []
  type: TYPE_NORMAL
- en: '[Quick Feature Engineering with Dates Using fast.ai](/2018/03/feature-engineering-dates-fastai.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Feature Engineering for Numerical Data](/2020/09/feature-engineering-numerical-data.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Data Science 101: Normalization, Standardization, and Regularization](/2021/04/data-science-101-normalization-standardization-regularization.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: More On This Topic
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[Feature Store Summit 2022: A free conference on Feature Engineering](https://www.kdnuggets.com/2022/10/hopsworks-feature-store-summit-2022-free-conference-feature-engineering.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[A Practical Approach To Feature Engineering In Machine Learning](https://www.kdnuggets.com/2023/07/practical-approach-feature-engineering-machine-learning.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Building a Tractable, Feature Engineering Pipeline for Multivariate…](https://www.kdnuggets.com/2022/03/building-tractable-feature-engineering-pipeline-multivariate-time-series.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Using RAPIDS cuDF to Leverage GPU in Feature Engineering](https://www.kdnuggets.com/2023/06/rapids-cudf-leverage-gpu-feature-engineering.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Feature Engineering for Beginners](https://www.kdnuggets.com/feature-engineering-for-beginners)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Alternative Feature Selection Methods in Machine Learning](https://www.kdnuggets.com/2021/12/alternative-feature-selection-methods-machine-learning.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
