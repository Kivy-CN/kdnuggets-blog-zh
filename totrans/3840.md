# 使用管道编写干净的Python代码

> 原文：[https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html](https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html)

**由[Khuyen Tran](https://www.linkedin.com/in/khuyen-tran-1401/)，数据科学实习生**

## 动机

`map`和`filter`是两个高效的Python方法用于处理可迭代对象。然而，如果同时使用`map`和`filter`，代码可能会显得杂乱无章。

* * *

## 我们的三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持您的组织的IT工作

* * *

![](../Images/26fad68726a5d69256b7604825d66940.png)

作者图片

如果你可以使用管道`|`像下面这样在可迭代对象上应用多个方法，不会很好吗？

![](../Images/34e15612a6a99cfaa62ac5afd6c1c6e7.png)

作者图片

Pipe库允许你做到这一点。

## 什么是Pipe？

[Pipe](https://github.com/JulienPalard/Pipe)是一个Python库，允许你在Python中使用管道。管道(`|`)将一个方法的结果传递给另一个方法。

我喜欢Pipe，因为它在对Python可迭代对象应用多个方法时，使我的代码看起来更简洁。由于Pipe只提供了一些方法，它也非常容易学习。在这篇文章中，我将展示一些我发现最有用的方法。

要安装Pipe，请输入：

```py
pip install pipe
```

## Where — 过滤可迭代对象中的元素

类似于SQL，Pipe的`where`方法也可以用于过滤可迭代对象中的元素。

![](../Images/7a15fc6474f7fac98aeb234d46f3d22b.png)

作者图片

## Select — 将函数应用于可迭代对象

`select`方法类似于`map`方法。`select`对可迭代对象的每个元素应用一个方法。

在下面的代码中，我使用`select`将列表中的每个元素乘以2。

![](../Images/9bf7eaee1a9bb411f55f8cc09cd5c5ff.png)

作者图片

现在，你可能会想：为什么我们需要`where`和`select`这些方法，如果它们的功能与`map`和`filter`相同？

这是因为你可以使用管道将一个方法插入到另一个方法之后。因此，使用管道可以去掉嵌套的括号，使代码更具可读性。

![](../Images/34e15612a6a99cfaa62ac5afd6c1c6e7.png)

作者图片

## 展开可迭代对象

## chain — 链接可迭代对象的序列

处理嵌套的可迭代对象可能很麻烦。幸运的是，您可以使用`chain`来连接一系列可迭代对象。

![](../Images/92f59c0e36e157f3297cb328782be4a5.png)

作者图片

尽管在应用`chain`后可迭代对象的嵌套层级减少了，我们仍然有一个嵌套列表。处理深度嵌套的列表时，我们可以使用`traverse`。

## traverse — 递归展开可迭代对象

`traverse`方法可以递归地展开可迭代对象。因此，您可以使用此方法将深度嵌套的列表转换为平坦的列表。

![](../Images/1a5143597587aa2eac2c804ceeef9ffa.png)

图片来源：作者

让我们将这种方法与`select`方法结合，以获取字典的值并扁平化列表。

![](../Images/83a8a0af5bb38e72e6646b3f42fbe7f0.png)

图片来源：作者

很酷！

## 列表中的元素分组

有时，使用某个函数对列表中的元素进行分组可能会很有用。可以通过`groupby`方法轻松实现。

为了了解此方法的工作原理，让我们将一个数字列表转换为一个基于数字是否为偶数或奇数进行分组的字典。

![](../Images/637fc5ccf9f573625b2d94a0af8b06d7.png)

图片来源：作者

在上面的代码中，我们使用`groupby`将数字分组为`Even`组和`Odd`组。应用此方法后的输出如下：

```py
[('Even', <itertools._grouper at 0x7fbea8030550>),
 ('Odd', <itertools._grouper at 0x7fbea80309a0>)]
```

接下来，我们使用`select`将一个元组列表转换为字典列表，字典的键是元组中的第一个元素，值是元组中的第二个元素。

```py
[{'Even': [2, 4, 6, 8]}, {'Odd': [1, 3, 5, 7, 9]}]
```

太棒了！为了只获取大于2的值，我们可以在`select`方法内部添加`where`方法：

![](../Images/c8bfc0300e765749d13dc3cad84b019c.png)

图片来源：作者

注意输出中不再包含`2`和`1`。

## dedup — 使用键去重值

`dedup`方法去除列表中的重复项。

![](../Images/9df41f88fc23e61fc0e7513ca3eebcc2.png)

图片来源：作者

这可能听起来不太有趣，因为`set`方法也可以做到这一点。然而，这种方法更灵活，因为它使您能够通过键获取唯一元素。

例如，您可以使用这种方法获取一个小于5的唯一元素和一个大于或等于5的唯一元素。

![](../Images/d19d7abd317883a464deeacdd0018073.png)

图片来源：作者

现在，让我们将此方法与`select`和`where`结合，以获取具有重复键和`None`值的字典的值。

![](../Images/4c4ec094c3fefc8c0e362a8c7b61eafa.png)

图片来源：作者

在上面的代码中，我们：

+   删除具有相同`name`的项

+   获取`count`的值

+   仅选择整数值。

在几行代码内，我们可以对一个可迭代对象应用多种方法，同时保持代码简洁。很酷，不是吗？

## 结论

恭喜！您刚刚学会了如何使用pipe保持代码简洁且短小。我希望这篇文章能让您学到如何将复杂的可迭代操作简化为一行代码。

可以在此处随意玩弄并fork本文的源代码：

[**Data-science/pipe.ipynb at master · khuyentran1401/Data-science**](https://github.com/khuyentran1401/Data-science/blob/master/productive_tools/pipe.ipynb)

我喜欢写关于基础数据科学概念的文章，并玩转各种算法和数据科学工具。你可以在[LinkedIn](https://www.linkedin.com/in/khuyen-tran-1401/)和[Twitter](https://twitter.com/KhuyenTran16)上与我联系。

如果你想查看我写的所有文章中的代码，请给[这个仓库](https://github.com/khuyentran1401/Data-science)加个星标。关注我在 Medium 上，以便获取我最新的数据科学文章：

[**Python 清晰代码：6 个最佳实践使你的 Python 函数更具可读性**](https://towardsdatascience.com/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea4c6171d60)

[**4 个 pre-commit 插件以自动化 Python 代码审查和格式化**](https://towardsdatascience.com/4-pre-commit-plugins-to-automate-code-reviewing-and-formatting-in-python-c80c6d2e9f5)

[**Pydash：一个包含缺失 Python 实用工具的大杂烩**](https://towardsdatascience.com/pydash-a-bucket-of-missing-python-utilities-5d10365be4fc)

[**3 个 Python 技巧以自动读取、创建和运行多个文件**](https://towardsdatascience.com/3-python-tricks-to-read-create-and-run-multiple-files-automatically-5221ebaad2ba)

**简历： [Khuyen Tran](https://www.linkedin.com/in/khuyen-tran-1401/)** 是一位多产的数据科学作家，撰写了[一系列有用的数据科学主题，包含代码和文章](https://github.com/khuyentran1401/Data-science)。Khuyen 目前在寻找 2022 年 5 月后在湾区的机器学习工程师、数据科学家或开发者倡导者职位，如果你在寻找具备她技能的人选，请与她联系。

[原文](https://towardsdatascience.com/write-clean-python-code-using-pipes-1239a0f3abf5)。已获许可转载。

**相关：**

+   [关于 Python 序列的 5 个高级技巧](/2021/11/5-advanced-tips-python-sequences.html)

+   [初学者的端到端机器学习指南](/2021/12/beginner-guide-end-end-machine-learning.html)

+   [生成 Python 代码的电子表格：Mito JupyterLab 扩展](/2021/11/spreadsheet-generates-python-mito-jupyterlab-extension.html)

### 更多相关主题

+   [建立一个坚实的数据团队](https://www.kdnuggets.com/2021/12/build-solid-data-team.html)

+   [是什么让 Python 成为初创企业理想的编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)

+   [每个数据科学家都应该知道的三个 R 库（即使你使用 Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)

+   [停止学习数据科学以寻找目标，并通过寻找目标来...](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)

+   [成为伟大的数据科学家需要的 5 项关键技能](https://www.kdnuggets.com/2021/12/5-key-skills-needed-become-great-data-scientist.html)

+   [每个初学者数据科学家都应该掌握的6种预测模型](https://www.kdnuggets.com/2021/12/6-predictive-models-every-beginner-data-scientist-master.html)
