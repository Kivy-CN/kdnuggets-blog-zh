# MLOps: 模型监控 101

> 原文：[https://www.kdnuggets.com/2021/01/mlops-model-monitoring-101.html](https://www.kdnuggets.com/2021/01/mlops-model-monitoring-101.html)

[评论](#comments)

**由 [Pronojit Saha](https://www.linkedin.com/in/pronojitsaha/) 和 [Dr. Arnab Bose](https://www.linkedin.com/in/arnab-bose-phd-6369531/)，Abzooba**

![Figure](../Images/f8d9392f74429e751b9de21be042b55f.png)

*图 1：ML 工作流（图像来自 [martinfowler.com](https://martinfowler.com/articles/cd4ml.html)，2019)*

* * *

## 我们的前三大课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT

* * *

### **背景**

ML 模型正在驱动一些对业务至关重要的决策。因此，重要的是这些模型在投入生产后能保持与最新数据的相关性。如果数据分布发生偏移，即生产中的数据分布与训练时使用的数据不同，模型可能会失去上下文。模型可能还会因为生产数据中的特征不可用，或者由于实际环境发生了变化（例如 Covid19），或用户行为发生了变化，变得不再相关。监控模型行为的变化以及在推断时使用的最新数据特征因此至关重要。这确保了模型保持相关性和/或忠于模型训练阶段承诺的期望性能。

如下图 2 所示，这是一个模型监控框架的示例。目标是跟踪模型在各种指标上的表现，我们将在接下来的章节中详细讨论这些指标。但首先，让我们了解一下模型监控框架的动机。

![Image](../Images/73fba02de0b349ec15c7ae0b82acf5ba.png)![Figure](../Images/9f1c2f8eb4acec1eb1da64d17b4b6497.png)

*图 2：模型监控框架示意图（图像由作者提供）*

### **动机**

反馈循环在生活和业务的各个方面都起着重要作用。反馈循环简单易懂：你生产某样东西，测量生产的信息，并使用这些信息来改进生产。这是一个不断监控和改进的循环。任何具有可测量信息和改进空间的事物都可以纳入反馈循环，ML 模型也肯定能从中受益。

一个典型的机器学习工作流包括数据摄取、预处理、模型构建与评估，最后是部署。然而，这缺乏一个关键方面，即反馈。因此，任何“模型监控”框架的主要动机是创建这个在部署后至模型构建阶段的重要反馈循环（如图1所示）。这有助于机器学习模型通过**决定是更新模型还是继续使用现有模型**来不断改进自己。为了使这一决策得以实现，该框架应跟踪和报告在以下两种可能场景中描述的各种模型指标（详细信息见后续“指标”部分）。

1.  **场景I：** 训练数据可用，框架基于训练数据和生产（推断）数据后进行计算，并进行比较以做出决策。

1.  **场景II：** 训练数据不可用，框架仅基于部署后可用的数据计算所述模型指标。

下表列出了模型监控框架在这两种场景下生成所述指标所需的输入。

![图片](../Images/9c65180cb2a8a1e13ca4f03220fb5695.png)

根据适用的两种场景，下一节中强调的指标将被计算，以决定生产中的模型是否需要更新或其他干预措施。

### **指标**

下图给出了一个建议的模型监控指标堆栈。它定义了三种广泛的指标类型，基于指标对数据和/或机器学习模型的依赖。理想情况下，监控框架应包括所有三类中的一种或两种指标，但如果存在权衡，则可以从基础指标开始，即从操作指标开始，然后随着模型的成熟逐步增加。此外，操作指标应实时或至少每日进行监控，而稳定性和性能指标可以在每周或更长时间框架内进行监控，具体取决于领域和业务场景。

![图](../Images/cda4c0db87925dc7e1d256b9175a1896.png)

*图3：模型监控指标堆栈（作者提供的图片）*

**1\. 稳定性指标** — 这些指标帮助我们捕捉两种数据分布变化：

a) **先验概率变化** — 捕捉**预测输出和/或因变量**在训练数据和生产数据（场景I）之间或生产数据的不同时间框架（场景II）之间的分布变化。这些指标的示例包括人口稳定性指数（PSI）、差异指数（概念漂移）、错误统计（详细信息和定义将在本系列的下一篇文章中介绍）

b) **协变量漂移** — 捕捉每个**自变量**在训练数据和生产数据（情境 I）之间或生产数据的不同时间框架（情境 II）之间的分布变化。此类指标的例子包括特征稳定性指数（CSI）和新颖性指数（详细信息和定义将在本系列的下一篇文章中介绍）

**2. 性能指标** — 这些指标帮助我们检测数据中的**概念漂移**，即识别自变量和因变量之间的关系是否发生了变化（例如，后疫情时期用户在节日期间的购买方式可能已发生变化）。通过检查现有部署模型在训练时（情境 I）或在部署后前一时间框架（情境 II）的表现来实现。因此，可以决定是否重新调整部署模型。这些指标的例子包括，

a) **项目指标** 如 RMSE、R-Square 等用于回归，准确率、AUC-ROC 等用于分类。

b) **基尼系数和 KS 统计量**：一个统计量，用于衡量预测概率/类别的分离程度（仅适用于分类模型）

**3. 操作指标** — 这些指标帮助我们从使用角度确定部署模型的表现。因此，它们独立于模型类型、数据，不需要如上述两个指标所需的输入。这些指标的例子包括，

*a. 过去调用 ML API 端点的次数*

*b. 调用 ML API 端点时的延迟*

*c. 预测时的 IO/内存/CPU 使用情况*

*d. 系统正常运行时间*

*e. 磁盘利用率*

### **结论**

在 MLOps 的领域中，模型监控已经成为成熟 ML 系统的必要条件。实施这样的框架对于确保 ML 系统的一致性和鲁棒性至关重要，因为没有它，ML 系统可能会失去最终用户的“信任”，这可能是致命的。因此，在任何 ML 用例实现的整体解决方案架构中包含和规划它至关重要。

在本系列的下一篇博客中，我们将深入探讨两个最重要的模型监控指标，即稳定性和性能指标，并将看看我们如何利用它们来构建我们的模型监控框架。

**参考文献**

1.  D. Sato, A. Wider, C. Windheuser, [机器学习的持续交付](https://martinfowler.com/articles/cd4ml.html#IntroductionAndDefinition)（2019），martinfowler.com

1.  M. Stewart, [理解数据集漂移](https://towardsdatascience.com/understanding-dataset-shift-f2a5a262a766)（2019），towardsdatascience.com

[**普罗诺吉特·萨哈**](https://www.linkedin.com/in/pronojitsaha/) 是一位 AI 从业者，具有解决商业问题、架构设计和构建端到端 ML 驱动的产品与解决方案的丰富经验，他通过领导和促进跨职能团队来实现这些目标。他目前是 Abzooba 的高级分析实践负责人，除了项目执行外，他还通过培养人才、建立思想领导力和启用可扩展流程来引领和发展实践。普罗诺吉特曾在零售、医疗保健和工业 4.0 领域工作。时间序列分析和自然语言处理是他的专长，他将这些专长与其他 AI 方法应用于价格优化、再入院预测、预测性维护、基于方面的情感分析、实体识别、主题建模等用例。

[**阿纳布·博斯博士**](https://www.linkedin.com/in/arnab-bose-phd-6369531/) 是 Abzooba 的首席科学官，该公司专注于数据分析，同时也是芝加哥大学的兼职教授，他教授机器学习与预测分析、机器学习运维、时间序列分析与预测以及健康分析等课程。他拥有20年的预测分析行业经验，喜欢利用结构化和非结构化数据来预测和影响医疗、零售、金融和交通领域的行为结果。他目前的重点领域包括使用机器学习进行健康风险分层和慢性疾病管理，以及机器学习模型的生产部署和监控。

**相关内容：**

+   [MLOps – “为什么需要？” 和 “它是什么”？](/2020/12/mlops-why-required-what-is.html)

+   [使用 MLflow 在 Databricks 上进行模型实验、跟踪和注册](/2021/01/model-experiments-tracking-registration-mlflow-databricks.html)

+   [数据科学与 DevOps 相遇：使用 Jupyter、Git 和 Kubernetes 的 MLOps](/2020/08/data-science-meets-devops-mlops-jupyter-git-kubernetes.html)

### 更多相关内容

+   [用 AI 监控深伪应用的 AI 欺诈](https://www.kdnuggets.com/2023/05/fighting-ai-ai-fraud-monitoring-deepfake-applications.html)

+   [在生产环境中管理模型漂移与 MLOps](https://www.kdnuggets.com/2023/05/managing-model-drift-production-mlops.html)

+   [使用 Python 监控 MLOps 管道中的模型性能](https://www.kdnuggets.com/2023/05/monitor-model-performance-mlops-pipeline-python.html)

+   [数据科学家的线性编程 101](https://www.kdnuggets.com/2023/02/linear-programming-101-data-scientists.html)

+   [LangChain 101：构建你自己的 GPT 驱动应用](https://www.kdnuggets.com/2023/04/langchain-101-build-gptpowered-applications.html)

+   [提示工程 101：掌握有效的 LLM 通信](https://www.kdnuggets.com/prompt-engineering-101-mastering-effective-llm-communication)
