# 一瞬间搜索数百万份文档中的数千个关键词

> 原文：[https://www.kdnuggets.com/2017/09/search-millions-documents-thousands-keywords.html](https://www.kdnuggets.com/2017/09/search-millions-documents-thousands-keywords.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png)[评论](#comments)

**由 [Vikash Singh](https://medium.com/@vi3k6i5)，Belong.co**。

![](../Images/5241db5938fde65ba36e10d1a424d7e7.png)

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT

* * *

假设你有一份文档，你想知道它是否谈论 python（这是你关心的术语）

```py

-------------------------------------------------------------------------
Document: I am a python developer.
Term: python
-------------------------------------------------------------------------

```

你想检查文档是否包含“python”这个词。因此，你打开文档，按下 `ctrl+f` 并搜索“python”。然后你找到了它 :)

现在假设你有 100 个这样的术语：[python, java, github, medium, etc.]

你可以用简单的 python 代码打开文档。遍历每个术语，查看该术语是否存在。

```py

-------------------------------------------------------------------------
```

```py
Open (document) 
for each term in terms: 
    if term is present in document: print(term)
```

```py

-------------------------------------------------------------------------
```

现在假设你有 100 份文档。你可以在循环中打开每份文档。每份文档中，你搜索每个术语。

```py

-------------------------------------------------------------------------

```

```py
for document in documents: 
    Open (document)
    for each term in terms:
        if term is present in document: print(term)
```

```py

-------------------------------------------------------------------------
```

现在假设 **java** 应该匹配 **Java** 但不匹配 **javascript**。

更好的是，**java** 应该匹配 **j2ee** 和 **Java**，但不匹配 **java script**。

*(j2ee 和 java 是同义词，你注意到“java script”中的空格了吗？)*

现在事情变得有趣了。你怎么做呢？

我们去年遇到了这个问题 @[Belong.co](https://medium.com/@BelongCo)。我们注意到人们用多种方式谈论相同的术语。*Big apple* 可能是 *big apple* 或 *New York*。幸运的是，我们有一些上下文。当我们的文档谈论 *Python* 时，它 99.99% 的情况下指的是编程语言，而不是动物。

但这并没有简化我们的问题。**Java** 和 **j2ee** 对我们来说是同一个东西，但 **java script** 不是。那么，如何从数百万份文档中提取这些信息呢？

正如你所想，我们写了一段基于 *regex* 的代码。对于 100 万份文档和 2000 个关键词，代码运行了 24 小时。生活很美好 :)

但不久后我们扩展到多百万文档和 10K+ 关键词。而相同的代码现在需要 10 多天才能运行。所以我们开始寻找更好的方法。

我在办公室里问了一下，[Vinay](https://www.linkedin.com/in/vinay-pande-54810813/) 建议我看看基于 Trie 字典的方法。[Suresh](https://www.linkedin.com/in/suresh-lakshmanan/) 建议使用 [Aho Corasick 算法](https://en.wikipedia.org/wiki/Aho%E2%80%93Corasick_algorithm)。在 [Stack overflow](https://stackoverflow.com/questions/44178449/regex-replace-is-taking-time-for-millions-of-documents-how-to-make-it-faster) 上也收到了类似的建议。

结果发现，Aho Corasick 算法可以在对文档进行一次扫描时同时搜索所有关键字。这确实很厉害。

[https://youtu.be/NQ8GeVCEgBs](https://youtu.be/NQ8GeVCEgBs)

在一个样本输入上的 flashtext 演示。

我基于 Trie 数据结构编写了一个自定义实现以适应我们的用例。它运行得非常好。这个算法的关键字提取过程需要 15 分钟。比基于 *regex* 的方法缩短了 10 多天。

```py

-------------------------------------------------------------------------
```

```py
Input: I love j2ee. Keyword: j2ee=>Java 
# *Which is basically saying j2ee means Java* Output: ['Java']
```

```py

-------------------------------------------------------------------------
```

现在关键字提取效果很好。所以我还添加了在文档中用同义词替换关键字的功能。

```py
Say you want to replace ‘New Delhi’ with ‘NCR region’ in a document.
Input: I live in New Delhi.
Output: I live in NCR region.
```

我们能够在多个项目中利用这个库。这时我们决定 **开源** 它。所以这里是代码的链接 :) [https://github.com/vi3k6i5/flashtext](https://github.com/vi3k6i5/flashtext)

使用起来非常简单： *[Python 代码即将发布]*

```py

-------------------------------------------------------------------------
```

```py
$ pip install flashtext
```

```py
>>> from flashtext.keyword import KeywordProcessor
>>> keyword_processor = KeywordProcessor()
>>> keyword_processor.add_keyword('j2ee', 'Java')
>>> keyword_processor.add_keyword('Python')
>>> keyword_processor.extract_keywords('I work on python and j2ee')
# output: ['Python', 'Java']
```

以及关键字替换：

```py
>>> keyword_processor.add_keyword('New Delhi', 'NCR region')
>>> keyword_processor.replace_keywords('I live in New Delhi.')
# output: 'I live in NCR region.'
```

```py

-------------------------------------------------------------------------
```

这非常有用，因为它有助于术语扩展。比如你想在产品目录中将 ***RC car*** 替换为 ***遥控车***。或者说你想将 ***Electrocardiogram*** 提取为 ***ECG***。这两者都很容易实现。

* * *

如果你认识从事实体识别或 NER、NLP 或 Word2vec 的人，请与他们分享这个博客。这个库在这些领域对我们非常有用。我相信对其他人也会有帮助。

干杯 :)

[原文](https://medium.com/@vi3k6i5/search-millions-of-documents-for-thousands-of-keywords-in-a-flash-b39e5d1e126a)。经允许转载。

**简历： [Vikash Singh](https://medium.com/@vi3k6i5)** 是 belong.co 的数据科学家，处理大量文本以及基于词嵌入的多个项目。

**相关：**

+   [Python 超越 R，成为数据科学、机器学习平台的领导者](/2017/08/python-overtakes-r-leader-analytics-data-science.html)

+   [5 个免费的深度学习资源，用于自然语言处理入门](/2017/07/5-free-resources-getting-started-deep-learning-nlp.html)

+   [文本挖掘基础：从简历中挖掘信息](/2017/05/text-mining-information-resume.html)

### 更多相关内容

+   [如何在几秒钟内处理具有百万行的数据框](https://www.kdnuggets.com/2022/01/process-dataframe-millions-rows-seconds.html)

+   [使用网格搜索和随机搜索进行超参数调优的 Python 方法](https://www.kdnuggets.com/2022/10/hyperparameter-tuning-grid-search-random-search-python.html)

+   [通过Uplimit的机器学习搜索课程提升你的搜索引擎技能！](https://www.kdnuggets.com/2023/10/uplimit-elevate-your-search-engine-skills-search-with-ml-course)

+   [构建视觉搜索引擎 - 第2部分：搜索引擎](https://www.kdnuggets.com/2022/02/building-visual-search-engine-part-2.html)

+   [使用BERT对长文本进行分类](https://www.kdnuggets.com/2022/02/classifying-long-text-documents-bert.html)

+   [GPT4All是你文档的本地ChatGPT，并且是免费的！](https://www.kdnuggets.com/2023/06/gpt4all-local-chatgpt-documents-free.html)
