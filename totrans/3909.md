# 学习 SQL 的艰难方式

> 原文：[https://www.kdnuggets.com/2020/01/learning-sql-hard-way.html](https://www.kdnuggets.com/2020/01/learning-sql-hard-way.html)

[评论](#comments) ![图](../Images/13db05514298ed074e5db11a883f6d74.png)

[来源](https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1246836)

***一个不懂 SQL 的数据科学家是不值得的。***

在我看来，这在各方面都是正确的。虽然我们在创建模型和提出不同的假设时会感到更有成就感，但数据处理的角色不容忽视。

考虑到 SQL 在 ETL 和数据准备任务中的普遍性，每个人都应该了解一点 SQL，以便至少能够有所帮助。

我仍然记得第一次接触 SQL 的情景。这是我学到的第一个语言（如果你可以这么称呼它）。它给我留下了深刻的印象。我能够自动化很多事情，这是我之前从未考虑过的。

在学习 SQL 之前，我曾使用 Excel —— VLOOKUP 和数据透视表。我在创建报告系统，一遍又一遍地做着相同的工作。SQL 让这些问题迎刃而解。现在我可以编写一个大的脚本，一切都能自动化——所有的交叉表和分析都能实时生成。

这就是 SQL 的强大之处。虽然你可以使用 [Pandas](https://towardsdatascience.com/minimal-pandas-subset-for-data-scientists-6355059629ae) 完成你在 SQL 中做的任何事情，但你仍然需要学习 SQL 来处理像 HIVE、Teradata 有时还包括 [Spark](https://towardsdatascience.com/the-hitchhikers-guide-to-handle-big-data-using-spark-90b9be0fe89a) 这样的系统。

***这篇文章关于安装 SQL、解释 SQL 和运行 SQL。***

### 设置 SQL 环境

现在学习 SQL 的最佳方式是亲自动手实践（对于任何你想学习的东西，我都可以这么说）。

我建议不要使用像 w3schools/tutorialspoint 这样的基于网络的 SQL 教程，因为你无法在其中使用自己的数据。

此外，我建议你学习 MySQL 版本的 SQL，因为它是开源的，易于在你的笔记本电脑上设置，并且有一个很棒的客户端 MySQL Workbench 可以让你的工作更加轻松。

在我们解决了这些要点之后，这里是逐步设置 MySQL 的步骤：

+   你可以从 [Download MySQL Community Server](http://dev.mysql.com/downloads/mysql/) 下载适用于你的系统（MACOSX、Linux、Windows）的 MySQL。在我的情况下，我下载了 DMG 文件。之后，双击并安装该文件。***你可能需要设置一个密码。请记住这个密码，因为稍后连接到 MySQL 实例时会需要它。***

![](../Images/3c4eed91fd996402626030cb61854b7d.png)

+   创建一个名为 `my.cnf` 的文件，并在其中放入以下内容。这是为了给你的 SQL 数据库提供本地文件读取权限。

```py
[client]
port= 3306
[mysqld]
port= 3306
secure_file_priv=''
local-infile=1
```

+   打开 `System Preferences>MySQL`。前往 `Configuration` 并使用选择按钮浏览到 `my.cnf` 文件。

![](../Images/dbdba9b4617492492975cdbe43db35cd.png)

+   从`Instances`标签中重启服务器，点击停止然后开始。

![](../Images/5c14873af530f6d27fc8d40a7a750dd8.png)

+   一旦服务器运行起来，下载并安装MySQL工作台：[下载MySQL工作台](https://dev.mysql.com/downloads/workbench/)。工作台为你提供了一个编辑器，用于编写SQL查询并以结构化方式获取结果。

![](../Images/9e29b2c92b14ad7944239e656b8e742d.png)

+   现在打开MySQL工作台并通过它连接到SQL。你将看到类似于下面的内容。

![](../Images/11ce893e1e9a7772636dabdffeada7ee.png)

+   你会看到本地实例连接已为你事先设置好。现在，你只需点击该连接并使用我们之前为MySQL服务器设置的密码开始使用（如果你有地址、端口号、用户名和密码，也可以创建到其他SQL服务器的连接，即使该服务器不在你的计算机上）。

![](../Images/d802212164a29bc8fb09306e11796c66.png)

+   然后你可以在特定的数据库上编写查询。

![](../Images/663f54d0f39e89de06eeb028f11ba03d.png)

+   查看左上角的`Schemas`标签，查看当前存在的表。只有一个`sys`模式，包含`sys_config`表。不是一个有趣的数据源来学习SQL。所以让我们安装一些数据来练习。

+   如果你有自己的数据可用，那就很好。你可以创建一个新的模式（数据库）并使用以下命令将其上传到表中。（你可以通过使用`Cmd+Enter`或点击⚡️闪电按钮运行这些命令）

![](../Images/8e1326c4743f556367d0b7fa53d7b255.png)

在本教程中，我将使用Sakila Movie数据库，你可以通过以下步骤安装它：

+   前往[MySQL Documentation](https://dev.mysql.com/doc/index-other.html)并下载Sakila ZIP文件。

+   解压文件。

+   现在前往MySQL工作台，选择文件>运行SQL脚本>选择位置`sakila-db/sakila-schema.sql`

+   打开MySQL工作台，选择文件 > 运行SQL脚本 > 选择位置`sakila-db/sakila-data.sql`

一旦你这样做，你会看到SCHEMA列表中新增了一个数据库。

![](../Images/991e5cf0916018acdb5f0fdd212bc8e1.png)

### 操作数据

现在我们有一些数据了。最终。

让我们开始编写一些查询。

你可以尝试通过[Sakila Sample Database](https://dev.mysql.com/doc/sakila/en/sakila-structure.html)文档详细了解Sakila数据库的模式。

![Figure](../Images/43d77ee6e78931b44af4b8cfcb57ca88.png)

模式图

现在任何SQL查询的基本语法是：

```py
SELECT col1, SUM(col2) as col2sum, AVG(col3) as col3avg FROM table_name WHERE col4 = 'some_value' GROUP BY col1 ORDER BY col2sum DESC;
```

这个查询中有四个元素：

1.  **SELECT**: 选择哪些列？在这里我们选择`col1`，对`col2`进行SUM聚合，对`col3`进行AVG聚合。我们还使用`as`关键字为`SUM(col2)`指定一个新名称。这称为别名。

1.  **FROM**: 我们应该从哪个表中选择？

1.  **WHERE**: 我们可以使用WHERE语句来筛选数据。

1.  **GROUP BY**: 所有未在聚合中的选定列应在GROUP BY中。

1.  **ORDER BY**: 按`col2sum`排序

上述查询将帮助你完成大多数简单的数据库查找。

例如，我们可以使用以下查询来找出不同审查评级的电影如何在时间上有所不同：

```py
SELECT rating, avg(length) as length_avg FROM sakila.film group by rating order by length_avg desc;
```

![](../Images/b4d8c6f364a0761c7610379a26aee215.png)

### 练习：提出一个问题

你现在应该提出自己的一些问题。

例如，你可以尝试找出2006年发布的所有电影，或者找出所有评级为PG且时长超过50分钟的电影。

你可以通过在MySQL Workbench中运行以下命令来完成这个操作：

```py
select * from sakila.film where release_year = 2006; 
select * from sakila.film where length>50 and rating="PG";
```

### SQL中的联接

到目前为止，我们已经学习了如何处理单个表。但实际上，我们需要处理多个表。

那么，接下来我们想要学习的是如何进行联接。

现在，联接是MySQL数据库的一个重要和必要的部分，理解它们是必需的。下面的视觉展示了SQL中大多数存在的联接。我通常只使用LEFT JOIN和INNER JOIN，所以我将从LEFT JOIN开始。

![](../Images/9f7d5a2f96baaabc9eb8c393ad920260.png)

LEFT JOIN 用于当你想保留左表（A）中的所有记录，并将B合并在匹配的记录上。A中未与B合并的记录在结果表中保持为NULL。MySQL 语法是：

```py
SELECT A.col1, A.col2, B.col3, B.col4 from A LEFT JOIN B on A.col2=B.col3
```

在这里，我们从表A中选择col1和col2，从表B中选择col3和col4。我们还使用ON语句指定要联接的共同列。

当你想合并A和B并且只保留A和B中共同的记录时，使用INNER JOIN。

### 示例：

举个例子，让我们回到Sakila数据库。假设我们想找出库存中每部电影的副本数量。你可以通过使用以下查询来得到：

```py
SELECT film_id,count(film_id) as num_copies FROM sakila.inventory group by film_id order by num_copies desc;
```

![](../Images/85fd177569d265e448ae8c633002fe7d.png)

这个结果看起来有趣吗？不太。ID 对我们人类没有意义，如果我们能获取电影的名称，我们将能更好地处理信息。因此，我们调查发现表`film`中有`film_id`以及电影的`title`。

既然我们有了所有数据，那我们如何将它们汇总到一个视图中呢？

来进行联接吧。我们需要将`title`添加到我们的库存表信息中。我们可以使用—

```py
SELECT A.*, B.title from sakila.inventory A left join sakila.film B on A.film_id = B.film_id
```

![](../Images/d70bfc61f0adbfb45d1ffad053b0035c.png)

这将向你的库存表信息中添加另一列。正如你可能注意到的，一些电影在`film`表中，但我们在`inventory`中没有。我们使用了左联接，因为我们想保留库存表中的所有内容，并将其与`film`表中的相应内容进行联接，而不是`film`表中的所有内容。

现在我们在数据中得到了另一个字段作为标题。这正是我们想要的，但我们还没有解决整个难题。我们想要的是`title`和库存中的`num_copies`。

但在进一步深入之前，我们应该先理解内查询的概念。

### 内查询：

现在你有了一个可以提供上述结果的查询。你可以做的一件事是使用

```py
create table sakila.temp_table as SELECT A.*, B.title from sakila.inventory A left join sakila.film B on A.film_id = B.film_id;
```

然后使用简单的分组操作：

```py
select title, count(title) as num_copies from sakila.temp_table group by title order by num_copies desc;
```

![](../Images/4cce562f2edff7c3641fe21d0e113b21.png)

但这一步有些过多了。我们还必须创建一个临时表，这会占用系统空间。

SQL 为这些问题提供了内查询的概念。你可以改为使用以下方法将所有这些写在一个查询中：

```py
select temp.title, count(temp.title) as num_copies from (SELECT A.*, B.title from sakila.inventory A left join sakila.film B on A.film_id = B.film_id) temp group by title order by num_copies desc;
```

![](../Images/7363abc55e8eacc55ebd2e9bf786bdc8.png)

我们在这里做的是将第一个查询用括号括起来，并给那个表一个别名 `temp`。然后我们就像考虑任何表一样考虑 `temp` 进行分组操作。正是因为内查询的概念，我们才能编写有时跨越多页的 SQL 查询。

### **HAVING 子句**

HAVING 是另一个有用的 SQL 构造。我们已经得到了结果，现在我们想找出复制数量少于或等于 2 的电影。

我们可以通过使用内查询概念和 WHERE 子句来完成这项任务。在这里，我们将一个内查询嵌套在另一个查询中。非常简洁。

![](../Images/bb399d38acd4af4db2d8993f1118ffb5.png)

或者，我们可以使用 HAVING 子句。

![](../Images/66954520e84bf07ab159b5dd7dbad670.png)

HAVING 子句用于对最终聚合结果进行筛选。它与 WHERE 不同，因为 WHERE 用于筛选 FROM 语句中使用的表。HAVING 在 GROUP BY 发生后筛选最终结果。

正如你在上述示例中已经看到的，使用 SQL 做同样的事情有很多方法。我们需要尝试提出最简洁的方法，因此在许多情况下 HAVING 是合理的。

如果你能跟到这里，你已经比大多数人掌握了更多的 SQL 知识。

下一步：***练习***。

尝试提出关于你的数据集的问题，并尝试使用 SQL 找出你的答案。

一些我可以提供的问题作为开始：

1.  ***我们库存中哪位演员拥有最多的独特电影？***

1.  ***我们库存中最受租赁的电影类型是哪些？***

### 继续学习

这只是一个关于如何使用 SQL 的简单教程。如果你想了解更多关于 SQL 的知识，我推荐一个由加州大学提供的优秀课程[SQL for Data Science](https://click.linksynergy.com/link?id=lVarvwc5BD0&offerid=467035.11605513096&type=2&murl=https%3A%2F%2Fwww.coursera.org%2Flearn%2Fsql-for-data-science)。请查看一下，因为它涉及了其他 SQL 概念，如 UNION、字符串操作、函数、日期处理等。

我将来会写更多面向初学者的文章。请关注我在 [**Medium**](https://medium.com/@rahul_agarwal) 或订阅我的 [**博客**](http://eepurl.com/dbQnuX) ，以获取最新内容。欢迎反馈和建设性批评，可以在 Twitter 上联系我 [@mlwhiz](https://twitter.com/MLWhiz)。

另附小声明 — 本文可能包含一些与相关资源相关的附属链接，因为分享知识永远不是坏事。

**简介：[Rahul Agarwal](https://www.linkedin.com/in/rahulagwl/)** 是 WalmartLabs 的高级统计分析师。在 Twitter 上关注他 [@mlwhiz](https://twitter.com/MLWhiz)。

[原文](https://towardsdatascience.com/learning-sql-the-hard-way-4173f11b26f1)。转载经许可。

**相关：**

+   [掌握 SQL 数据科学的 7 个步骤 — 2019 版](/2019/05/7-steps-mastering-sql-data-science-2019-edition.html)

+   [你将需要的最后一本 SQL 数据分析指南](/2019/10/last-sql-guide-data-analysis-ever-need.html)

+   [数据科学家的 6 条建议](/2019/09/advice-data-scientists.html)

* * *

## 我们的 3 个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速入门网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你所在组织的 IT 工作

* * *

### 更多相关内容

+   [停止学习数据科学以寻找目的，并为……寻找目的](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)

+   [学习数据科学统计的顶级资源](https://www.kdnuggets.com/2021/12/springboard-top-resources-learn-data-science-statistics.html)

+   [一个 90 亿美元的 AI 失败，剖析](https://www.kdnuggets.com/2021/12/9b-ai-failure-examined.html)

+   [成功数据科学家的 5 个特征](https://www.kdnuggets.com/2021/12/5-characteristics-successful-data-scientist.html)

+   [是什么让 Python 成为初创公司的理想编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)

+   [每个数据科学家都应该了解的三个 R 库（即使你使用 Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)
