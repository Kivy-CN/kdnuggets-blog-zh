- en: A Guide for Customer Retention Analysis with SQL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://www.kdnuggets.com/2017/12/guide-customer-retention-analysis-sql.html](https://www.kdnuggets.com/2017/12/guide-customer-retention-analysis-sql.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [comments](/2017/12/guide-customer-retention-analysis-sql.html?page=2#comments)'
  prefs: []
  type: TYPE_IMG
- en: '**By Luba Belokon, [Statsbot](https://statsbot.co/)**'
  prefs: []
  type: TYPE_NORMAL
- en: Whether you’re selling groceries, financial services, or gym memberships, successful
    recruitment of new customers is only truly successful if they return to buy from
    you again. The metric which reflects this is called **retention**, and the approach
    we use is customer retention analysis. It’s one of the key metrics that influences
    revenue. When your customers’ retention is law, you’ll spend all of the income
    from your business on marketing.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Our Top 3 Course Recommendations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google Cybersecurity
    Certificate](https://www.kdnuggets.com/google-cybersecurity) - Get on the fast
    track to a career in cybersecurity.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google Data Analytics
    Professional Certificate](https://www.kdnuggets.com/google-data-analytics) - Up
    your data analytics game'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT Support
    Professional Certificate](https://www.kdnuggets.com/google-itsupport) - Support
    your organization in IT'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: At the same time, retention is easy to improve if you can calculate it the right
    way using SQL and your database. In this post, we’ll guide you step by step on
    how to make basic customer retention analysis, how to build customer retention
    over time, new vs. existing customers retention curves, and how to calculate retention
    analysis in cohorts.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4dafe15272d5880e5a4895c828c73092.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Basic customer retention curves**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Customer retention curves are essential to any business looking to understand
    its clients, and will go a long way towards explaining other things like sales
    figures or the impact of marketing initiatives. They are an easy way to visualize
    a key interaction between customers and the business, which is to say, whether
    or not customers return — and at what rate — after the first visit.
  prefs: []
  type: TYPE_NORMAL
- en: The first step to building a customer retention curve is to identify those who
    visited your business during the reference period, what I will call p1\. It is
    important that the length of the period chosen is a reasonable one, and reflects
    expected frequency of visits.
  prefs: []
  type: TYPE_NORMAL
- en: 'Different types of businesses are going to expect their customers to return
    at different rates:'
  prefs: []
  type: TYPE_NORMAL
- en: A coffee shop may choose to use an expected frequency of visits of once a week.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A supermarket may choose a longer period, perhaps 2 weeks or a month.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the following example, I will use a month, and assume that we are looking
    at customer retention of customers who visited in January 2016 over the following
    year.
  prefs: []
  type: TYPE_NORMAL
- en: 'As previously stated, the first step is to identify the original pool of customers:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, we look at how those customers behaved over time: for example, how many
    of them returned per month over the rest of the year?'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the original SELECT function is included in this second step.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we had 1000 unique customers in January, we can expect our results to look
    something like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9e5c1c04cff6ee179ae47d2e59425704.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The resulting graph would then look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8e8edcb227c54109061bdea06175072b.png)'
  prefs: []
  type: TYPE_IMG
- en: Data visualized with [Statsbot](https://statsbot.co/solutions/product-analytics?utm_source=blog&utm_medium=article&utm_campaign=retention)
  prefs: []
  type: TYPE_NORMAL
- en: '**Evolution of customer retention over time**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: What is described above is obviously only the first step, as we would also like
    to see whether there are any trends in customer retention, i.e. are we getting
    any better at it?
  prefs: []
  type: TYPE_NORMAL
- en: 'So, one idea we might have is to say: of those who came in January, how many
    returned in February? Of those who came in February, how many returned in March?
    And other one-month intervals.'
  prefs: []
  type: TYPE_NORMAL
- en: So, then we need to set up an iterative model, which can be built in a few simple
    steps. First, we need to create a table where each user’s visits are logged by
    month, allowing for the possibility that these will have occurred over multiple
    years since whenever our business started operations. I have assumed here that
    the start date is the year 2000, but you can adjust this as necessary.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'This will give us a view that looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b3facb2b4c2007e2a35a9a0ad14377b5.png)'
  prefs: []
  type: TYPE_IMG
- en: We then need to reorganize this information in order to identify the time lapse
    between each visit. So, for each person and for each month, see when the next
    visit is.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/f711558056104b3bd5419449a25b0abb.png)'
  prefs: []
  type: TYPE_IMG
- en: 'We then need to calculate the time gaps between visits:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/3d0161fb4389e0fa881503732e980adf.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now, a small reminder of what customer retention analysis measures: it is the
    proportion of customers who return after x lag of time. So, what we want to do
    is compare the number of customers visiting in a given month to how many of those
    return the next month. We also want to define those who return after a certain
    absence, and those who don’t return at all. In order to do that, we need to categorize
    the customers depending on their visit pattern.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: This will allow us, in a final step, to establish a count of the number of customers
    who visited in a given month, and how many of those return the next month.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: This gives us, month by month, the proportion of customers who returned.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/92c95efb32cb152b198bfe7dbffaace8.png)'
  prefs: []
  type: TYPE_IMG
- en: Data visualized with [Statsbot](https://statsbot.co/solutions/product-analytics?utm_source=blog&utm_medium=article&utm_campaign=retention)
  prefs: []
  type: TYPE_NORMAL
- en: More On This Topic
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[How To Collect Data For Customer Sentiment Analysis](https://www.kdnuggets.com/2022/12/collect-data-customer-sentiment-analysis.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[A Step by Step Guide to Reading and Understanding SQL Queries](https://www.kdnuggets.com/a-step-by-step-guide-to-reading-and-understanding-sql-queries)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Breaking Down DENSE_RANK(): A Step-by-Step Guide for SQL Enthusiasts](https://www.kdnuggets.com/breaking-down-denserank-a-step-by-step-guide-for-sql-enthusiasts)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Essential Guide to SQL’s Execution Order](https://www.kdnuggets.com/the-essential-guide-to-sql-execution-order)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Data Cleaning in SQL: How To Prepare Messy Data for Analysis](https://www.kdnuggets.com/data-cleaning-in-sql-how-to-prepare-messy-data-for-analysis)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Collection of Guides on Mastering SQL, Python, Data Cleaning, Data…](https://www.kdnuggets.com/collection-of-guides-on-mastering-sql-python-data-cleaning-data-wrangling-and-exploratory-data-analysis)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
