# 结合不同方法创建高级时间序列预测

> 原文：[https://www.kdnuggets.com/2016/11/combining-different-methods-create-advanced-time-series-prediction.html](https://www.kdnuggets.com/2016/11/combining-different-methods-create-advanced-time-series-prediction.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

**Taras Firman, [ELEKS](http://eleks.com/) 的数据科学家**。

今天，企业需要能够预测需求和趋势，以跟上突如其来的市场变化和经济波动。这正是由数据科学驱动的预测工具发挥作用的地方，帮助组织成功应对战略和产能规划。智能预测技术可以用来降低可能的风险，并帮助做出明智的决策。我们的一个客户，来自中东的企业，需要预测未来十二周的市场需求。他们需要市场预测来帮助他们设定短期目标，如生产策略，并协助产能规划和价格控制。因此，我们提出了一个定制时间序列模型的想法，能够应对这一挑战。在这篇文章中，我们将介绍建模过程以及我们在过程中必须克服的难题。

### 有许多方法可以构建时间序列预测……但没有一种适合我们

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业轨道

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google 数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT

* * *

随着基于机器学习的强大预测方法的出现，未来的预测变得更加准确。一般来说，预测技术可以分为两类：定性预测和定量预测。定性预测在没有数据可用的情况下应用，预测仅基于专家判断。定量预测则基于时间序列建模。这类模型使用历史数据，尤其在预测一些在时间段内发生的事件时非常有效：例如价格、销售数据、生产量等。

现有的时间序列预测模型包括[ARIMA模型](https://onlinecourses.science.psu.edu/stat510/node/49)，主要用于建模时间序列数据而不直接处理季节性；[VAR模型](https://onlinecourses.science.psu.edu/stat510/node/79)、[Holt-Winters](https://www.otexts.org/fpp/7/5)季节性方法、[TAR模型](https://onlinecourses.science.psu.edu/stat510/node/82)等。不幸的是，这些算法可能无法提供所需的预测精度，因为它们可能涉及不完整、不一致或包含错误的原始数据。由于质量决策仅基于质量数据，因此进行预处理以准备进一步处理的输入信息至关重要。

### 为什么结合模型是一个答案

显然，某一种预测技术无法在所有情况下都有效。每种方法都有其特定的使用场景，并且可以根据许多因素（如历史数据可用的时期、需要观察的时间段、预算规模、期望的准确度水平）和所需的输出进行应用。因此，我们面临一个问题：使用哪种方法/哪些方法才能获得所需的结果？由于不同的方法有其独特的优缺点，我们决定结合多种方法使其协同工作。这样，我们可以建立一个能够提供可靠预测的时间序列模型，以确保数据可靠性并节省时间/成本。这就是我们的方法。

### 建模过程；让我们深入了解细节

需求数据依赖于多种因素，这些因素可能影响预测结果，例如价格和商品类型、地理位置、国家经济、制造技术等。为了让我们的时间序列模型为客户提供高精度预测，我们使用了[插值](https://ece.uwaterloo.ca/~dwharder/NumericalAnalysis/05Interpolation/)方法来填补缺失值，以确保输入数据的可靠性。

在进行 Python 2.7 的时间序列分析时，我们分析了从2010年到2015年的过去数据，以精确计算需求并预测其未来行为。

![Fig. 1.png](../Images/86badad37232a5c8711be816bb1564bd.png)

*图1：2010-2015年时间范围内的需求数据*

起初，可能会觉得没有固定的需求值，因为方差上下波动，使得预测几乎不可能。但这里有一种方法可以帮助解决这个问题。

我们使用了分解方法来分别提取趋势（系列在一段时间内的增加或减少）、季节性（系列在每周、每月等期间内发生的波动）和残差（超出预期数据范围的数据点）。利用这三部分，我们建立了加法模型：

![add model.png](../Images/d8ddfef548870c9874d06e48bf409dce.png)

其中 yt 是数据，Tt 是趋势-周期成分，St 是季节成分，Rt 是残差成分，所有成分都在时间周期 t 上定义。

描述序列的各种成分的一个重要的第一步是平滑，尽管它实际上并未提供现成的模型。最初，我们估计了趋势（行为）成分。移动平均法、指数平滑法、Chow 自适应控制法、Winter 的线性和季节指数平滑方法并未提供我们预期的趋势估计精度。使用[霍德里克-普雷斯科特滤波器](https://cran.r-project.org/web/packages/mFilter/mFilter.pdf)技术获得了最可靠的结果。

![图 2.png](../Images/6f79492c6e66bb6df38997bfccb249f9.png)

*图 2\. 估计的趋势*

然后，我们从可用数据中定义了季节性。这个成分可能会随时间变化，因此我们应用了一个强大的时间序列分解工具——[Loess 方法](https://www.otexts.org/fpp/6/5)。[这种](https://www.otexts.org/fpp/6/5)方法可以处理任何类型的季节性，变化率可以由用户控制。

![图 3.png](../Images/eefcf56cefa0b1d4fb572f5c49d8f160.png)

![图 4.png](../Images/27e4843cceabd21b1cd4b09856a4c4d9.png)

*图 3\. 多季节性*

我们获得了一个具有较高和较低方差的多季节成分，导致了较大的波动。

在应用[弹性网回归](http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.ElasticNet.html)和[傅里叶变换](http://www.le.ac.uk/users/dsgp1/COURSES/LEIMETZ/FOURIER.pdf)后，我们基于获得的结果构建了趋势预测。趋势的近似可以从以下公式中找到，

![Equation 2](../Images/e30b3af647ca14f237c8b792b2f81dea.png)

其中 Pn(t) 是一个多项式，Ak 是一组索引，包括前 k 个幅度最大的索引。

然后，我们使用离散傅里叶变换（DFT）计算了傅里叶系数。

![图 4](../Images/086695b214ec1256df3fc9e7530c74a4.png)

*图 4\. Python 中 DFT 代码示例*

模型中使用的外部回归因子的傅里叶项效果如下图所示。

![图 5](../Images/bcd8ece08daf2471c898b20faa7f1634.png)

*图 5\. 傅里叶项的可视化效果*

我们使用加法模型构建了趋势预测。

![图 6](../Images/87d3d4c8cbc944be9ded0491037ac1c5.png)

*图 6\. 趋势预测*

当模型中去除趋势和季节性成分后，我们可以从剩余部分获得残差（观察值与基于其他观察的预测值之间的差异），以验证和拟合我们的数学模型。

![图 7](../Images/6417102941576a34f4eb53cbdaea22b8.png)

*图 7\. 获得的残差*

你可能会注意到存在一些负值，显示在那段时间内发生了一些异常情况。我们旨在找出导致这种行为的情况，因此我们提出了一个主意，将异常值与一个简单的日历进行编译，并发现这些负值与拉马丹、开斋节等公共假期紧密相关。在收集并总结所有数据后，我们应用了基于之前数据点的机器学习方法作为输入特征，并使用了时间序列预测的机器学习策略。

在进行了一些与机器学习模型的训练后，我们建立了一个残差预测模型，如下所示。

![图 8](../Images/cf4526aa370979c19e6bf0a1f6362325.png)

*图 8\. 残差预测*

结果，我们得到了一个最终的预测模型，将某一特定城市的平均绝对百分比误差（MAPE）降低到6%，而全国范围内的误差为10%。

![图 9](../Images/9c4e934d50df51c7838165b2a9f11b5c.png)

*图 9\. 原始尺度下的预测*

### 预测速度提高了24倍？是的，这是可能的。

在构建我们的模型时，我们不仅尝试使用现有信息，还发现可能影响结果的因素。这种方法帮助我们开发了一个比现有模型更快生成更准确预测结果的模型。例如，为了训练开发出的模型预测300个不同城市的数据，我们需要大约15分钟，而其他方法则需要约6小时。

另外，实际需求与预测需求之间的偏差仅为6%，这使得解决供应与需求之间的不匹配成为可能。现在，客户可以更快、更容易地规划产能，降低未来的风险并优化库存。

### 接下来是什么？

好吧，结果相当有前景。而且，我们还有很长的路要走以进一步改进这个模型，使其能够提供准确的长期预测。目前，长期预测的误差程度仍然相当高。这听起来像是一个挑战？敬请关注！一些新的实验即将到来！

**简历: [Taras Firman](https://www.facebook.com/profile.php?id=100009049483326)** 是ELEKS的数据科学家，专注于统计分析、优化、预测和其他重要任务。作为数学家，Taras在攻读研究生课程的同时发展自己的专业技能，并教授运筹学和数据分析。此外，他从不遗漏任何有趣的数据科学或机器学习新闻，且因为有很多想法，他也决定写博客。当他完成数学和数据科学工作时，Taras还对足球和音乐充满热情。

**相关内容：**

+   [从时间序列数据中提取更好见解的循环图](/2016/03/better-insights-time-series-cycle-plots.html)

+   [周期性大数据流中的简单异常检测方法](/2016/08/anomaly-detection-periodic-big-data-streams.html)

+   [伟大的算法教程汇总](/2016/09/great-algorithm-tutorial-roundup.html)

### 更多相关内容

+   [使用BQML进行多变量时间序列预测](https://www.kdnuggets.com/2023/07/multivariate-timeseries-prediction-bqml.html)

+   [创建时间序列比率分析仪表盘](https://www.kdnuggets.com/2023/06/wolfer-create-time-series-ratio-analysis-dashboard.html)

+   [简化的Pandas DataFrames合并方法](https://www.kdnuggets.com/2022/09/combining-pandas-dataframes-made-simple.html)

+   [将数据管理与数据讲述相结合以创造价值](https://www.kdnuggets.com/combining-data-management-and-data-storytelling-to-generate-value)

+   [在Python中加载数据的5种不同方法](https://www.kdnuggets.com/2020/08/5-different-ways-load-data-python.html)

+   [NLP中不同词嵌入技术的终极指南](https://www.kdnuggets.com/2021/11/guide-word-embedding-techniques-nlp.html)
