# 使用 Python 掌握数据准备的 7 个步骤 — 2019 版

> 原文：[https://www.kdnuggets.com/2019/06/7-steps-mastering-data-preparation-python.html](https://www.kdnuggets.com/2019/06/7-steps-mastering-data-preparation-python.html)

[评论](#comments)

有兴趣掌握使用 Python 进行数据准备吗？

数据准备、清理、预处理、净化、处理。无论你选择哪个术语，它们都指的是机器学习、数据挖掘和数据科学社区中一组大致相关的建模前数据活动。

* * *

## 我们的前 3 名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速开启网络安全职业生涯

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的IT工作

* * *

维基百科定义[数据清洗](https://en.wikipedia.org/wiki/Data_cleansing)为：

> ...是从记录集、表格或数据库中检测和修正（或删除）损坏或不准确记录的过程，并且涉及识别数据中不完整、不正确、不准确或无关的部分，然后替换、修改或删除这些脏数据或粗糙数据。数据清洗可以通过数据处理工具交互式地进行，也可以通过脚本批处理完成。

[数据处理](https://en.wikipedia.org/wiki/Data_wrangling)，根据维基百科的定义：

> ...手动将数据从一种“原始”形式转换或映射到另一种格式，以便通过半自动化工具更方便地使用数据。这可能包括进一步的数据处理、数据可视化、数据汇总、训练统计模型以及其他许多潜在用途。数据处理作为一个过程通常遵循一系列通用步骤，首先从数据源中以原始形式提取数据，然后使用算法（例如排序）或将数据解析为预定义的数据结构进行“处理”，最后将生成的内容存入数据存储以供存储和未来使用。

![图示](../Images/2ebc5d14359a29620a0fe3466edd6938.png)

数据准备在[知识发现过程](http://www2.cs.uregina.ca/~dbd/cs831/notes/kdd/1_kdd.html)（左）和[CRISP-DM模型](https://en.wikipedia.org/wiki/Cross_Industry_Standard_Process_for_Data_Mining)（右）中。

我会认为在“将数据从一种‘原始’形式映射到另一种...”的背景下，它是“识别数据中不完整、不正确、不准确或无关的部分，然后替换、修改或删除脏数据或粗糙数据”，以及“训练统计模型”，我喜欢将数据准备看作是涵盖的，或者“从数据来源到但不包括模型构建的所有内容。”这就是我们将继续使用的模糊却奇妙准确的定义。

本文将[更新2017年的版本](/2017/06/7-steps-mastering-data-preparation-python.html)，以刷新一些内容。我尝试选择一两个高质量的教程，并在适当时附上视频，以作为每一步特定课程的良好代表。

请记住，本文涵盖了一组特定的数据准备技术，而在特定情况下，根据需求可能会使用其他或完全不同的技术。你会发现这里的建议既是正统的，又是一般性的。

拿点零食坐下来，我们将学习如何使用Python掌握数据准备。

### 第一步：为准备工作做准备

首先，让我们强调一下其他人已经告诉你的：可以认为这个数据准备阶段不是机器学习任务之前的预备步骤，而实际上是典型机器学习任务中一个组成部分（甚至是大多数部分）。不过，出于我们的目的，我们将数据准备与建模分开作为一个独立的过程。

由于Python是我们将要沉浸的生态系统，以下资源是确保适当熟悉的良好起点。

+   **[10分钟掌握Pandas](https://pandas.pydata.org/pandas-docs/stable/getting_started/10min.html)**

+   **[Matplotlib初学者指南](https://matplotlib.org/users/beginner.html)**

+   **[官方seaborn教程](https://seaborn.pydata.org/tutorial.html)**

数据准备可以在CRISP-DM模型中看到（尽管可以合理地认为“数据理解”也符合我们的定义）。我们还可以将我们的数据准备与KDD过程的框架等同——具体是前三个主要步骤——即**选择**、**预处理**和**转换**。我们可以将这些步骤分解得更细致，但从宏观层面来看，KDD过程中的这些步骤涵盖了数据整理的内容。

尽管读者应该可以在很少额外资源的情况下跟随本指南，但对于那些对Pandas（可能是Python生态系统中最重要的数据准备库）有更全面了解兴趣的人，可以在以下内容中找到有用的信息：

+   **[Pandas数据结构简介](http://www.gregreda.com/2013/10/26/intro-to-pandas-data-structures/)**，作者：Greg Reda

+   **[现代Pandas（分7部分）](http://tomaugspurger.github.io/modern-1-intro.html)**，作者：Tom Augspurger

最后，在继续之前，阅读 **[数据准备技巧、窍门和工具：与内部人士的访谈](/2016/10/data-preparation-tips-tricks-tools.html)**，了解来自三位内部人士——Sebastian Raschka、Clare Bernard 和 Joe Boutros——对数据准备过程的反馈。

### 步骤 2：探索性数据分析

[探索性数据分析](https://en.wikipedia.org/wiki/Exploratory_data_analysis)（EDA）是任何更大数据分析、数据科学或机器学习项目的一个重要方面。在处理数据之前理解数据不仅仅是个不错的主意，如果你计划实现有意义的结果，它是一个优先事项。 [Andrew Andrade](https://datascienceguide.github.io/exploratory-data-analysis) 简洁地描述了 EDA。

> EDA 的目的是利用汇总统计和可视化来更好地理解数据，并找出数据的趋势、质量的线索，以及制定我们的分析假设和假设。

基本要点是，在有效选择预测算法或规划数据准备的其余步骤之前，我们需要了解数据的组成。将数据集投入最热门的算法并寄希望于最好的结果不是一种策略。

为了获得一些直观的认识，可以观看来自弗吉尼亚大学的 Patrick Meyer 教授的视频，该视频提供了 EDA 的概述。

然后阅读 Andrade 关于 **[探索性数据分析](https://datascienceguide.github.io/exploratory-data-analysis)** 的文章，该文章提供了有关如何进行 EDA 的额外细节以及其实际好处。

对于基于 Python 的 EDA 方法教程，请查看 Vigneshwer Dhinakaran 撰写的文章 **[探索性数据分析（EDA）和使用 Python 进行数据可视化](https://kite.com/blog/python/data-analysis-visualization-python)**，这实际上在我看来超越了传统的 EDA，并将介绍本文后面涵盖的一些附加概念。

一个显著缩短你需要编写的 EDA 代码的库是 **[Pandas Profiling](https://github.com/pandas-profiling/pandas-profiling)**，它从 Pandas DataFrames 创建 HTML 报告。

> 从 pandas `DataFrame` 生成概况报告。pandas 的 `df.describe()` 函数非常好，但对于严肃的探索性数据分析来说有点基础。`pandas_profiling` 通过 `df.profile_report()` 扩展了 pandas DataFrame，用于快速数据分析。

你可以在 Jupyter notebooks 中使用一行代码交互式地运行 Pandas Profiling：

`df.profile_report()`

阅读项目的 GitHub Readme 以获取更多信息，并亲自尝试一下。

### 步骤 3：缺失值

处理缺失数据的方法有很多，没有一种方法是普遍适用的。有些人会说“绝不要使用包含空值的实例。”其他人则会争辩“绝不要使用属性的均值来替代缺失值。”相反，你可能会听到更复杂的方法被完全支持，比如“只有首先将数据集聚类到已知类别数，然后使用簇内回归来计算缺失值才是有效的。”

别听这些话。“从不”和“仅仅”以及其他僵化的主张在数据处理的微妙世界中毫无价值；不同类型的数据和处理过程建议采用不同的最佳实践来处理缺失值。然而，由于这种类型的知识既基于经验也基于领域，我们将重点关注可以采用的基本策略。

处理缺失值的一些常用方法包括：

+   删除具有缺失值的实例

+   删除具有缺失值的属性

+   对所有缺失值填补属性的 { 均值 | 中位数 | 众数 }

+   通过线性回归填补属性缺失值

也可以采用组合策略：删除任何缺失值超过 2 个的实例，并对剩余的实例使用均值属性值填补。显然，所采用的建模方法会影响你的决定——例如，决策树不适合缺失值。此外，你可以技术上考虑任何你能想到的统计方法来确定数据集中缺失值，但列出的这些方法已经过实践验证且被广泛使用。

由于我们关注的是 Python 生态系统，你可以从 Pandas 用户指南中阅读更多关于**[处理缺失数据](http://pandas.pydata.org/pandas-docs/stable/missing_data.html)**的内容，并参考**[Pandas `DataFrame` 对象的 `fillna()` 函数](https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.fillna.html)**的 API 文档。

在 Pandas DataFrame 中填补缺失值有很多方法。以下是一些基本示例：

你还可以观看这个关于使用 Pandas 处理缺失值的视频。

### 步骤 4：异常值

这不是一个关于在建模时处理数据中异常值的策略教程；在某些情况下，将异常值纳入建模是合适的，而在其他情况下则不适合（无论任何人怎么告诉你）。这取决于具体情况，没有人能对你的情况是否属于A列或B列做出全面的断言。

异常值可能是由于数据收集不良造成的，也可能是真正的、异常的数据。这是两种不同的情况，必须采取不同的方法，因此没有“放之四海而皆准”的建议，类似于处理缺失值的情况。从上述 Analysis Factor 文章中获得的一个特别有见地的点如下：

> 一种选择是尝试变换。平方根和对数变换都可以收敛高数字。如果异常值是因变量，这可以使假设更有效；如果异常值是自变量，这可以减少单个点的影响。

阅读这个讨论，**[异常值：删除还是不删除](http://www.theanalysisfactor.com/outliers-to-drop-or-not-to-drop/)**，以及在 Stack Exchange 上的讨论 **[从数据中去除异常值可以吗？](https://stats.stackexchange.com/questions/200534/is-it-ok-to-remove-outliers-from-data/200923)**，以获得更多关于这个问题的见解。

你可以查看 **[使用 Python 的标准差去除异常值](https://www.kdnuggets.com/2017/02/removing-outliers-standard-deviation-python.html)** 作为使用 Python 去除异常值的简单示例。然后阅读这篇 Stack Overflow 讨论，**[使用百分位数在 Pandas DataFrame 中去除异常值](https://stackoverflow.com/questions/35827863/remove-outliers-in-pandas-dataframe-using-percentiles)**。

最终，是否去除异常值的决策将依赖于任务，理由和决策将比技术方法更为重要。

### 第 5 步：不平衡数据

那么，如果你原本健壮的数据集由两个类别组成：一个包含 95% 的实例，另一个仅包含 5% 呢？或者更糟的是，99.8% 对 0.2%？

![识别和处理不平衡数据很重要](../Images/c9cbb484ef13d59bff657b921d1b6624.png)

如果是这样，你的数据集是不平衡的，至少在类别方面是这样。这可能会造成问题，虽然这些问题我相信无需多言。但还不需要将数据抛到一边；当然有应对这些问题的策略。

关于为什么我们会遇到不平衡数据，以及为什么在某些领域会比其他领域更频繁地出现不平衡数据的一个很好的解释（见下文的 7 种处理不平衡数据的技术）：

> 在这些领域中使用的数据通常包含少于 1% 的稀有但“有趣”的事件（例如，使用信用卡的欺诈者、用户点击广告或被破坏的服务器扫描其网络）。然而，大多数机器学习算法在处理不平衡数据集时表现不佳。以下七种技术可以帮助你训练分类器来检测异常类别。

请注意，尽管这可能不是真正的数据准备任务，但这样的数据集特征将在数据准备阶段早期显现（EDA 的重要性），并且这样的数据的有效性在这个准备阶段可以进行初步评估。

Tom Fawcett 在他的文章 **[学习如何处理不平衡类别](/2016/08/learning-from-imbalanced-classes.html)** 中讨论了这个问题。阅读它可以更好地了解这个问题。

然后阅读这篇文章，**[处理不平衡数据的 7 种技术](/2017/06/7-techniques-handle-imbalanced-data.html)**，作者是 Ye Wu 和 Rick Radewagen，涵盖了处理类别不平衡的技术。

### 步骤 6：数据转换

维基百科将 [数据转换](https://en.wikipedia.org/wiki/Data_transformation_(statistics)) 定义为：

> 在统计学中，数据转换是对数据集中每个点应用确定性数学函数的过程——即，每个数据点 zi 被替换为转换后的值 *y[i]* = *f(z[i])*，其中 *f* 是一个函数。转换通常应用于使数据更符合将要应用的统计推断程序的假设，或提高图表的可解释性或外观。

数据转换是数据准备中最重要的方面之一，比其他一些方面需要更多的技巧。当数据中出现缺失值时，它们通常很容易被发现，可以通过上述常见方法之一或通过在特定领域内逐渐获得的复杂措施来处理。然而，何时需要数据转换往往不容易识别，更不用说所需的转换类型了。

让我们看几个具体的转换，以更好地理解它们。

首先，**[Scikit-learn 数据预处理](http://scikit-learn.org/stable/modules/preprocessing.html)** 的概述提供了一些重要预处理转换的理由，即标准化、归一化、二值化以及其他几个方法。

标准化和归一化是在机器学习项目中常用的数据转换方法。两者都是数据缩放方法：标准化指将数据缩放至均值为 0 和标准差为 1；归一化指将数据值缩放至预定范围内，通常在 0 到 1 之间。阅读 Shay Geller 的这篇文章，**[归一化 vs 标准化——定量分析](https://towardsdatascience.com/normalization-vs-standardization-quantitative-analysis-a91e8a79cebf)**，了解这些转换如何工作，如何在 Python 生态系统中执行它们，并从作者那里获得一些最佳实践的见解。

One-hot 编码是一种将分类特征转换为更适合分类和回归格式的方法。观看这个关于 one-hot 编码的视频，以更好地理解其如何实现，以及如何使用 Python 工具完成它。

对数分布变换对将非线性模型转化为线性模型以及处理偏斜数据非常有用。阅读这个 Stack Exchange 讨论，**[何时（以及为什么）应该对分布（或数字）取对数？](https://stats.stackexchange.com/questions/18844/when-and-why-should-you-take-the-log-of-a-distribution-of-numbers)**，可以获得直观的理解。你还可以查看这个来自 Data Science Made Simple 的简短教程，**[在 pandas python 中对列进行对数和自然对数变换](http://www.datasciencemadesimple.com/log-natural-logarithmic-value-column-pandas-python-2/)**，快速了解如何使用 Numpy 在 Python 中完成这种变换。

这个来自安大略理工大学的简短教程，**[指数函数和对数函数简介](https://nool.uoit.ca/mathematics/exponential-logarithmic-functions/basics/index.php)**，从数学角度解释了对数和指数变换及其可视化，可以增强你对这些变换在底层数据分布上所产生影响的直观理解。教程共有 3 页，第三页有 2 个视频，有助于更好地理解要点。

根据数据和你的需求，还有许多其他标准的数据变换常被使用。对数据预处理和准备的经验应能帮助你了解在不同情况下需要什么类型的变换。

### 第 7 步：最后的润色与前进

好了，你的数据已经“干净”了。那么你接下来要怎么做？

如果你想直接将数据输入机器学习算法以尝试建立模型，你可能需要以更合适的方式表示数据。在 Python 生态系统中，这通常是一个 Numpy ndarray（或矩阵）。这个 Stack Overflow 讨论，**[将 Pandas Dataframe 转换为数组并评估多元线性回归模型](https://stackoverflow.com/questions/28334091/turning-a-pandas-dataframe-to-an-array-and-evaluate-multiple-linear-regression-m)**，可以提供一些初步的思路。

![非常简单的数据准备过程](../Images/2b1892e803954b3888cf48f32e0c71b7.png)

*请注意，我们在前文中大部分数据准备工作是结合 Pandas 和 Numpy 进行的；然而，Pandas 基于 Numpy，因此直接操作底层 Numpy 矩阵是一个有用的技能。 [在这里了解更多](https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html)。*

如果你还没有准备好建模数据，而是想保存你的干净 Pandas DataFrame 以便后用，**[快速 HDF5 与 Pandas](https://dzone.com/articles/quick-hdf5-pandas)** 作者 Giuseppe Vettigli 将展示一种方法。

一旦你在Python中获得了干净且适合机器学习的数据，为什么不直接开始机器学习呢？首先，你需要阅读**[掌握基础机器学习的7个步骤——2019版](/2019/01/7-steps-mastering-basic-machine-learning-python.html)**，以获得对Python生态系统中机器学习的初步理解。接着阅读**[掌握中级机器学习的7个步骤——2019版](/2019/06/7-steps-mastering-intermediate-machine-learning-python.html)**来提升你的知识水平（同时也留意即将发布的“高级”版本）。

对于数据准备的一些不同观点，请查看这些内容：

+   **[在Python中整理数据](/2017/01/tidying-data-python.html)**，作者：让-尼古拉斯·霍尔德

+   **[数据科学实战：Kaggle教程第三部分——数据清理](/2016/06/doing-data-science-kaggle-walkthrough-data-cleaning.html)**，作者：布雷特·罗梅罗

+   **[从零开始的Python机器学习工作流第一部分：数据准备](/2017/05/machine-learning-workflows-python-scratch-part-1.html)**

请注意，本讨论故意跳过了特征选择的内容，原因是：特征选择的内容远不止几句简单的讨论，它值得在这更广泛的讨论中有更多的关注。请留意类似的特征选择指南。

**相关内容**：

+   [掌握基础机器学习的7个步骤——2019版](/2019/01/7-steps-mastering-basic-machine-learning-python.html)

+   [掌握中级机器学习的7个步骤——2019版](/2019/06/7-steps-mastering-intermediate-machine-learning-python.html)

+   [掌握SQL以进行数据科学的7个步骤——2019版](/2019/05/7-steps-mastering-sql-data-science-2019-edition.html)

### 更多相关内容

+   [成为优秀数据科学家所需的5项关键技能](https://www.kdnuggets.com/2021/12/5-key-skills-needed-become-great-data-scientist.html)

+   [每位初学者数据科学家应掌握的6种预测模型](https://www.kdnuggets.com/2021/12/6-predictive-models-every-beginner-data-scientist-master.html)

+   [2021年最佳ETL工具](https://www.kdnuggets.com/2021/12/mozart-best-etl-tools-2021.html)

+   [每位数据科学家都应了解的三种R语言库（即使你使用Python）](https://www.kdnuggets.com/2021/12/three-r-libraries-every-data-scientist-know-even-python.html)

+   [使用管道编写干净的Python代码](https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html)

+   [是什么让Python成为创业公司的理想编程语言](https://www.kdnuggets.com/2021/12/makes-python-ideal-programming-language-startups.html)
