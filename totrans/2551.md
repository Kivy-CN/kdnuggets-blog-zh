# 什么时候重新训练机器学习模型？进行这5个检查来决定计划

> 原文：[https://www.kdnuggets.com/2021/07/retrain-machine-learning-model-5-checks-decide-schedule.html](https://www.kdnuggets.com/2021/07/retrain-machine-learning-model-5-checks-decide-schedule.html)

[评论](#comments)

**由** [**Emeli Dral**](https://twitter.com/EmeliDral)**，Evidently AI 的首席技术官和联合创始人 &** [**Elena Samuylova**](https://twitter.com/elenasamuylova/)**，Evidently AI 的首席执行官和联合创始人**

世界和数据是不断变化的。但大多数机器学习模型是静态的。一旦投入生产，它们会随着时间的推移变得不那么相关。[数据分布会变化，行为模式也会改变](https://evidentlyai.com/blog/machine-learning-monitoring-data-and-concept-drift)，模型需要更新以跟上新的现实。

* * *

## 我们的前三课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织 IT

* * *

通常的过程是在定义的时间间隔内重新训练模型。这看起来相当简单：获取新数据、旧的训练管道，并再次拟合模型。

但我们应该多久进行一次？是每天、每周还是每月？或者每次获得一批新数据时？

![图片](../Images/6633c2014ec57d3088ba2179d982447e.png)

过于频繁地，答案是基于直觉或方便性。有人选择一个合理的时间间隔并安排定期再训练任务。

相反，我们可以以更具数据驱动的方式进行。为了更准确地规划模型维护，我们可以提前进行一些检查。

根据模型的重要性，你可能会通过所有检查或仅部分检查。

### 检查 #1\. 模型是否已经足够好？

在制定再训练计划之前，检查我们是否完成了训练是有帮助的！也许，模型还没有达到最佳性能？

简单的方法是查看老旧的学习曲线。

![图片](../Images/f0988021c2e694e56e03bef78e14da42.png)

如何继续？我们可以固定测试集来评估模型性能。然后，通过在不同部分的训练数据上训练模型，进行一系列实验。

我们可以使用随机拆分方法，并通过改变训练规模进行迭代。这样，我们可以专注于数据量如何影响性能。

![图片](../Images/1353e1f20c4313d1a9f55092a6d2800a.png)

结果我们可以学到两件事：1）我们需要多少数据才能达到峰值性能 2）模型是否在可用的训练数据下达到了这个平台。

**有时我们会发现模型不需要我们所有的数据。** 例如，我们有多年的销售数据，但使用仅一年的训练数据可以获得相同的质量。

我们可能会去掉多余的数据，使模型更轻量化。

**在其他情况下，我们可能会看到模型质量不断提高**。模型渴望更多数据！还有更多步骤需要完成，以将模型调整到最佳状态。

![Image](../Images/7d75b4bc993a559419e6f57d29fb3c70.png)

与其考虑重新训练模型以维持其质量，我们应该计划持续改进。一旦我们获得足够的新数据，就可以利用它达到更好的性能。

这个初步测试还提供了数据中信号的规模和“密度”的感觉。我们需要10个、100个还是1000个观察来观察模型性能的有意义影响？收集这么多新数据需要一天还是一个月？

这是一件有用的事情！

### 检查 #2\. 事情变化的速度有多快？

当我们创建机器学习模型时，我们假设现实世界过程有一定的稳定性。否则，从过去中学习就毫无意义了！

我们也知道事情会变化。在处理动态过程时，我们还可以假设这些新模式的积累有一定的速度。

然后我们可以尝试计算这个！

让我们拿出我们的模型，看看如果我们模拟它在过去的应用，它能“持续”多久。

![Image](../Images/f57dc5e2baea3ed6c05cdd2eefc14927.png)

我们可以使用数据中的一些较早部分来训练模型，然后将其“应用”到后来的时期。就像我们用保留集一样，只不过这里我们只是取几个连续的部分。

我们可以从一个单点估计开始，看看性能下降的速度有多快。

![Image](../Images/886251abc0b3af2682dc5aedba2e68cd.png)

如果我们有足够的历史数据，我们可以多次重复这个检查，然后取平均值。只需注意潜在的异常值和稀有事件！

![Image](../Images/4187c122c80bd37ca886503946959293.png)

**有时我们会发现“旧”模型的表现和新模型一样好。** 一些人喜欢经常重新训练模型以保持其“新鲜”，但这并不总是有必要的。

不要修复未损坏的东西！

如果不需要频繁重新训练，你可能会选择一个更轻量的服务架构。你还可以降低由于任何更改带来的技术错误风险。组织开销也是如此，特别是当新模型需要审批流程时。

![Image](../Images/7cf2c1d846f0a3770216da28a8ebe87a.png)

**在其他情况下，你会发现模型衰老得非常快！** 提前了解这一点有助于设置适当的监控和准备基础设施。

你可能决定重新考虑你的训练方法，以使模型更稳定。例如，改变特征工程或模型架构，使其在测试集上的表现稍微逊色，但在长期内更稳定。在其他情况下，你可能会使用较短的训练期来训练模型，但进行频繁的校准或考虑主动学习。

我们可能还会面临重新训练模型能力的限制。

这将引出下一个检查。

### 检查 #3。我们什么时候获得新数据？

![Image](../Images/ad4cb68a76433b6c053208581142e7d7.png)

在这里，我们关注的是业务流程而不是数据。

有时，我们几乎立即获得现实世界的反馈。例如，你推荐了一篇文章，且你很快知道用户是否点击了链接。

在其他情况下，你可以用来重新训练模型的新数据会有延迟到达。

如果你有一个较长的预测期，你必须等待才能知道你的预测是否正确。对于其他任务，你需要一个单独的标注过程。有时，限制来自于数据的移动或生成方式。例如，手动数据录入每月进行一次。

![Image](../Images/4d963f1ef664d1112a0b9573247d2a02.png)

我们可能会面临这两种情况之一。

**在某些情况下，模型在新数据到达之前就已经衰退。** 这就成了一个限制。

如果我们没有及时获得数据来重新训练模型，我们可能需要重新考虑方法。例如，创建具有不同重新训练周期的模型集成，或将机器学习与规则或人工干预结合起来。作为最后的手段，我们还可以调整我们的性能期望，并准备应对降低的模型质量。

**在其他情况下，新数据开始积累之前，模型已经开始衰退。** 在这种情况下，我们有选择的余地。

我们当然可以在数据到来后的任何时候启动重新训练。如果我们想更精确一些，有一种方法可以做到这一点。

继续阅读！

### 检查 #4。我们需要多少数据才能看到改进？

假设新数据每天到达，但模型只有在30天后才衰退。最优的行动是什么？我们应该每天、每周还是每月重新训练？

![Image](../Images/93da0c9a4e5c92b0642fc2c37d89f2a3.png)

我们可以通过检查新数据桶是否带来了我们想要的改进来做出更精确的判断。

问题是，有时添加一小部分新数据点不会改变任何东西。有一个最小的数据量对性能有明显的影响。

我们可以对此进行评估。

为此，我们从已知衰退的期间中选择一个测试集。我们知道何时性能下降：然后我们可以检查是否在新数据上重新训练能够改进性能。

![Image](../Images/36e21e33e0b86cf04f120b86ea13917b.png)

我们可以在数据到来时逐渐添加数据。然后，观察其对测试性能的影响。

常见的情况是我们需要等待一段时间以收集“有用”的数据——例如，至少一周的数据来捕捉相关的季节性模式。

结果是，我们实际选择的再训练窗口可能比预想的要窄！一方面，它受到数据提供速度的限制。另一方面，则受到收集足够数据以产生效果的需求限制。

![Image](../Images/0c8d71d262bc407a56865915a599e208.png)

在这个时间框架内，你可以根据实际情况和用例的合理性选择时间段。

### 检查 #5。我们应该保留旧数据吗？

还有一个常见问题。我们应该如何再训练模型？我们应该添加一些新数据并丢弃一些旧数据吗？我们是否应该持续增加训练集？

这是一个额外的检查项。

我们可以在选定的间隔进行模型再训练，然后检查如果我们开始丢弃旧数据，情况会如何变化。

![Image](../Images/2433693530f83ace89e16563af95b574.png)

我们通常会发现，排除旧数据没有任何区别。那么，保留训练数据以保持训练更轻量可能是明智的做法。

更重要的是，有时这会让模型变得更好！如果你有一个动态的用例，保留旧的无关数据可能会导致性能下降。这一点提前了解是很有帮助的。

当然，我们也可能会看到，暂时保留所有数据是有意义的。你可以稍后再重复检查。

### 接下来是什么？

通过这些检查，你可以为模型维护做好准备。你可以设置再训练管道以便在选定的间隔进行更新。

尽管如此，我们不能仅仅依赖我们的计划。我们还需要现实检查。这意味着，模型上线后要进行监控。

为了获得可视性，我们可以构建一个[监控仪表板](https://github.com/evidentlyai/evidently)，或者安排定期检查以计算实际模型性能（如果我们有真实数据），或者监控输入数据的统计分布漂移和异常值。

![Image](../Images/19db7390f4ca668c6a5a3a66023ce064.png)

即使是稳定的模型也可能面临[数据和概念漂移](https://evidentlyai.com/blog/machine-learning-monitoring-data-and-concept-drift)或某些稀有事件。在这种情况下，我们可能需要比计划更早进行干预。

另一方面，如果情况稳定，我们可以跳过比计划更长时间的更新。

规划定期再训练并结合持续监控通常是让模型达到其承诺性能的**最佳**策略！

**链接**

你可以在[这里](https://evidentlyai.com/blog/retrain-or-not-retrain)找到这篇文章的扩展版本。

[机器学习监控清单](/2021/03/machine-learning-model-monitoring-checklist.html)

**Emeli Dral** 是 Evidently AI 的联合创始人兼首席技术官，她在这里创建了分析和监控机器学习模型的工具。她曾共同创立了一家工业 AI 初创公司，并在 Yandex Data Factory 担任首席数据科学家。她还是 Coursera 上机器学习和数据分析课程的共同作者，该课程有超过100,000名学生。

[https://twitter.com/EmeliDral](https://twitter.com/EmeliDral)

**Elena Samuylova** 是 Evidently AI 的联合创始人兼首席执行官。她曾共同创立了一家工业 AI 初创公司，并在 Yandex Data Factory 负责业务发展。自2014年以来，她一直与从制造业到零售业的公司合作，提供基于机器学习的解决方案。2018年，Elena 被 Product Management Festival 评选为欧洲50位杰出产品女性之一。

[https://twitter.com/elenasamuylova/](https://twitter.com/elenasamuylova/)

**相关：**

+   [从机器学习错误中学习](/2021/03/learning-from-machine-learning-mistakes.html)

+   [机器学习模型监控检查清单：7 个需要跟踪的事项](/2021/03/machine-learning-model-monitoring-checklist.html)

+   [MLOps：模型监控 101](/2021/01/mlops-model-monitoring-101.html)

### 更多相关主题

+   [使用 Jupysql 和 GitHub Actions 计划和运行 ETL](https://www.kdnuggets.com/2023/05/schedule-run-etls-jupysql-github-actions.html)

+   [合规检查中的深度学习：有什么新变化？](https://www.kdnuggets.com/2022/05/deep-learning-compliance-checks-new.html)

+   [使用 Pandas 进行 7 项数据质量检查](https://www.kdnuggets.com/7-essential-data-quality-checks-with-pandas)

+   [通过这些 GitHub 仓库学习机器学习](https://www.kdnuggets.com/2023/01/learn-machine-learning-github-repositories.html)

+   [了解如何在您的设备上仅需几个步骤运行 Alpaca-LoRA](https://www.kdnuggets.com/2023/05/learn-run-alpacalora-device-steps.html)

+   [在本地使用 LM Studio 运行 LLM](https://www.kdnuggets.com/run-an-llm-locally-with-lm-studio)
