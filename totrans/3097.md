# 如何在 SQL Server 中使用机器学习服务执行 R 和 Python

> 原文：[https://www.kdnuggets.com/2018/06/microsoft-azure-machine-learning-r-python-sql-server.html](https://www.kdnuggets.com/2018/06/microsoft-azure-machine-learning-r-python-sql-server.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](#comments)

**作者 [Kyle Weller](https://www.linkedin.com/in/ai-is-the-future/)，Microsoft Azure 机器学习**

你知道你可以在你的 T-SQL 语句中编写 R 和 Python 代码吗？ [机器学习服务](https://aka.ms/sqlmloverview) 在 SQL Server 中消除了数据移动的需要。你可以在数据库内执行你的 R/Python 代码，而无需通过网络传输大量敏感数据或使用样本 csv 文件导致的精度丧失。轻松部署你的 R/Python 代码与 SQL 存储过程，使其在 ETL 过程或任何应用程序中可访问。在数据库中训练和存储机器学习模型，将智能带到数据所在的地方。

![智能数据](../Images/6327fa3e05e1afd562d076a88a58e7dc.png)

你可以安装和运行任何最新的开源 R/Python 包，在 SQL Server 上处理大量数据以构建深度学习和人工智能应用程序。我们还提供了 Microsoft 的 [前沿](https://cloudblogs.microsoft.com/sqlserver/2016/10/11/1000000-predictions-per-second/) 高性能算法，在 [RevoScaleR](https://docs.microsoft.com/en-us/machine-learning-server/r-reference/revoscaler/revoscaler) 和 [RevoScalePy](https://docs.microsoft.com/en-us/sql/advanced-analytics/python/what-is-revoscalepy?view=sql-server-2017) APIs 中。使用这些最新的开源世界创新，你可以为你的应用程序带来无与伦比的选择、性能和规模。

如果你对尝试 SQL Server 机器学习服务感到兴奋，请查看下面的实操教程。 **如果你尚未在 SQL Server 中安装机器学习服务，你首先需要按照我在这里发布的入门教程进行操作：**

### 如何操作教程

在本教程中，我将介绍如何在 T-SQL 语句中执行 R 和 Python 的基础知识。如果你喜欢通过视频学习，我还在 YouTube 上发布了该教程：

### 基础知识

打开 SQL Server Management Studio 并连接到你的服务器。打开一个新查询并粘贴这个基本示例： (*虽然我在这些示例中使用了 Python，但你也可以使用 R 完成所有操作*)

`EXEC sp_execute_external_script @language = N'Python', @script = N'print(3+4)'`

Sp_execute_external_script 是一个特殊的系统存储过程，允许在 SQL Server 中执行 R 和 Python。存在一个“language”参数，使我们可以在 Python 和 R 之间进行选择。还有一个“script”参数，我们可以在其中粘贴 R 或 Python 代码。如果你没有看到输出打印 7，请返回并查看 [这篇文章](https://blogs.msdn.microsoft.com/mlserver/2018/05/18/getting-started-with-machine-learning-services-in-sql-server/) 中的设置步骤。

### 参数介绍

现在我们讨论了一个基本示例，开始添加更多内容：

`EXEC sp_execute_external_script @language = N'Python', @script = N' OutputDataSet = InputDataSet; ', @input_data_1 = N'SELECT 1 AS Col1';`

机器学习服务通过一个接受任何 SQL 查询的输入数据参数，提供了 SQL 与 R/Python 之间更自然的通信。输入参数名称为“input_data_1”。

在 Python 代码中，你可以看到定义了默认变量以在 Python 和 SQL 之间传递数据。默认变量名称为“OutputDataSet”和“InputDataSet”。你可以像下面的示例一样更改这些默认名称：

`EXEC sp_execute_external_script @language = N'Python', @script = N' MyOutput = MyInput; ', @input_data_1_name = N'MyInput', @input_data_1 = N'SELECT 1 AS foo', @output_data_1_name = N'MyOutput';`

当你执行这些示例时，可能会注意到它们每个都返回了一个结果，显示为“（没有列名）”？你可以通过在语句末尾添加 WITH RESULT SETS 子句来指定返回列的名称，这是一组以逗号分隔的列及其数据类型的列表。

`EXEC sp_execute_external_script @language = N'Python', @script = N' MyOutput = MyInput; ', @input_data_1_name = N'MyInput', @input_data_1 = N' SELECT 1 AS foo, 2 AS bar ', @output_data_1_name = N'MyOutput' WITH RESULT SETS ((MyColName int, MyColName2 int));`

### 输入/输出数据类型

好的，让我们进一步讨论 SQL 和 Python 之间使用的输入/输出数据类型。你的输入 SQL SELECT 语句将“Dataframe”传递给 Python，依赖于 [Python Pandas package](https://pypi.org/project/pandas/)。从 Python 回到 SQL 的输出也需要是 Pandas Dataframe 对象。如果你需要将标量值转换为 dataframe，这里有一个示例：

`EXEC sp_execute_external_script @language = N'Python', @script = N' import pandas as pd c = 1/2 d = 1*2 s = pd.Series([c,d]) df = pd.DataFrame(s) OutputDataSet = df '`

变量 c 和 d 都是标量值，你可以将它们添加到 pandas Series 中，然后转换为 pandas dataframe。这是一个稍微复杂一点的示例，详细信息和示例请查看 [python pandas package documentation](https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html)。

`EXEC sp_execute_external_script @language = N'Python', @script = N' import pandas as pd s = {"col1": [1, 2], "col2": [3, 4]} df = pd.DataFrame(s) OutputDataSet = df '`

现在你已经掌握了在 T-SQL 中执行 Python 的基础知识！

你知道你也可以在你喜欢的 IDE，如 RStudio 和 Jupyter Notebooks 中编写 R 和 Python 代码，然后远程将代码执行发送到 SQL Server 吗？查看这些文档链接以了解更多信息：[https://aka.ms/R-RemoteSQLExecution https://aka.ms/PythonRemoteSQLExecution](https://aka.ms/R-RemoteSQLExecution)

查看 [SQL Server 机器学习服务](https://aka.ms/SQLMLDocs) 文档页面，了解更多文档、示例和解决方案。还可以查看这些 E2E [GitHub 上的教程](https://aka.ms/SQLMLDocs)。

希望听到你的声音！在下面留言提问或开始讨论！

**简介：** [凯尔·韦勒](https://www.linkedin.com/in/ai-is-the-future/) 是微软 Azure 机器学习团队的项目经理。在几家初创公司担任软件开发人员后，他加入了微软，并在 Office 和 Bing 从事可扩展的数据仪表、平台和 API 解决方案的工作。他曾在 Cortana 数据与分析团队中推动测量策略、研究用户行为模式、标准化 KPI，并为产品识别增长机会。他现在在 Azure 机器学习产品上工作，专注于将智能带到数据所在的位置。这包括 SQL Server 新的机器学习服务，允许在 SQL 中执行 R + Python。

**相关：**

+   [比较机器学习服务：亚马逊、微软 Azure、谷歌云 AI](https://www.kdnuggets.com/2018/01/mlaas-amazon-microsoft-azure-google-cloud-ai.html)

+   [选择合适的指标来评估机器学习模型——第2部分](https://www.kdnuggets.com/2018/06/right-metric-evaluating-machine-learning-models-2.html)

+   [哪个数据库最适合分析师？](https://www.kdnuggets.com/2015/12/database-best-for-analyst.html)

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业的快车道。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析能力

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织 IT

* * *

### 更多主题

+   [Kubernetes 中的高可用性 SQL Server Docker 容器](https://www.kdnuggets.com/2022/04/high-availability-sql-server-docker-containers-kubernetes.html)

+   [机器学习模型可解释性如何加速 AI 采用旅程…](https://www.kdnuggets.com/2022/07/ml-model-explainability-accelerates-ai-adoption-journey-financial-services.html)

+   [25本免费书籍，掌握SQL、Python、数据科学、机器学习和自然语言处理](https://www.kdnuggets.com/25-free-books-to-master-sql-python-data-science-machine-learning-and-natural-language-processing)

+   [KDnuggets 新闻，9月21日：7个机器学习投资组合项目…](https://www.kdnuggets.com/2022/n37.html)

+   [数据分析师的SQL和Python面试问题](https://www.kdnuggets.com/2023/02/sql-python-interview-questions-data-analysts.html)

+   [掌握SQL、Python、数据清理、数据处理和探索性数据分析的指南合集](https://www.kdnuggets.com/collection-of-guides-on-mastering-sql-python-data-cleaning-data-wrangling-and-exploratory-data-analysis)
