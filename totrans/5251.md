# 客户留存分析指南

> 原文：[https://www.kdnuggets.com/2017/12/guide-customer-retention-analysis-sql.html/2](https://www.kdnuggets.com/2017/12/guide-customer-retention-analysis-sql.html/2)

### **其他客户留存技术**

当然，还有其他方法来考虑客户留存分析。特别是，我们可能需要查看如何处理回访客户：如果在 p1 中有 100 个客户，而在 p2 中有 80 个回访，那么在 p3 中我们是要保留最初的 100 个客户，还是只关注那 80 个？

在上述示例中，我只讨论了期到期的留存情况，但我也分类了那些“滞后者”或那些需要超过一个月才能回访的人。通过有针对性的营销活动，企业可能希望奖励那些保持每月访问模式的客户，或者鼓励那些少于每月一次访问的客户更频繁地回访。

因此，另一种方法是查看我们在任何给定月份的访客中有多少比例被留存，多少是回访用户，多少是新用户。在这种情况下，我们需要稍微改变一下视角，不是看下一个访问，而是看上一个访问。

```py
Time_lapse_2 AS

    SELECT cust_id,

           Visit_month,

           lag(visit_month, 1) over (partition BY cust_id ORDER BY cust_id, visit_month)

     FROM visit_log

Time_diff_calculated_2 AS

    SELECT cust_id,

           visit_month,

           lag,

           visit_month — lag AS time_diff

     FROM time_lapse_2

Custs_categorized AS

    SELECT cust_id,

           visit_month,

           CASE

                    WHEN time_diff=1 THEN ‘retained’,

                    WHEN time_diff>1 THEN ‘returning’,

                    WHEN time_diff IS NULL THEN ‘new’

           END AS cust_type

FROM time_diff_calculated_2
```

因此，简单地统计任何给定月份的每种类型客户的数量是很容易的。

```py
SELECT visit_month,

       cust_type,

       Count(cust_id)

FROM custs_categorized

GROUP BY 1,

         2
```

通过简单的导出和图表，你将得到如下所示的结果：

![](../Images/06bbf2a36485a2126a2fde49610ed717.png)

数据通过 [Statsbot](https://statsbot.co/solutions/product-analytics?utm_source=blog&utm_medium=article&utm_campaign=retention) 进行可视化

### **队列表**

一种流行的客户留存分析方法是通过使用队列，即根据用户的第一次访问来定义每个用户，然后查看他们随时间的回访情况。

理想情况下，我们的最终产品将是这样的表格：

[![](../Images/576d75b8d5ef77fe52b287521d5bacb7.png)](https://cdn-images-1.medium.com/max/1000/1*V5RIvodtHhnYwPkkxVbPhg.png)

实际上，理想情况下，我们的表格将显示每月新用户数量的增加以及留存率的提高。但你明白我的意思！

为了建立这个数据，我们首先需要确定每个月的新用户数量以及他们的留存时间。然后，获取百分比将变得简单。

我们的第一个子查询将根据客户的初次访问以及他们的留存时间来分类每个客户。

```py
first_visit AS

    SELECT cust_id,

           min(visit_month) AS first_month

    FROM visit_log

    GROUP BY 1
```

按月计算，我们可以确定新用户的数量。

```py
New_users AS

    SELECT first_month,

           count(DISTINCT cust_id) AS new_users

    FROM first_visit

    GROUP BY 1
```

我们还希望了解，比如说第 1 个月的新用户是否在第 2 个月和第 3 个月都回访，还是仅在第 3 个月回访。因此，我们将创建一个子查询，以跟踪每个客户的访问模式。

```py
SELECT *

FROM visit_log

     LEFT JOIN visit_log AS visit_tracker

            ON visit_log.cust_id = visit_tracker.cust_id

               AND visit_log.visit_month < visit_tracker.visit_month
```

然后，我们将这些数据合并以获得最终的成果。对于每个月招募的新用户，我们将获得他们的组大小，以及每个后续月份的回访百分比。就像上面的表格一样！

为了做到这一点，我们运行以下脚本：

```py
SELECT first_month,

       new_users,

       retention_month,

       retained,

       retention_percent

FROM (

           SELECT first_month,

                  new_users,

                  Count(DISTINCT visit_tracker.cust_id) AS retained count(DISTINCT visit)tracker.cust_id)/new_users AS retention_percent

FROM      first_visit

LEFT JOIN visit_log AS visit_tracker

ON        visit_log.visit_month < visit_tracker.visit_month

LEFT JOIN new_users

ON        new_users.first_month=first_visit.first_month

GROUP BY 1,

         2)
```

这将给我们一个如下所示的表格：

![](../Images/fbb300660ec5330666fa3ee299aef4d1.png)

然后我们可以在 Excel（或类似工具）中创建一个数据透视表，以获得上面的表格，或者使用像 [**Statsbot**](https://statsbot.co/solutions/product-analytics?utm_source=blog&utm_medium=article&utm_campaign=retention) 这样的商业智能工具，从数据库中直接获取数据，无需编写 SQL 代码。

![](../Images/2d3b3ed685d6d5a4bf107380eac7f5f2.png)

****解释****

生成这样的表格当然只是第一步，如果我们不知道如何解释这些数字，那将是相当无用的。

再次以我们原始的表格为基础，我将介绍基础的队列分析。

[![](../Images/576d75b8d5ef77fe52b287521d5bacb7.png)](https://cdn-images-1.medium.com/max/1000/1*V5RIvodtHhnYwPkkxVbPhg.png)

首先，我们要查看每月的新用户数量。我们是否能够为我们的业务招募到健康数量的客户？这里我们可以看到我们每月招募了 500 到 600 名新客户。这是我们原本计划做的事情吗？这是一个需要与营销团队讨论的问题。

那么，每月的新客户数量是否在上升？如果没有，上升的趋势是否存在波动？例如，我们可以看到第 6 期只有 504 名新客户，而第 5 期有 583 名，第 7 期有 598 名。这些数字的波动非常大。如果有解释，比如我们是服务于学校团体的业务，并且在那段时间有一个学校假期，那也可以。但我们需要一个解释。

之后，我们将查看实际的保留百分比。一个业务目标是随着时间的推移提高我们的保留率，即在每一行下方保持上升的趋势。因此，如果我们保留了更多第 2 期的新用户，而不是第 1 期的用户，我们就是在走对的道路上。

正如我们在上面的表格中看到的那样，这发生了什么：在 1 个月后，第 1 期的 63% 的新用户回归了，但第 2 期的 68% 的新用户回归了。所以我们做得很好！基本上，我们的客户体验应该随着时间的推移而改善，这样人们更有可能回来。

之后，我们将查看另一个指标，即我们失去客户的速率。预计随着时间的推移，保留率会下降。这就是为什么我们需要不断招募的原因！但如果我们能减缓客户流失速度，使每个时期之间的下降幅度变小，那么我们可以将更多的资源用于满足客户需求，而不仅仅是寻找新客户。这反过来会帮助保留，因为客户会喜欢我们更多地关注他们。

****访问频率****

直到现在，我忽略的一个元素是访问频率，这是客户保留分析的另一面。普遍认为，忠诚于你的业务的客户比新客户甚至那些参与度不稳定（即回头客）的客户更有价值。

添加每位客户每月访问次数或平均延迟时间，将完整展示客户如何与您的业务互动。您还可以基于客户数量、来自回头客的收入等构建群体。

### **最终思考**

客户保留分析将为任何业务分析增添深度，并允许决策者跟踪他们的招聘策略的成功情况，以及在客户体验方面的表现。如果您的客户没有回头，那么需要改进的地方可能在于产品质量或与客户的关系。保留分析便于轻松标记此类问题。

**简历：[卢巴·贝洛孔](https://www.linkedin.com/in/luba-belokon-35078512b/)** 是 Statsbot 的内容专家。

[原文](https://blog.statsbot.co/customer-retention-analysis-93af9daee46b?utm_source=kdnuggets&utm_medium=post&utm_campaign=sql)。已获许可转载。

**相关：**

+   [机器学习算法：如何选择适合您问题的算法](/2017/11/machine-learning-algorithms-choose-your-problem.html)

+   [集成学习以提高机器学习结果](/2017/09/ensemble-learning-improve-machine-learning-results.html)

+   [使用递归神经网络（LSTM）的时间序列预测指南](/2017/10/guide-time-series-prediction-recurrent-neural-networks-lstms.html)

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升您的数据分析水平

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持您的组织的 IT 需求

* * *

### 更多相关话题

+   [如何收集客户情感分析的数据](https://www.kdnuggets.com/2022/12/collect-data-customer-sentiment-analysis.html)

+   [逐步指南：阅读和理解 SQL 查询](https://www.kdnuggets.com/a-step-by-step-guide-to-reading-and-understanding-sql-queries)

+   [拆解 DENSE_RANK()：SQL 爱好者的逐步指南](https://www.kdnuggets.com/breaking-down-denserank-a-step-by-step-guide-for-sql-enthusiasts)

+   [SQL 执行顺序的必备指南](https://www.kdnuggets.com/the-essential-guide-to-sql-execution-order)

+   [SQL 数据清洗：如何准备混乱的数据进行分析](https://www.kdnuggets.com/data-cleaning-in-sql-how-to-prepare-messy-data-for-analysis)

+   [掌握 SQL、Python、数据清洗、数据…的指南合集](https://www.kdnuggets.com/collection-of-guides-on-mastering-sql-python-data-cleaning-data-wrangling-and-exploratory-data-analysis)
