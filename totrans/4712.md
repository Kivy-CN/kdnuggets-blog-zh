# 使用 NumPy 和图像分类的人工神经网络实现

> 原文：[https://www.kdnuggets.com/2019/02/artificial-neural-network-implementation-using-numpy-and-image-classification.html](https://www.kdnuggets.com/2019/02/artificial-neural-network-implementation-using-numpy-and-image-classification.html)

![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [评论](/2019/02/artificial-neural-network-implementation-using-numpy-and-image-classification.html?page=2#comments)

![](../Images/5f757b54b8113b34e602f5c2cef47590.png)

本教程使用 NumPy 从零开始构建人工神经网络，以实现 Fruits360 数据集的图像分类应用。教程中使用的所有内容（即图像和源代码），除了颜色的 Fruits360 图像外，均为我所著书籍的独占版权，书名为 ***"Ahmed Fawzy Gad 'Practical Computer Vision Applications Using Deep Learning with CNNs'. Dec. 2018, Apress, 978-1-4842-4167-7"***。这本书可以在 Springer 上找到，链接为：[https://springer.com/us/book/9781484241660](https://springer.com/us/book/9781484241660)。

本教程中使用的源代码可以在我的 GitHub 页面找到，链接为：[https://github.com/ahmedfgad/NumPyANN](https://github.com/ahmedfgad/NumPyANN)

书中使用的示例涉及使用人工神经网络（ANN）对 Fruits360 图像数据集进行分类。该示例不假设读者已经提取特征或实现了 ANN，因为它讨论了适合使用的特征集以及如何从零开始在 NumPy 中实现 ANN。Fruits360 数据集包含60个水果类别，如苹果、番石榴、鳄梨、香蕉、樱桃、枣、猕猴桃、桃子等。为了简化问题，它仅处理4个选定的类别：Braeburn 苹果、Meyer 柠檬、芒果和覆盆子。每个类别大约有491张用于训练的图像和162张用于测试的图像。图像大小为100x100像素。

### 特征提取

这本书首先通过选择合适的特征集来实现最高的分类准确率。根据下面显示的4个选定类别的样本图像，似乎它们的颜色不同。这就是为什么颜色特征适合用于此任务的原因。

![](../Images/5144782453ae88a2f3f04a8244732c5f.png)

RGB 颜色空间不会将颜色信息与其他类型的信息（如光照）隔离开来。因此，如果使用 RGB 来表示图像，那么三个通道将参与计算。因此，最好使用将颜色信息隔离到单个通道中的颜色空间，如 HSV。在这种情况下，颜色通道是色调通道（H）。下图显示了之前呈现的4个样本的色调通道。我们可以注意到每张图像的色调值与其他图像不同。

![](../Images/95d2d57c5c54bab7efe5c74f5d9c5d5f.png)

色调通道的大小仍为100x100。如果整个通道应用于人工神经网络，那么输入层将有10,000个神经元。网络仍然很庞大。为了减少使用的数据量，我们可以使用直方图来表示色调通道。直方图将有360个箱子，反映色调值的可能值数量。以下是4张样本图像的直方图。使用360个箱子的色调直方图，似乎每种水果都投票给直方图的某些特定箱子。与使用RGB颜色空间中的任何通道相比，不同类别之间的重叠较少。例如，苹果直方图中的箱子范围从0到10，而芒果的箱子范围从90到110。各类别之间的间隔使得减少分类中的歧义变得更容易，从而提高了预测准确性。

![](../Images/6e96815abd2c84e2d0d8b6e32f3d197c.png)

这是计算4张图像的色调通道直方图的代码。

```py

import numpy
import skimage.io, skimage.color
import matplotlib.pyplot

raspberry = skimage.io.imread(fname="raspberry.jpg", as_grey=False)
apple = skimage.io.imread(fname="apple.jpg", as_grey=False)
mango = skimage.io.imread(fname="mango.jpg", as_grey=False)
lemon = skimage.io.imread(fname="lemon.jpg", as_grey=False)

apple_hsv = skimage.color.rgb2hsv(rgb=apple)
mango_hsv = skimage.color.rgb2hsv(rgb=mango)
raspberry_hsv = skimage.color.rgb2hsv(rgb=raspberry)
lemon_hsv = skimage.color.rgb2hsv(rgb=lemon)

fruits = ["apple", "raspberry", "mango", "lemon"]
hsv_fruits_data = [apple_hsv, raspberry_hsv, mango_hsv, lemon_hsv]
idx = 0
for hsv_fruit_data in hsv_fruits_data:
fruit = fruits[idx]
hist = numpy.histogram(a=hsv_fruit_data[:, :, 0], bins=360)
matplotlib.pyplot.bar(left=numpy.arange(360), height=hist[0])
matplotlib.pyplot.savefig(fruit+"-hue-histogram.jpg", bbox_inches="tight")
matplotlib.pyplot.close("all")
idx = idx + 1

```

通过遍历使用的4个图像类别中的所有图像，我们可以从所有图像中提取特征。以下代码执行此操作。根据4个类别中的图像数量（1,962）和从每张图像中提取的特征向量长度（360），创建一个零的NumPy数组并保存在**dataset_features**变量中。为了存储每张图像的类别标签，创建了另一个名为**outputs**的NumPy数组。苹果的类别标签为0，柠檬为1，芒果为2，覆盆子为3。代码期望在一个包含根据列表**fruits**中的水果名称命名的4个文件夹的根目录中运行。它遍历所有文件夹中的所有图像，提取每张图像的色调直方图，为每张图像分配一个类别标签，最后使用pickle库保存提取的特征和类别标签。你也可以使用NumPy来保存结果的NumPy数组，而不是pickle。

```py

import numpy
import skimage.io, skimage.color, skimage.feature
import os
import pickle

fruits = ["apple", "raspberry", "mango", "lemon"]
#492+490+490+490=1,962

dataset_features = numpy.zeros(shape=(1962, 360))
outputs = numpy.zeros(shape=(1962))
idx = 0
class_label = 0

for fruit_dir in fruits:
  curr_dir = os.path.join(os.path.sep, fruit_dir)
  all_imgs = os.listdir(os.getcwd()+curr_dir)
  for img_file in all_imgs:
    fruit_data = skimage.io.imread(fname=os.getcwd()+curr_dir+img_file, as_grey=False)
    fruit_data_hsv = skimage.color.rgb2hsv(rgb=fruit_data)
    hist = numpy.histogram(a=fruit_data_hsv[:, :, 0], bins=360)
    dataset_features[idx, :] = hist[0]
    outputs[idx] = class_label
    idx = idx + 1
  class_label = class_label + 1

with open("dataset_features.pkl", "wb") as f:
  pickle.dump("dataset_features.pkl", f)

with open("outputs.pkl", "wb") as f:
  pickle.dump(outputs, f)

```

目前，每张图像使用360个元素的特征向量表示。这些元素经过筛选，以仅保留对区分4个类别最相关的元素。减少的特征向量长度为102，而不是360。使用较少的元素有助于比以前更快地训练。**dataset_features**变量的形状将为**1962x102**。有关减少特征向量长度的更多信息，请参阅书籍。

到目前为止，训练数据（特征和类别标签）已准备好。接下来是使用NumPy实现人工神经网络。

* * *

## 我们的前三个课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [谷歌网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持你的组织的 IT

* * *

### 关于这个话题的更多内容

+   [成为出色数据科学家所需的 5 项关键技能](https://www.kdnuggets.com/2021/12/5-key-skills-needed-become-great-data-scientist.html)

+   [每个初学者数据科学家应掌握的 6 个预测模型](https://www.kdnuggets.com/2021/12/6-predictive-models-every-beginner-data-scientist-master.html)

+   [2021 年最佳 ETL 工具](https://www.kdnuggets.com/2021/12/mozart-best-etl-tools-2021.html)

+   [使用管道编写清晰的 Python 代码](https://www.kdnuggets.com/2021/12/write-clean-python-code-pipes.html)

+   [使用卷积神经网络 (CNNs) 进行图像分类](https://www.kdnuggets.com/2022/05/image-classification-convolutional-neural-networks-cnns.html)

+   [停止学习数据科学以寻找目标，并通过找到目标来……](https://www.kdnuggets.com/2021/12/stop-learning-data-science-find-purpose.html)
