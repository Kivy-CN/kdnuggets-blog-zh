# OpenStreetMap 数据到机器学习训练标签用于物体检测

> 原文：[https://www.kdnuggets.com/2019/09/openstreetmap-data-ml-training-labels-object-detection.html](https://www.kdnuggets.com/2019/09/openstreetmap-data-ml-training-labels-object-detection.html)

[评论](#comments)

**由 [Shay Strong](https://www.linkedin.com/in/shay-strong/)，EagleView 数据科学与机器学习总监**

我想创建一个无缝的教程，将 OpenStreetMap (OSM) 矢量数据转换为机器学习 (ML) 模型使用的格式。我特别感兴趣于为灾难救援应用创建一个紧密、清晰的流程，我们可以使用类似于 OSM 的众包建筑多边形来训练一个监督式物体检测器，以发现未标记的位置中的建筑物。

构建基本深度学习物体检测器的步骤有两个组成部分：（1）训练数据（光栅图像 + 矢量标签对）和（2）模型框架。深度学习模型本身将是一个 Single Shot Detector (SSD) 物体检测器。我们将使用 OSM 多边形作为标签数据的基础，使用 Digital Globe 的影像作为光栅数据。这里不会详细讨论 SSD，因为有很多可用的资源。我们将在 [AWS Sagemaker](https://aws.amazon.com/sagemaker/) 上运行物体检测器。当前文章仅关注训练数据生成。我将跟进一篇关于模型训练的单独文章。

我应该指出，这个教程可以在这个 [Github 仓库](https://github.com/shaystrong/sagely) 中找到，因此如果你想直接开始，可以跳过这篇文章。尽管它仍在进行中，作为即将到来的 [UW Geohackweek](https://geohackweek.github.io/) 的一部分。我预计将这个教程与 [HOT-OSM](https://www.hotosm.org/) 相关任务结合使用——那里可能会有作为特定项目一部分的众包矢量数据。为了建立一个演示，我们将使用一个最近的 HOT OSM 任务区域，该区域在 2019 年受到气旋 Kenneth 的影响，即 Nzwani, Comores。

![figure-name](../Images/0fff813d4fc63f67a48919ba2489c09e.png)2019年4月底的气旋 Kenneth 路径。![figure-name](../Images/d3896569ea9e025396e63a3818695d41.png)HOT-OSM 任务数据来自 [https://wiki.openstreetmap.org/wiki/2019_Cyclone_Kenneth](https://wiki.openstreetmap.org/wiki/2019_Cyclone_Kenneth)。

OSM 矢量数据是免费的。我们所需的影像通常不是。欢迎来到 GIS 的世界。但，[Digital Globe 提供开放数据](https://www.digitalglobe.com/ecosystem/open-data)的影像覆盖了许多自然灾害区域。因此，我们可以稍后获取这些数据用于本应用。

我决定使用[OSMNX](https://automating-gis-processes.github.io/2017/lessons/L7/retrieve-osm-data.html) Python 库来与 OSM 接口（否则可能会有些令人生畏）。根据 HOT-OSM 任务，Nzwani, Comores 被标记为“紧急”位置（见上表）。所以我会从那里开始，因为似乎可以获得大量训练数据。

![figure-name](../Images/4e8c6c678c3ffab9fedbfa3990865d6b.png)（左）OSM 的节点和边的‘DiGraph’。（右）Nzwani 陆地与叠加的道路和建筑物。

如果你检查建筑物的长度（返回的 geopandas 数据框），你会看到大量特征。我们将这些作为我们对象检测器的训练数据。

让我们获取一些 DG 影像。为了创建一个对象检测器，我们将模仿[VOC Pascal 训练数据格式](http://host.robots.ox.ac.uk/pascal/VOC/)，我们需要图像（jpegs）和矢量（xml）标签的配对。xml 文件以特定方式格式化。你可以在这个难以浏览的[网站](http://host.robots.ox.ac.uk/pascal/VOC/)上阅读相关内容。

我更愿意直接从 Digital Globe Open Data 网站获取数据，但不幸的是，目前似乎没有涵盖该区域的事件后影像。我真的希望将这个位置作为重点，考虑到我们发现的建筑物数量以及这个任务的相关性。所以，我会单独下载所需的影像，并为这个演示提供一个小子集。你可以在[GitHub repo](https://github.com/shaystrong/sagely)中找到一个样本 GeoTIFF。

让我稍微离题谈谈[DG Open Data 网站](https://www.digitalglobe.com/ecosystem/open-data)。这个网站相当难以搜索，尽管提供了大量及时且相关的影像供受自然灾害影响的地区免费使用，但作为个人用户，几乎不可能有效地以地理空间方式进行搜索。底线是，很难确定哪张图像可能最优地包含我感兴趣地区的大量建筑物。我通常的做法是点击网站上的一些缩略图，找到一个显著的城市化增长区域。城市区域里必须有建筑物！我看了20分钟的缩略图模式（实际上是45分钟，因为我对模式匹配可能会变得过于执着）。假设 DG Open Data 将来会有这张图像，那么随后的步骤对于你下载的任何 GeoTIFF 仍然一致。

如果你直接从 DG 开放数据网站获取图像，它们实际上是 Cloud Optimized GeoTIFF (COG) 格式，这样做创建虚拟栅格（vrt）非常方便。这样做的好处是我们可以创建一个轻量级文件，在本地 QGIS 窗口中加载，而不需要下载整个 tif。我们可以裁剪、子集化等，只得到我们想要的图像，而不是多余的区域。

一旦你获得 GeoTIFF，我们将使用 GDAL 将其转换为 [MBtile](https://github.com/mapbox/mbtiles-spec) 格式，然后解压到 x/y/z slippymap (TMS) 目录结构中。MBtiles 对我们非常有利，因为 256x256 图像块（png）非常适合深度学习模型训练格式。

你可能会注意到生成的图像以嵌套文件结构存储。我们需要将它们“扁平化”，使所有图像都在一个目录中。你不能直接将它们复制到一个目录，因为 .png 文件名并不唯一。我们还将把它们从 png 转换为 jpeg。我们将把它们放在一个毫无意义的 VOC 样式文件夹中，以区分于真正的 VOC 数据集 VOC1900。

太棒了，图像已经完成！

接下来，我们将对建筑物进行缓冲处理，使其对齐到最近的矩形。这是对象检测器所需要的。

现在我们已经将建筑物表示为轴对齐的边界框，我们将使用我新的最爱工具 [Supermercado](https://github.com/mapbox/supermercado)。我们将进入“超市”，识别所有与建筑框重叠的 TMS 瓦片。我们将 TMS 瓦片 ID 映射到建筑框，然后将建筑框（以地理空间的经纬度格式表示）转换为 slippymap 瓦片参考系。现在，我们将在与我们解压的图像相同的网格上拥有一个建筑框。

最后，我们要清理 xml 标签和图像，以确保移除多余的矢量标签。我们只想要一对一的图像和注释。

你现在应该有一个干净且准备好的 VOC 样式图像和标签目录，准备进行训练。

[PRE0]

接下来将是实际的培训，请继续关注。

**个人简介：[Shay Strong](https://www.linkedin.com/in/shay-strong/)** 是 EagleView 的数据科学与机器学习总监，对地理空间机器学习与遥感感兴趣。

原文。已获授权转载。

**相关：**

+   [2019 年对象检测指南](/2019/08/2019-guide-object-detection.html)

+   [使用 Tensorflow 对象检测和 OpenCV 分析足球比赛](/2018/07/analyze-soccer-game-using-tensorflow-object-detection-opencv.html)

+   [使用 RetinaNet 进行空中图像行人检测](/2019/03/pedestrian-detection-aerial-images-retinanet.html)

* * *

## 我们的前三名课程推荐

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google 网络安全证书](https://www.kdnuggets.com/google-cybersecurity) - 快速进入网络安全职业生涯。

![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [谷歌数据分析专业证书](https://www.kdnuggets.com/google-data-analytics) - 提升你的数据分析技能

![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [谷歌 IT 支持专业证书](https://www.kdnuggets.com/google-itsupport) - 支持组织的 IT 工作

* * *

### 更多相关话题

+   [处理文本数据中的噪声标签](https://www.kdnuggets.com/2023/04/dealing-noisy-labels-text-data.html)

+   [KDnuggets™ 新闻 22:n09, 3月2日: 讲述一个精彩的数据故事：A…](https://www.kdnuggets.com/2022/n09.html)

+   [SQL 与面向对象关系映射（ORM）之间的区别是什么？](https://www.kdnuggets.com/2022/02/difference-sql-object-relational-mapping-orm.html)

+   [数据科学中异常检测技术的初学者指南](https://www.kdnuggets.com/2023/05/beginner-guide-anomaly-detection-techniques-data-science.html)

+   [KDnuggets 新闻，8月17日: 如何使用…进行运动检测](https://www.kdnuggets.com/2022/n33.html)

+   [功能数据中的密度核深度异常检测](https://www.kdnuggets.com/density-kernel-depth-for-outlier-detection-in-functional-data)
