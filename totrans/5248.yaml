- en: 'Calculating Customer Lifetime Value: SQL Example'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://www.kdnuggets.com/2018/02/calculating-customer-lifetime-value-sql-example.html](https://www.kdnuggets.com/2018/02/calculating-customer-lifetime-value-sql-example.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![c](../Images/3d9c022da2d331bb56691a9617b91b90.png) [comments](#comments)'
  prefs: []
  type: TYPE_IMG
- en: '**By Luba Belokon, [Statsbot](https://statsbot.co/)**'
  prefs: []
  type: TYPE_NORMAL
- en: '![Header image](../Images/6458b0318357d930e839206ca8a17523.png)'
  prefs: []
  type: TYPE_IMG
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Our Top 3 Course Recommendations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 1\. [Google Cybersecurity
    Certificate](https://www.kdnuggets.com/google-cybersecurity) - Get on the fast
    track to a career in cybersecurity.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e225c49c3c91745821c8c0368bf04711.png) 2\. [Google Data Analytics
    Professional Certificate](https://www.kdnuggets.com/google-data-analytics) - Up
    your data analytics game'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0244c01ba9267c002ef39d4907e0b8fb.png) 3\. [Google IT Support
    Professional Certificate](https://www.kdnuggets.com/google-itsupport) - Support
    your organization in IT'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '*The [Statsbot](https://statsbot.co/?utm_source=kdnuggets&utm_medium=article&utm_campaign=ltv&utm_content=predict_ltv) team
    estimated LTV 592 times for different clients and business models. We share our
    experience in this post and in a **[free ebook](https://statsbot.co/ltv-ebook?utm_source=kdnuggets&utm_medium=article&utm_campaign=ltv&utm_content=predict_ltv)** on
    how to calculate customer lifetime value with SQL without sophisticated statistical
    models.*'
  prefs: []
  type: TYPE_NORMAL
- en: Customer lifetime value, or LTV, is the amount of money that a customer will
    spend with your business in their “lifetime,” or at least, in the portion of it
    that they spend in a relationship with you. It’s an important indicator of how
    much you can spend on acquiring new customers. **For example, your customer acquisition
    cost (CAC) is $150, and LTV is $600.** You would be able to increase the budget
    to get more people and grow your business. The balance between CAC and LTV allows
    you to check any business for market survival.
  prefs: []
  type: TYPE_NORMAL
- en: Estimating LTV is a predictive metric which depends on future purchases, based
    on past patterns, and allows you to see how much risk you are exposed to as a
    business, and how much you can afford to spend to acquire new clients. At an individual
    level, it also enables you to figure out who your highest-value customers are
    likely to be, not just now, but also in the future.
  prefs: []
  type: TYPE_NORMAL
- en: In order to understand how to estimate LTV, it is useful to first think about
    evaluating a customer’s lifetime value at the end of their relationship with us.
    So, say a customer stays with us for 12 months, and spends $50 per month.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fd0ef86fe315668c269a328ce7c8c25e.png)'
  prefs: []
  type: TYPE_IMG
- en: The revenue that they generated for our business over their lifetime is then
    $50*12 = $600\.  Simple! We can consider the *basic definition of LTV* as a sum
    of payments from a specific user.
  prefs: []
  type: TYPE_NORMAL
- en: 'This same principle applies to the group. If we want to see* the average LTV *for
    the group we can look at total spend divided by the number of customers. When
    we’re talking about *estimating LTV *for the group*, or predictive LTV, *we need
    to take into account how long customers stay with us. To get that, we actually
    look at it “backwards”: we look at how many customers we lose over time, or the *churn
    rate*.'
  prefs: []
  type: TYPE_NORMAL
- en: How do you calculate LTV for SaaS?
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'At a group level, the basic formula for estimating LTV is this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/333440d57273d027f78f696cd2994000.png)'
  prefs: []
  type: TYPE_IMG
- en: Where ARPU is average monthly recurring revenue per user and the churn rate
    is the rate at which we are losing customers (so the inverse of retention).
  prefs: []
  type: TYPE_NORMAL
- en: 'This basic formula can be obtained from assumption:'
  prefs: []
  type: TYPE_NORMAL
- en: '***Next Month Revenue = (Current Month Revenue) * (1 – Churn Rate)***'
  prefs: []
  type: TYPE_NORMAL
- en: '*Note: When we’re estimating customer lifetime value for SaaS we can neglect
    Gross Margin, because costs are minor and don’t affect the accuracy of a result.
    But when we calculate predictive LTV for ecommerce later in this article, we’ll
    include COGS in our formula.*'
  prefs: []
  type: TYPE_NORMAL
- en: 'The main limitation of the LTV formula above is that it assumes that churn
    is linear over time, as in: we are as likely to lose a customer between the first
    month of membership of our service and the second, as we are to lose them much
    later on. Going deeper into the nature of predictive LTV, we can say that it’s
    a sum of a [geometric series](https://en.wikipedia.org/wiki/Geometric_series),
    and linear churn doesn’t look like a straight line (as is shown in many articles
    about LTV).'
  prefs: []
  type: TYPE_NORMAL
- en: In fact, we know that linear churn is usually not the case.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In a flexible subscription model, we lose many people at the very beginning,
    when they are “testing out” a service, but once they have been with us for a long
    time, they are less likely to leave.
  prefs: []
  type: TYPE_NORMAL
- en: 'Ultimately, it depends on the type of contract that exists between customers
    and the business: for example, annual renewals, where churn is more linear, will
    result in LTV that is very close to the formula above.'
  prefs: []
  type: TYPE_NORMAL
- en: Services which do not have any contracts may lose a high percentage of their
    new customers, but then churn may slow down.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can think of this concept graphically:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a68f0a58f6846b5a598f564c1f69d50d.png)'
  prefs: []
  type: TYPE_IMG
- en: If the LTV of the group is the area under the line, we can very clearly see
    that the rate at which we lose customers will impact our LTV estimates very significantly.
    So we will need to take this into account when we are making our calculations.
    For a first estimate of LTV, however, it makes sense to go with the simplest formula.
    After that, we will add levels of complexity.
  prefs: []
  type: TYPE_NORMAL
- en: Extracting ARPU and churn using SQL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In order to make the most basic estimate of LTV, we need to look at our transaction
    history. Then, we can establish the average revenue per customer as well as the
    churn rate over the period that we are looking at. For simplicity, I’m going to
    look at the last year.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can calculate ARPU in 2 steps:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'The results will look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d7ab31f06da8eac9ea118a48e8f9c0b7.png)'
  prefs: []
  type: TYPE_IMG
- en: In the case above, that would give us an average monthly spend of **$987.33.**
  prefs: []
  type: TYPE_NORMAL
- en: Calculating churn rate is a bit more complicated, as we need the percentage
    of people **not **returning from one month to the next, taking each group of customers
    according to the month of their first visit, and then checking if they came back
    or not in the following month.
  prefs: []
  type: TYPE_NORMAL
- en: The problem is always that, in a transactional database, we have customers’
    visits on separate lines, rather than all on the same line.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The way to fix that problem is to join the transactional database to itself,
    so that we can see a customer’s behavior on one single line.
  prefs: []
  type: TYPE_NORMAL
- en: In order to isolate those who churned, we take the visits from month 1, and
    left join the visits from month 2 on the cust_id. The lines where visits from
    month 2 have a cust_id that is null are the ones where the customer has not returned.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Say this gives us a result of 0.1, just for simplicity.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5b9c40480494ed2e9d18cda5f8b5df76.png)'
  prefs: []
  type: TYPE_IMG
- en: 'It is a simple calculation, then, to estimate LTV: we have monthly ARPU and
    monthly churn, so we just divide one by the other!'
  prefs: []
  type: TYPE_NORMAL
- en: $987.33/0.1 = **$9873.3**
  prefs: []
  type: TYPE_NORMAL
- en: As stated earlier, there are limits to this formula, mostly because it makes
    a series of assumptions that may not hold in the real world. The main one is that
    retention and churn rates are *stable both across cohorts and across time*.
  prefs: []
  type: TYPE_NORMAL
- en: Stability across cohorts implies that early adopters of your service act in
    similar ways to late adopters, while stability across time implies that customers’
    likelihood of churning out is the same at the beginning of their relationship
    with you as it is, for example, 2 years in. Depending on how close to the truth
    these assumptions are, you may need to revise your LTV estimate downwards.
  prefs: []
  type: TYPE_NORMAL
- en: '**If you want to lean how to estimate LTV for ecommerce, for cohorts and each
    individual customer, download our [FREE ebook](https://statsbot.co/ltv-ebook?utm_source=kdnuggets&utm_medium=article&utm_campaign=ltv&utm_content=predict_ltv) on
    calculating customer lifetime value with SQL. **'
  prefs: []
  type: TYPE_NORMAL
- en: '**Bio: [Luba Belokon](https://www.linkedin.com/in/luba-belokon-35078512b?utm_source=kdnuggets&utm_medium=post&utm_campaign=ebook)**
    is Content Jedi at Statsbot.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Original](https://statsbot.co/blog/calculating-customer-lifetime-value-sql-example/).
    Reposted with permission.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Related:**'
  prefs: []
  type: TYPE_NORMAL
- en: '[A Guide for Customer Retention Analysis with SQL](/2017/12/guide-customer-retention-analysis-sql.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Machine Learning Algorithms: Which One to Choose for Your Problem](/2017/11/machine-learning-algorithms-choose-your-problem.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Ensemble Learning to Improve Machine Learning Results](/2017/09/ensemble-learning-improve-machine-learning-results.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: More On This Topic
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[Evaluating Methods for Calculating Document Similarity](https://www.kdnuggets.com/evaluating-methods-for-calculating-document-similarity)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Key-Value Databases, Explained](https://www.kdnuggets.com/2021/04/nosql-explained-understanding-key-value-databases.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Using Datawig, an AWS Deep Learning Library for Missing Value Imputation](https://www.kdnuggets.com/2021/12/datawig-aws-deep-learning-library-missing-value-imputation.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Essential Math for Data Science: Visual Introduction to Singular…](https://www.kdnuggets.com/2022/06/essential-math-data-science-visual-introduction-singular-value-decomposition.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Machine learning does not produce value for my business. Why?](https://www.kdnuggets.com/2021/12/machine-learning-produce-value-business.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Maximize Your Value With The 3rd Best Online Master’s In Data…](https://www.kdnuggets.com/2023/05/bay-path-maximize-value-online-masters-data-science.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
